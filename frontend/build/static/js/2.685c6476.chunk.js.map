{"version":3,"sources":["components/WebsocketService.js","redux/actions/roomActions.js","helper/utilFunctions.js","helper/socketListeners.js","helper/peers.js","components/common/Video.js","components/Room/Controls.js","components/Room/Chat.js","components/Room/JoinModal.js","helper/unusedFunctions.js","views/RoomView.js"],"names":["WebSocketService","callbacks","this","socketRef","fallback","forcedClose","chatroom_url","WebSocket","onopen","console","log","onmessage","e","socketNewMessage","data","onerror","debug","onclose","code","setTimeout","connect","reason","close","command","func","received_data","parsedData","JSON","parse","Object","keys","length","type","waitForConnection","stringify","send","bind","err","message","readyState","callback","interval","state","that","instance","WebSocketInstance","getInstance","createNewRoom","url","create_room","dispatch","apiClient","post","then","res","apiDispatch","CREATE_ROOM","navigator","clipboard","writeText","getUrlFromCode","id","toast","success","catch","error","getRooms","get_room","get","GET_ROOMS","getRoom","roomID","GET_ROOM","toggleAudio","TOGGLE_USER_AUDIO","toggleVideo","TOGGLE_USER_VIDEO","getIsUserCreator","roomId","isUserCreator","SET_USER_IS_CREATOR","isCreator","split","x","n","Math","floor","sqrt","zp","pp","m","i","push","reverse","count","idx","getFullName","firstName","lastName","trim","all_users_listener","peersRef","myID","stream","setPeers","users","current","temp","forEach","user","peer","userToSignal","callerID","Peer","initiator","trickle","on","signal","WebsocketService","sendMessage","createPeer","user_joined_listener","isUserAudioOn","isUserVideoOn","payload","callerUser","usable_id","incomingSignal","addPeer","Boolean","peers","userID","audioOn","videoOn","info","first_name","last_name","receive_returned_signal","user_left_listener","destroy","videoMediaListener","audioMediaListener","getPermissionListener","setAcceptStatus","status","getPermissionRequestListener","setWaitingUsers","getUniqueArray","useStyles","makeStyles","theme","responsive","size","rows","float","width","height","display","alignItems","videoTop","paddingTop","position","overflow","background","palette","paper","margin","borderRadius","micOff","right","top","videoOff","left","justifyContent","avatar","fontSize","Video","React","forwardRef","ref","muted","isUserVideo","localRef","useRef","currentRef","classes","initials","toUpperCase","useEffect","srcObject","className","style","objectFit","transform","playsInline","autoPlay","IconButton","Avatar","container","minHeight","flexGrow","default","blue","orange","color","red","marginRight","Controls","switchc","toggleChat","useDispatch","isAudioOn","useSelector","roomReducer","userVideo","isVideoOn","history","useHistory","Paper","elevation","Grid","justify","onClick","replace","drawer","flexShrink","drawerPaper","drawerHeader","padding","spacing","mixins","toolbar","chatInputContainer","marginTop","chatInput","marginBottom","borderBottom","paddingBottom","messageBoxRight","text","primary","messageBoxLeft","messageSender","MessageItem","props","useTheme","owner","userReducer","messagePosition","pk","sender","messageBackground","MessageList","memo","messages","slice","map","messageItem","senderAvatar","Chat","open","setOpen","useState","setMessages","currMessage","setCurrMessage","onCurrMessageChanged","useCallback","val","target","value","Drawer","variant","anchor","TextField","placeholder","fullWidth","multiline","rowsMax","onChange","InputProps","endAdornment","InputAdornment","aria-label","Send","modal","JoinModal","waitingUsers","Modal","show","onHide","backdrop","keyboard","Header","Title","Body","Row","Col","filter","el","rejectUser","acceptUser","Footer","updateStream","userStream","key","streams","getTracks","track","stop","removeTrack","getVideoTracks","addTrack","videoConstraints","window","innerHeight","innerWidth","flexDirection","Room","useParams","setUserStream","currentCameraRef","sizeMap","chatOpen","setChatOpen","me","setCameraStream","a","mediaDevices","getUserMedia","video","audio","socketConnect","socketFunctions","userStreamRef","getAudioTracks","enabled","maxHeight","flexWrap","values","item","index","enumerateDevices","devices","videoDevices","device","kind","updatedConstraints","deviceId","exact"],"mappings":"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","file":"static/js/2.685c6476.chunk.js","sourcesContent":["class WebSocketService {\n  static instance = null;\n  callbacks = {};\n\n  static getInstance() {\n    if (!WebSocketService.instance) {\n      WebSocketService.instance = new WebSocketService();\n    }\n    return WebSocketService.instance;\n  }\n\n  constructor() {\n    this.socketRef = null;\n    this.fallback = null;\n    this.forcedClose = false;\n  }\n\n  connect(chatroom_url, fallback = () => {}) {\n    this.forcedClose = false;\n    this.fallback = fallback;\n    this.socketRef = new WebSocket(chatroom_url);\n\n    this.socketRef.onopen = () => {\n      console.log(\"websocket open\");\n    };\n\n    this.socketRef.onmessage = (e) => {\n      this.socketNewMessage(e.data);\n    };\n\n    this.socketRef.onerror = (e) => {\n      console.debug(e);\n    };\n\n    this.socketRef.onclose = (e) => {\n      console.log(e);\n      if (e.code === 4000) {\n        this.fallback(e);\n      } else if (this.forcedClose) {\n        console.log(\"websocket closed\");\n      } else {\n        console.log(\"websockets closed lets reopen\");\n        setTimeout(() => {\n          this.connect(chatroom_url, fallback(e));\n        }, 5000);\n      }\n    };\n  }\n\n  close(code, reason) {\n    // Default CLOSE_NORMAL code\n    if (typeof code == \"undefined\") {\n      code = 1000;\n    }\n    this.forcedClose = true;\n    if (this.socketRef) {\n      this.socketRef.close(code, reason);\n    }\n  }\n  on(command, func) {\n    this.callbacks[command] = func;\n  }\n\n  socketNewMessage(received_data) {\n    const parsedData = JSON.parse(received_data);\n    const { command, data } = parsedData;\n    if (Object.keys(this.callbacks).length === 0) {\n      return;\n    }\n    console.log(parsedData);\n    if (this.callbacks[command]) {\n      this.callbacks[command](data);\n    }\n  }\n\n  sendMessage(type, data) {\n    try {\n      this.waitForConnection(\n        function () {\n          console.log(JSON.stringify({ type, data }));\n          this.socketRef.send(JSON.stringify({ type, data }));\n        }.bind(this),\n        1000\n      );\n    } catch (err) {\n      console.log(err.message);\n    }\n  }\n  refresh() {\n    if (this.socketRef) {\n      this.socketRef.close();\n    }\n  }\n\n  state() {\n    return this.socketRef.readyState;\n  }\n  waitForConnection(callback, interval) {\n    if (this.state() === 1) {\n      callback();\n    } else {\n      var that = this;\n      // optional: implement backoff for interval here\n      setTimeout(function () {\n        that.waitForConnection(callback, interval);\n      }, interval);\n    }\n  }\n}\n\nconst WebSocketInstance = WebSocketService.getInstance();\n\nexport default WebSocketInstance;\n","import apiClient from \"../../helper/apiclient\";\nimport { toast } from \"react-toastify\";\n\nimport {\n  CREATE_ROOM,\n  GET_ROOM,\n  GET_ROOMS,\n  SET_USER_IS_CREATOR,\n  TOGGLE_USER_AUDIO,\n  TOGGLE_USER_VIDEO,\n} from \"./roomActionTypes\";\n\nimport {\n  create_room,\n  get_room,\n  invite,\n  isUserCreator,\n} from \"../../config/backend_api\";\n\nimport { apiDispatch, getUrlFromCode } from \"../../helper/helperFunctions\";\n\nexport const createNewRoom = (data) => {\n  const url = create_room;\n  return (dispatch) => {\n    apiClient\n      .post(url, data)\n      .then((res) => {\n        dispatch(apiDispatch(CREATE_ROOM, res.data));\n        navigator.clipboard.writeText(getUrlFromCode(res.data.id));\n        toast.success(\"copied to clipboard\");\n      })\n      .catch((err) => {\n        toast.error(`error occured in creating the room`);\n      });\n  };\n};\n\nexport const getRooms = () => {\n  const url = get_room;\n  return (dispatch) => {\n    apiClient\n      .get(url)\n      .then((res) => {\n        dispatch(apiDispatch(GET_ROOMS, res.data));\n      })\n      .catch((err) => {\n        toast.error(`error occured in fetching your rooms`, {});\n      });\n  };\n};\n\nexport const getRoom = (roomID) => {\n  const url = `${get_room}${roomID}/`;\n  return (dispatch) => {\n    apiClient.get(url).then((res) => {\n      dispatch(apiDispatch(GET_ROOM, res.data));\n    });\n  };\n};\n\nexport const toggleAudio = () => {\n  return (dispatch) => {\n    dispatch(apiDispatch(TOGGLE_USER_AUDIO));\n  };\n};\nexport const toggleVideo = () => {\n  return (dispatch) => {\n    dispatch(apiDispatch(TOGGLE_USER_VIDEO));\n  };\n};\n\nexport const inviteUser = (roomId, data) => {\n  const url = invite(roomId);\n  return (dispatch) => {\n    apiClient\n      .post(url, data)\n      .then((res) => {\n        toast.success(\"user invited\");\n      })\n      .catch((err) => {\n        toast.error(err.data);\n      });\n  };\n};\n\nexport const getIsUserCreator = (roomId) => {\n  const url = isUserCreator(roomId);\n  return (dispatch) => {\n    apiClient.get(url).then((res) => {\n      console.log(res);\n      dispatch(apiDispatch(SET_USER_IS_CREATOR, res.data.isCreator));\n    });\n  };\n};\n","export const split = (x) => {\n  let n = Math.floor(Math.sqrt(x));\n  let zp = n - (x % n);\n  let pp = Math.floor(x / n);\n  let m = [];\n  for (let i = 0; i < n; i++) {\n    if (i >= zp) {\n      m.push(pp + 1);\n    } else {\n      m.push(pp);\n    }\n  }\n  m = m.reverse();\n  let res = {};\n  let count = 1;\n  let idx = 0;\n  for (let i = 1; i <= x; i++) {\n    res[i] = m[idx];\n    count++;\n    if (count > m[idx]) {\n      count = 1;\n      idx++;\n    }\n  }\n  res[\"rows\"] = m.length;\n  return res;\n};\n\nexport function detectURL(message) {\n  var urlRegex = /(((https?:\\/\\/)|(www\\.))[^\\s]+)/g;\n  return message.replace(urlRegex, function (urlMatch) {\n    return `<a href=${urlMatch} target=\"_blank\" >${urlMatch}</a>`;\n  });\n}\nexport function sanitize(string) {\n  const map = {\n    \"&\": \"&amp;\",\n    \"<\": \"&lt;\",\n    \">\": \"&gt;\",\n    '\"': \"&quot;\",\n    \"'\": \"&#x27;\",\n    \"/\": \"&#x2F;\",\n  };\n  const reg = /[&<>\"'/]/gi;\n  return string.replace(reg, (match) => map[match]);\n}\n\nexport const getFullName = (firstName, lastName) => {\n  const fullName = firstName + \" \" + lastName;\n  return fullName.trim();\n};\n","import { toast } from \"react-toastify\";\nimport WebsocketService from \"../components/WebsocketService\";\nimport { getFullName } from \"../helper/utilFunctions\";\nimport { getUniqueArray } from \"./helperFunctions\";\nimport { addPeer, createPeer } from \"./peers\";\n\nexport const all_users_listener =\n  (peersRef, myID, stream, setPeers) => (users) => {\n    peersRef.current = {};\n    const temp = {};\n    users.forEach((user) => {\n      if (myID !== user.id) {\n        const peer = createPeer(user.id, myID, stream);\n\n        peersRef.current[user.id] = { user, peer };\n        temp[user.id] = {\n          user: user,\n          peer: peer,\n        };\n      }\n    });\n    setPeers(temp);\n  };\n\nexport const user_joined_listener =\n  (myID, peersRef, stream, setPeers, isUserAudioOn, isUserVideoOn) =>\n  (payload) => {\n    const user = payload.callerUser;\n    if (payload.usable_id === myID) {\n      const peer = addPeer(payload.signal, user.id, stream);\n      if (!Boolean(peersRef.current[user.id])) {\n        peersRef.current[user.id] = { user, peer };\n        setPeers((peers) => ({\n          ...peers,\n          [user.id]: {\n            user: user,\n            peer: peer,\n          },\n        }));\n      }\n      WebsocketService.sendMessage(\"audioMedia\", {\n        userID: myID,\n        audioOn: isUserAudioOn,\n      });\n      WebsocketService.sendMessage(\"videoMedia\", {\n        userID: myID,\n        videoOn: isUserVideoOn,\n      });\n      toast.info(`${getFullName(user.first_name, user.last_name)} joined`);\n    }\n  };\n\nexport const receive_returned_signal = (myID, peersRef) => (payload) => {\n  if (payload.usable_id === myID) {\n    const { peer } = peersRef.current[payload.id];\n    peer.signal(payload.signal);\n  }\n};\n\nexport const user_left_listener = (peersRef, setPeers) => (payload) => {\n  const user = payload.user;\n  if (peersRef.current[user.id]) {\n    peersRef.current[user.id].peer.destroy();\n  }\n  delete peersRef.current[user.id];\n  setPeers((peers) => {\n    const { [payload.user.id]: remove, ...rest } = peers;\n    return rest;\n  });\n  toast.info(`${getFullName(user.first_name, user.last_name)} left`);\n};\n\nexport const videoMediaListener = (peersRef, setPeers) => (payload) => {\n  const userID = payload.userID;\n  if (peersRef.current[userID]) {\n    peersRef.current[userID].user.videoOn = payload.videoOn;\n    setPeers((peers) => {\n      const { user, peer } = peers[userID];\n      return {\n        ...peers,\n        [userID]: { peer, user: { ...user, videoOn: payload.videoOn } },\n      };\n    });\n  }\n};\n\nexport const audioMediaListener = (peersRef, setPeers) => (payload) => {\n  const userID = payload.userID;\n  if (peersRef.current[userID]) {\n    peersRef.current[userID].user.audioOn = payload.audioOn;\n    setPeers((peers) => {\n      const { user, peer } = peers[userID];\n      return {\n        ...peers,\n        [userID]: { peer, user: { ...user, audioOn: payload.audioOn } },\n      };\n    });\n  }\n};\n\nexport const getPermissionListener = (myID, setAcceptStatus) => (payload) => {\n  if (payload.usable_id === myID) {\n    setAcceptStatus(payload.status);\n  }\n};\n\nexport const getPermissionRequestListener =\n  (myID, setWaitingUsers) => (payload) => {\n    if (payload.usable_id === myID) {\n      setWaitingUsers((users) => {\n        users.push(payload.user);\n        const newUsers = getUniqueArray(users, \"id\");\n        return newUsers;\n      });\n    }\n  };\n","import Peer from \"simple-peer\";\nimport WebsocketService from \"../components/WebsocketService\";\n\nexport function createPeer(userToSignal, callerID, stream) {\n  const peer = new Peer({\n    initiator: true,\n    trickle: false,\n    stream,\n  });\n  peer.on(\"signal\", (signal) => {\n    WebsocketService.sendMessage(\"sending signal\", {\n      userToSignal,\n      callerID,\n      signal,\n    });\n  });\n  return peer;\n}\n\nexport function addPeer(incomingSignal, callerID, stream) {\n  const peer = new Peer({\n    initiator: false,\n    trickle: false,\n    stream,\n  });\n  peer.on(\"signal\", (signal) => {\n    WebsocketService.sendMessage(\"returning signal\", { signal, callerID });\n  });\n  peer.signal(incomingSignal);\n  return peer;\n}\n","import { IconButton, makeStyles } from \"@material-ui/core\";\nimport React, { useEffect, useRef, useState } from \"react\";\nimport MicOffIcon from \"@material-ui/icons/MicOff\";\nimport Avatar from \"@material-ui/core/Avatar\";\n\nconst useStyles = makeStyles((theme) => ({\n  responsive: ({ size, rows }) => ({\n    float: \"left\",\n    width: `${100 / size}%`,\n    height: `${100 / rows}%`,\n    display: \"flex\",\n    alignItems: \"center\",\n  }),\n  videoTop: {\n    width: \"95%\",\n    paddingTop: \"min(calc(100vh - 9rem), 56.25%)\",\n    position: \"relative\",\n    overflow: \"hidden\",\n    background: theme.palette.background.paper,\n    margin: \"auto\",\n    borderRadius: \"1rem\",\n  },\n  micOff: {\n    position: \"absolute\",\n    right: 0,\n    top: 0,\n  },\n  videoOff: {\n    position: \"absolute\",\n    width: \"100%\",\n    height: \"100%\",\n    top: 0,\n    left: 0,\n    display: \"flex\",\n    justifyContent: \"center\",\n    alignItems: \"center\",\n  },\n  avatar: {\n    width: \"min(50%, 10rem)\",\n    height: \"min(50%, 10rem)\",\n    fontSize: \"3rem\",\n  },\n}));\n\nconst Video = React.forwardRef(\n  ({ peer, muted, size, rows, isUserVideo, user }, ref) => {\n    const localRef = useRef(null);\n    const currentRef = ref || localRef;\n    const classes = useStyles({ size, rows });\n    let initials =\n      (user.first_name ? user.first_name[0].toUpperCase() : \"\") +\n      (user.last_name ? user.last_name[0].toUpperCase() : \"\");\n    useEffect(() => {\n      if (peer) {\n        peer.on(\"stream\", (stream) => {\n          currentRef.current.srcObject = stream;\n        });\n      }\n    }, []);\n    return (\n      <div className={classes.responsive}>\n        <div className={classes.videoTop}>\n          <video\n            style={{\n              objectFit: \"contain\",\n              transform: isUserVideo ? \"scaleX(-1)\" : 1,\n              position: \"absolute\",\n              top: \"0\",\n              left: \"0\",\n              display: user.videoOn ? \"block\" : \"none\",\n            }}\n            playsInline\n            width=\"100%\"\n            height=\"100%\"\n            autoPlay\n            muted={muted}\n            ref={currentRef}\n          />\n          {!user.audioOn && (\n            <IconButton className={classes.micOff}>\n              <MicOffIcon />\n            </IconButton>\n          )}\n          {!user.videoOn && (\n            <div className={classes.videoOff}>\n              <Avatar className={classes.avatar}>{initials}</Avatar>\n            </div>\n          )}\n        </div>\n      </div>\n    );\n  }\n);\n\nexport default Video;\n","import { Grid, IconButton, makeStyles, Paper } from \"@material-ui/core\";\nimport React from \"react\";\nimport { red } from \"@material-ui/core/colors\";\nimport MicIcon from \"@material-ui/icons/Mic\";\nimport CallEndIcon from \"@material-ui/icons/CallEnd\";\nimport MicOffIcon from \"@material-ui/icons/MicOff\";\nimport VideocamOutlinedIcon from \"@material-ui/icons/VideocamOutlined\";\nimport VideocamOffOutlinedIcon from \"@material-ui/icons/VideocamOffOutlined\";\nimport MessageOutlinedIcon from \"@material-ui/icons/MessageOutlined\";\nimport FlipCameraIosOutlinedIcon from \"@material-ui/icons/FlipCameraIosOutlined\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { toggleAudio, toggleVideo } from \"../../redux/actions/roomActions\";\nimport { useHistory } from \"react-router\";\n\nconst useStyles = makeStyles((theme) => ({\n  container: {\n    minHeight: \"3rem\",\n    flexGrow: 0,\n    background: theme.palette.background.default,\n  },\n  blue: { background: \"blue\" },\n  orange: {\n    color: red[500],\n  },\n  right: { marginRight: \"1rem\" },\n}));\n\nconst Controls = ({ switchc, toggleChat }) => {\n  const classes = useStyles();\n  const dispatch = useDispatch();\n  const isAudioOn = useSelector((state) => state.roomReducer.userVideo.audioOn);\n  const isVideoOn = useSelector((state) => state.roomReducer.userVideo.videoOn);\n  const history = useHistory();\n  const leftRoom = () => {\n    history.replace(\"/\");\n  };\n  return (\n    <Paper elevation={3} className={classes.container}>\n      <Grid\n        justify=\"space-between\"\n        container\n        alignItems=\"center\"\n        style={{ height: \"100%\" }}\n      >\n        <div>\n          <IconButton\n            color=\"inherit\"\n            onClick={() => {\n              switchc();\n            }}\n          >\n            <FlipCameraIosOutlinedIcon />\n          </IconButton>\n        </div>\n        <div>\n          <IconButton\n            color=\"inherit\"\n            onClick={() => {\n              dispatch(toggleAudio());\n            }}\n          >\n            {isAudioOn ? <MicIcon /> : <MicOffIcon />}\n          </IconButton>\n          <IconButton color=\"inherit\" onClick={leftRoom}>\n            <CallEndIcon className={classes.orange} />\n          </IconButton>\n          <IconButton\n            color=\"inherit\"\n            onClick={() => {\n              dispatch(toggleVideo());\n            }}\n          >\n            {isVideoOn ? <VideocamOutlinedIcon /> : <VideocamOffOutlinedIcon />}\n          </IconButton>\n        </div>\n        <div className={classes.right}>\n          <IconButton onClick={toggleChat}>\n            <MessageOutlinedIcon />\n          </IconButton>\n        </div>\n      </Grid>\n    </Paper>\n  );\n};\n\nexport default Controls;\n","import React, { useCallback, useEffect, useState } from \"react\";\nimport Drawer from \"@material-ui/core/Drawer\";\nimport { makeStyles, useTheme } from \"@material-ui/core/styles\";\nimport { IconButton } from \"@material-ui/core\";\nimport ChevronRightIcon from \"@material-ui/icons/ChevronRight\";\nimport WebSocketService from \"../WebsocketService\";\nimport TextField from \"@material-ui/core/TextField\";\nimport { Send } from \"@material-ui/icons\";\nimport InputAdornment from \"@material-ui/core/InputAdornment\";\nimport { useSelector } from \"react-redux\";\nimport \"./chat.css\";\nconst drawerWidth = 360;\n\nconst useStyles = makeStyles((theme) => ({\n  drawer: {\n    width: drawerWidth,\n    flexShrink: 0,\n  },\n  drawerPaper: {\n    width: drawerWidth,\n    height: \"calc(100vh - 9rem)\",\n    borderRadius: \"1rem\",\n    top: \"5rem\",\n    right: \"12px\",\n  },\n  drawerHeader: {\n    display: \"flex\",\n    alignItems: \"center\",\n    padding: theme.spacing(0, 1),\n    ...theme.mixins.toolbar,\n    justifyContent: \"flex-start\",\n  },\n  chatInputContainer: {\n    marginTop: \"auto\",\n  },\n  chatInput: {\n    marginBottom: \"2rem\",\n    \"& .MuiFilledInput-root\": {\n      borderRadius: \"50px\",\n      borderBottom: 0,\n      paddingTop: \"15px\",\n      paddingBottom: \"15px\",\n      \"&::before\": { borderBottom: 0 },\n    },\n  },\n  messageBoxRight: {\n    background: theme.palette.background.paper,\n    color: theme.palette.text.primary,\n  },\n  messageBoxLeft: {\n    background: \"#4870df\",\n    color: theme.palette.background.default,\n  },\n  messageSender: {\n    color: theme.palette.text.primary,\n    fontSize: \"10px\",\n  },\n}));\n\nconst MessageItem = (props) => {\n  const theme = useTheme();\n  const owner = useSelector((state) => state.userReducer.user);\n  const classes = useStyles();\n  let messagePosition =\n    owner.pk === props.sender.id\n      ? `chatApp__convMessageItem--right`\n      : `chatApp__convMessageItem--left`;\n  let messageBackground =\n    owner.pk === props.sender.id\n      ? classes.messageBoxRight\n      : classes.messageBoxLeft;\n  return (\n    <div\n      className={\"chatApp__convMessageItem \" + messagePosition + \" clearfix\"}\n    >\n      <div className={`chatApp__convMessageValue ${messageBackground}`}>\n        {owner.pk !== props.sender.id && (\n          <div className={classes.messageSender}>{props.sender.first_name}</div>\n        )}\n        <div>{props.message}</div>\n      </div>\n    </div>\n  );\n};\n\nconst MessageList = React.memo((props) => {\n  return (\n    <div className={\"chatApp__convTimeline\"}>\n      {props.messages\n        .slice(0)\n        .reverse()\n        .map((messageItem, idx) => (\n          <MessageItem\n            key={idx}\n            sender={messageItem.sender}\n            senderAvatar={messageItem.senderAvatar}\n            message={messageItem.message}\n          />\n        ))}\n    </div>\n  );\n});\n\nconst Chat = ({ open, setOpen }) => {\n  const [messages, setMessages] = useState([]);\n  const [currMessage, setCurrMessage] = useState(\"\");\n  const classes = useStyles();\n  useEffect(() => {\n    WebSocketService.on(\"receive new message\", (data) => {\n      setMessages((messages) => [...messages, data]);\n    });\n  }, []);\n  const sendMessage = () => {\n    WebSocketService.sendMessage(\"send new message\", currMessage);\n    setCurrMessage(\"\");\n  };\n\n  const onCurrMessageChanged = useCallback((e) => {\n    const val = e.target.value;\n    setCurrMessage(val);\n  }, []);\n  return (\n    <Drawer\n      className={classes.drawer}\n      variant=\"persistent\"\n      anchor=\"right\"\n      open={open}\n      classes={{\n        paper: classes.drawerPaper,\n      }}\n    >\n      <div className={classes.drawerHeader}>\n        <IconButton\n          onClick={() => {\n            setOpen(false);\n          }}\n        >\n          <ChevronRightIcon />\n        </IconButton>\n      </div>\n      <MessageList messages={messages} />\n      <div className={classes.chatInputContainer}>\n        <TextField\n          placeholder=\"send a message to everyone\"\n          size=\"small\"\n          variant=\"filled\"\n          fullWidth\n          multiline\n          rowsMax={4}\n          className={classes.chatInput}\n          value={currMessage}\n          onChange={onCurrMessageChanged}\n          InputProps={{\n            endAdornment: (\n              <InputAdornment position=\"end\">\n                {currMessage.length > 0 && (\n                  <IconButton\n                    aria-label=\"toggle password visibility\"\n                    onClick={sendMessage}\n                  >\n                    <Send />\n                  </IconButton>\n                )}\n              </InputAdornment>\n            ),\n          }}\n        />\n      </div>\n    </Drawer>\n  );\n};\n\nexport default Chat;\n","import { IconButton } from \"@material-ui/core\";\nimport React from \"react\";\nimport { Modal, Row, Col } from \"react-bootstrap\";\nimport CloseIcon from \"@material-ui/icons/Close\";\nimport CheckIcon from \"@material-ui/icons/Check\";\nimport { makeStyles } from \"@material-ui/styles\";\nimport WebSocketInstance from \"../WebsocketService\";\n\nconst useStyles = makeStyles((theme) => ({\n  modal: {\n    \"&& .modal-content\": {\n      background: theme.palette.background.paper,\n      color: theme.palette.text.primary,\n    },\n  },\n}));\n\nconst JoinModal = ({ waitingUsers, setWaitingUsers }) => {\n  const classes = useStyles();\n  const rejectUser = (user) => {\n    WebSocketInstance.sendMessage(\"give join permission status\", {\n      userID: user.id,\n      status: \"reject\",\n    });\n    setWaitingUsers((users) => users.filter((el) => el.id !== user.id));\n  };\n  const acceptUser = (user) => {\n    WebSocketInstance.sendMessage(\"give join permission status\", {\n      userID: user.id,\n      status: \"accept\",\n    });\n    setWaitingUsers((users) => users.filter((el) => el.id !== user.id));\n  };\n  return (\n    <Modal\n      show={Boolean(waitingUsers.length)}\n      onHide={() => {}}\n      backdrop=\"static\"\n      keyboard={false}\n      className={classes.modal}\n    >\n      <Modal.Header>\n        <Modal.Title>Modal title</Modal.Title>\n      </Modal.Header>\n      <Modal.Body>\n        {waitingUsers.map((user, idx) => (\n          <Row key={idx} style={{ alignItems: \"center\" }}>\n            <Col>{user.first_name} wants to join</Col>\n            <IconButton\n              onClick={() => {\n                rejectUser(user);\n              }}\n            >\n              <CloseIcon />\n            </IconButton>\n            <IconButton\n              onClick={() => {\n                acceptUser(user);\n              }}\n            >\n              <CheckIcon />\n            </IconButton>\n          </Row>\n        ))}\n      </Modal.Body>\n      <Modal.Footer></Modal.Footer>\n    </Modal>\n  );\n};\n\nexport default JoinModal;\n","export const updateStream = (peersRef, setPeers, userStream) => (stream) => {\n  for (let key in peersRef.current) {\n    // peersRef.current[key].removeTrack(\n    //   // userStream.getVideoTracks()[0],\n    //   peersRef.current[key].streams[0].getVideoTracks()[0],\n    //   userStream\n    // );\n    // peersRef.current[key].addTrack(stream.getVideoTracks()[0], userStream);\n    // peersRef.current[key]._pc.getSenders().forEach((sender) => {\n    //   if (sender.track.type === \"video\") {\n    //     sender.replaceTrack(userStream.getVideoTracks()[0]);\n    //   }\n    // });\n    peersRef.current[key].peer.streams.forEach((stream) => {\n      stream.getTracks().forEach((track) => {\n        track.stop();\n      });\n    });\n  }\n  setPeers({ ...peersRef.current });\n  userStream.removeTrack(userStream.getVideoTracks()[0]);\n  userStream.addTrack(stream.getVideoTracks()[0]);\n};\n\nexport const switchCamera = (videoConstraints) => async (currentCameraRef) => {\n  const devices = await navigator.mediaDevices.enumerateDevices();\n  const videoDevices = devices.filter((device) => device.kind === \"videoinput\");\n  currentCameraRef.current =\n    (currentCameraRef.current + 1) % videoDevices.length;\n\n  const updatedConstraints = {\n    ...videoConstraints,\n    deviceId: {\n      exact: videoDevices[currentCameraRef.current].deviceId,\n    },\n  };\n  videoConstraints = updatedConstraints;\n\n  const stream = await navigator.mediaDevices.getUserMedia({\n    video: videoConstraints,\n    audio: true,\n  });\n  updateStream(stream);\n};\n\nexport const shareScreen = (peersRef, userStream) => () => {\n  navigator.mediaDevices\n    .getDisplayMedia({ cursor: true })\n    .then((screenStream) => {\n      // const temp = {};\n      Object.keys(peersRef.current).forEach((key) => {\n        // let peer = peersRef.current[key];\n        peersRef.current[key].replaceTrack(\n          userStream.getVideoTracks()[0],\n          screenStream.getVideoTracks()[0],\n          userStream\n        );\n        // temp[key] = peer;\n      });\n    });\n};\n","import React, { useEffect, useRef, useState } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport WebsocketService from \"../components/WebsocketService\";\nimport { useParams } from \"react-router\";\nimport Video from \"../components/common/Video\";\nimport Controls from \"../components/Room/Controls\";\nimport { split } from \"../helper/utilFunctions\";\nimport Chat from \"../components/Room/Chat\";\nimport { makeStyles } from \"@material-ui/core\";\nimport {\n  all_users_listener,\n  user_joined_listener,\n  user_left_listener,\n  receive_returned_signal,\n  videoMediaListener,\n  audioMediaListener,\n  getPermissionRequestListener,\n} from \"../helper/socketListeners\";\nimport JoinModal from \"../components/Room/JoinModal\";\nimport { switchCamera } from \"../helper/unusedFunctions\";\nimport { getIsUserCreator, getRoom } from \"../redux/actions/roomActions\";\n\nlet videoConstraints = {\n  height: window.innerHeight / 2,\n  width: window.innerWidth / 2,\n};\n\nconst useStyles = makeStyles((theme) => ({\n  container: {\n    display: \"flex\",\n    height: \"100%\",\n    width: \"100%\",\n    flexDirection: \"column\",\n    background: theme.palette.background.default,\n  },\n}));\n\nconst socketFunctions = (\n  peersRef,\n  myID,\n  stream,\n  setPeers,\n  isUserAudioOn,\n  isUserVideoOn,\n  setWaitingUsers\n) => {\n  WebsocketService.on(\n    \"all users\",\n    all_users_listener(peersRef, myID, stream, setPeers)\n  );\n  WebsocketService.on(\n    \"user joined\",\n    user_joined_listener(\n      myID,\n      peersRef,\n      stream,\n      setPeers,\n      isUserAudioOn,\n      isUserVideoOn\n    )\n  );\n\n  WebsocketService.on(\n    \"receiving returned signal\",\n    receive_returned_signal(myID, peersRef)\n  );\n\n  WebsocketService.on(\"user left\", user_left_listener(peersRef, setPeers));\n\n  WebsocketService.on(\"videoMedia\", videoMediaListener(peersRef, setPeers));\n\n  WebsocketService.on(\"audioMedia\", audioMediaListener(peersRef, setPeers));\n  WebsocketService.on(\n    \"user want to join\",\n    getPermissionRequestListener(myID, setWaitingUsers)\n  );\n};\n\nconst Room = () => {\n  const { roomID } = useParams();\n  const [peers, setPeers] = useState({});\n  const userVideo = useRef();\n  const socketRef = useRef(WebsocketService);\n  const peersRef = useRef({});\n  const myID = useSelector((state) => state.userReducer.user.pk);\n  const [userStream, setUserStream] = useState();\n  const currentCameraRef = useRef(0);\n  let sizeMap = split(Object.keys(peers).length + 1);\n  const [chatOpen, setChatOpen] = useState(false);\n  const isUserAudioOn = useSelector(\n    (state) => state.roomReducer.userVideo.audioOn\n  );\n  const isUserVideoOn = useSelector(\n    (state) => state.roomReducer.userVideo.videoOn\n  );\n  const classes = useStyles();\n  const me = useSelector((state) => state.userReducer.user);\n  const [waitingUsers, setWaitingUsers] = useState([]);\n  const dispatch = useDispatch();\n\n  const setCameraStream = async () => {\n    const stream = await navigator.mediaDevices.getUserMedia({\n      video: videoConstraints,\n      audio: true,\n    });\n    setUserStream(stream);\n    if (userVideo && userVideo.current) {\n      userVideo.current.srcObject = stream;\n    }\n  };\n\n  const socketConnect = async () => {\n    await setCameraStream();\n    socketRef.current.sendMessage(\"join room\", roomID);\n  };\n\n  useEffect(() => {\n    dispatch(getIsUserCreator(roomID));\n    dispatch(getRoom(roomID));\n    socketConnect();\n  }, []);\n\n  useEffect(() => {\n    socketFunctions(\n      peersRef,\n      myID,\n      userStream,\n      setPeers,\n      isUserAudioOn,\n      isUserVideoOn,\n      setWaitingUsers\n    );\n  }, [userStream, isUserAudioOn, isUserVideoOn, myID]);\n\n  useEffect(() => {\n    let userStreamRef = userStream;\n    return () => {\n      if (userStreamRef) {\n        userStreamRef.getVideoTracks().forEach((track) => {\n          track.stop();\n        });\n        userStreamRef.getAudioTracks().forEach((track) => {\n          track.stop();\n        });\n      }\n    };\n  }, [userStream]);\n\n  useEffect(() => {\n    if (userStream) {\n      userStream.getAudioTracks()[0].enabled = isUserAudioOn;\n      if (socketRef.current.state() === 1) {\n        socketRef.current.sendMessage(\"audioMedia\", {\n          userID: myID,\n          audioOn: isUserAudioOn,\n        });\n      }\n    }\n  }, [userStream, isUserAudioOn, myID]);\n\n  useEffect(() => {\n    if (userStream) {\n      userStream.getVideoTracks()[0].enabled = isUserVideoOn;\n      if (socketRef.current.state() === 1) {\n        socketRef.current.sendMessage(\"videoMedia\", {\n          userID: myID,\n          videoOn: isUserVideoOn,\n        });\n      }\n    }\n  }, [userStream, isUserVideoOn, myID]);\n\n  useEffect(() => {\n    sizeMap = split(Object.keys(peers).length + 1);\n  }, [peers]);\n\n  return (\n    <div className={classes.container}>\n      <div\n        style={{\n          display: \"flex\",\n          width: \"100%\",\n          maxHeight: \"calc(100vh - 7rem)\",\n          margin: \"auto\",\n          flexGrow: \"1\",\n          flexWrap: \"wrap\",\n        }}\n      >\n        <Video\n          muted\n          ref={userVideo}\n          user={{ ...me, videoOn: isUserVideoOn, audioOn: isUserAudioOn }}\n          autoPlay\n          playsInline\n          size={sizeMap[1]}\n          rows={sizeMap[\"rows\"]}\n          isUserVideo\n        />\n        {Object.values(peersRef.current).map((item, index) => {\n          return (\n            <Video\n              key={index}\n              peer={item.peer}\n              user={item.user}\n              size={sizeMap[index + 2]}\n              rows={sizeMap[\"rows\"]}\n            />\n          );\n        })}\n      </div>\n      <JoinModal\n        waitingUsers={waitingUsers}\n        setWaitingUsers={setWaitingUsers}\n      />\n      <Controls\n        switchc={() => {\n          switchCamera(videoConstraints)(currentCameraRef);\n        }}\n        toggleChat={() => {\n          setChatOpen((open) => !open);\n        }}\n      />\n      <Chat open={chatOpen} setOpen={setChatOpen} />\n    </div>\n  );\n};\n\nexport default Room;\n"],"sourceRoot":""}