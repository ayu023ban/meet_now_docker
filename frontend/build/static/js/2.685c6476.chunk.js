(this.webpackJsonpteams_frontend=this.webpackJsonpteams_frontend||[]).push([[2],{186:function(e,t,n){"use strict";var r=n(195),c=n(196),a=function(){function e(){Object(r.a)(this,e),this.callbacks={},this.socketRef=null,this.fallback=null,this.forcedClose=!1}return Object(c.a)(e,[{key:"connect",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};this.forcedClose=!1,this.fallback=n,this.socketRef=new WebSocket(e),this.socketRef.onopen=function(){console.log("websocket open")},this.socketRef.onmessage=function(e){t.socketNewMessage(e.data)},this.socketRef.onerror=function(e){console.debug(e)},this.socketRef.onclose=function(r){console.log(r),4e3===r.code?t.fallback(r):t.forcedClose?console.log("websocket closed"):(console.log("websockets closed lets reopen"),setTimeout((function(){t.connect(e,n(r))}),5e3))}}},{key:"close",value:function(e,t){"undefined"==typeof e&&(e=1e3),this.forcedClose=!0,this.socketRef&&this.socketRef.close(e,t)}},{key:"on",value:function(e,t){this.callbacks[e]=t}},{key:"socketNewMessage",value:function(e){var t=JSON.parse(e),n=t.command,r=t.data;0!==Object.keys(this.callbacks).length&&(console.log(t),this.callbacks[n]&&this.callbacks[n](r))}},{key:"sendMessage",value:function(e,t){try{this.waitForConnection(function(){console.log(JSON.stringify({type:e,data:t})),this.socketRef.send(JSON.stringify({type:e,data:t}))}.bind(this),1e3)}catch(n){console.log(n.message)}}},{key:"refresh",value:function(){this.socketRef&&this.socketRef.close()}},{key:"state",value:function(){return this.socketRef.readyState}},{key:"waitForConnection",value:function(e,t){if(1===this.state())e();else{var n=this;setTimeout((function(){n.waitForConnection(e,t)}),t)}}}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}]),e}();a.instance=null;var i=a.getInstance();t.a=i},190:function(e,t,n){"use strict";n.d(t,"a",(function(){return s})),n.d(t,"d",(function(){return u})),n.d(t,"c",(function(){return d})),n.d(t,"e",(function(){return f})),n.d(t,"f",(function(){return l})),n.d(t,"b",(function(){return b}));var r=n(42),c=n(31),a=n(30),i=n(43),o=n(18),s=function(e){var t=i.a;return function(n){r.a.post(t,e).then((function(e){n(Object(o.a)(a.a,e.data)),navigator.clipboard.writeText(Object(o.d)(e.data.id)),c.b.success("copied to clipboard")})).catch((function(e){c.b.error("error occured in creating the room")}))}},u=function(){var e=i.c;return function(t){r.a.get(e).then((function(e){t(Object(o.a)(a.c,e.data))})).catch((function(e){c.b.error("error occured in fetching your rooms",{})}))}},d=function(e){var t="".concat(i.c).concat(e,"/");return function(e){r.a.get(t).then((function(t){e(Object(o.a)(a.b,t.data))}))}},f=function(){return function(e){e(Object(o.a)(a.e))}},l=function(){return function(e){e(Object(o.a)(a.f))}},b=function(e){var t=Object(i.g)(e);return function(e){r.a.get(t).then((function(t){console.log(t),e(Object(o.a)(a.d,t.data.isCreator))}))}}},206:function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return c}));var r=function(e){for(var t=Math.floor(Math.sqrt(e)),n=t-e%t,r=Math.floor(e/t),c=[],a=0;a<t;a++)a>=n?c.push(r+1):c.push(r);c=c.reverse();for(var i={},o=1,s=0,u=1;u<=e;u++)i[u]=c[s],++o>c[s]&&(o=1,s++);return i.rows=c.length,i};var c=function(e,t){return(e+" "+t).trim()}},218:function(e,t,n){"use strict";n.d(t,"a",(function(){return b})),n.d(t,"f",(function(){return j})),n.d(t,"e",(function(){return O})),n.d(t,"g",(function(){return h})),n.d(t,"h",(function(){return g})),n.d(t,"b",(function(){return p})),n.d(t,"c",(function(){return v})),n.d(t,"d",(function(){return m}));var r=n(36),c=n(281),a=n(34),i=n(4),o=n(31),s=n(186),u=n(206),d=n(18),f=n(240),l=n.n(f);var b=function(e,t,n,r){return function(c){e.current={};var a={};c.forEach((function(r){if(t!==r.id){var c=function(e,t,n){var r=new l.a({initiator:!0,trickle:!1,stream:n});return r.on("signal",(function(n){s.a.sendMessage("sending signal",{userToSignal:e,callerID:t,signal:n})})),r}(r.id,t,n);e.current[r.id]={user:r,peer:c},a[r.id]={user:r,peer:c}}})),r(a)}},j=function(e,t,n,r,c,d){return function(f){var b=f.callerUser;if(f.usable_id===e){var j=function(e,t,n){var r=new l.a({initiator:!1,trickle:!1,stream:n});return r.on("signal",(function(e){s.a.sendMessage("returning signal",{signal:e,callerID:t})})),r.signal(e),r}(f.signal,b.id,n);Boolean(t.current[b.id])||(t.current[b.id]={user:b,peer:j},r((function(e){return Object(i.a)(Object(i.a)({},e),{},Object(a.a)({},b.id,{user:b,peer:j}))}))),s.a.sendMessage("audioMedia",{userID:e,audioOn:c}),s.a.sendMessage("videoMedia",{userID:e,videoOn:d}),o.b.info("".concat(Object(u.a)(b.first_name,b.last_name)," joined"))}}},O=function(e,t){return function(n){n.usable_id===e&&t.current[n.id].peer.signal(n.signal)}},h=function(e,t){return function(n){var a=n.user;e.current[a.id]&&e.current[a.id].peer.destroy(),delete e.current[a.id],t((function(e){var t=n.user.id;e[t];return Object(r.a)(e,[t].map(c.a))})),o.b.info("".concat(Object(u.a)(a.first_name,a.last_name)," left"))}},g=function(e,t){return function(n){var r=n.userID;e.current[r]&&(e.current[r].user.videoOn=n.videoOn,t((function(e){var t=e[r],c=t.user,o=t.peer;return Object(i.a)(Object(i.a)({},e),{},Object(a.a)({},r,{peer:o,user:Object(i.a)(Object(i.a)({},c),{},{videoOn:n.videoOn})}))})))}},p=function(e,t){return function(n){var r=n.userID;e.current[r]&&(e.current[r].user.audioOn=n.audioOn,t((function(e){var t=e[r],c=t.user,o=t.peer;return Object(i.a)(Object(i.a)({},e),{},Object(a.a)({},r,{peer:o,user:Object(i.a)(Object(i.a)({},c),{},{audioOn:n.audioOn})}))})))}},v=function(e,t){return function(n){n.usable_id===e&&t(n.status)}},m=function(e,t){return function(n){n.usable_id===e&&t((function(e){return e.push(n.user),Object(d.c)(e,"id")}))}}},238:function(e,t,n){},264:function(e,t){},266:function(e,t){},278:function(e,t,n){"use strict";n.r(t);var r=n(4),c=n(203),a=n.n(c),i=n(204),o=n(40),s=n(0),u=n.n(s),d=n(14),f=n(186),l=n(10),b=n(175),j=n(180),O=n(205),h=n.n(O),g=n(184),p=n(2),v=Object(b.a)((function(e){return{responsive:function(e){var t=e.size,n=e.rows;return{float:"left",width:"".concat(100/t,"%"),height:"".concat(100/n,"%"),display:"flex",alignItems:"center"}},videoTop:{width:"95%",paddingTop:"min(calc(100vh - 9rem), 56.25%)",position:"relative",overflow:"hidden",background:e.palette.background.paper,margin:"auto",borderRadius:"1rem"},micOff:{position:"absolute",right:0,top:0},videoOff:{position:"absolute",width:"100%",height:"100%",top:0,left:0,display:"flex",justifyContent:"center",alignItems:"center"},avatar:{width:"min(50%, 10rem)",height:"min(50%, 10rem)",fontSize:"3rem"}}})),m=u.a.forwardRef((function(e,t){var n=e.peer,r=e.muted,c=e.size,a=e.rows,i=e.isUserVideo,o=e.user,u=Object(s.useRef)(null),d=t||u,f=v({size:c,rows:a}),l=(o.first_name?o.first_name[0].toUpperCase():"")+(o.last_name?o.last_name[0].toUpperCase():"");return Object(s.useEffect)((function(){n&&n.on("stream",(function(e){d.current.srcObject=e}))}),[]),Object(p.jsx)("div",{className:f.responsive,children:Object(p.jsxs)("div",{className:f.videoTop,children:[Object(p.jsx)("video",{style:{objectFit:"contain",transform:i?"scaleX(-1)":1,position:"absolute",top:"0",left:"0",display:o.videoOn?"block":"none"},playsInline:!0,width:"100%",height:"100%",autoPlay:!0,muted:r,ref:d}),!o.audioOn&&Object(p.jsx)(j.a,{className:f.micOff,children:Object(p.jsx)(h.a,{})}),!o.videoOn&&Object(p.jsx)("div",{className:f.videoOff,children:Object(p.jsx)(g.a,{className:f.avatar,children:l})})]})})})),x=n(140),k=n(230),w=n(66),y=n(233),I=n.n(y),M=n(234),R=n.n(M),C=n(235),_=n.n(C),N=n(236),T=n.n(N),S=n(237),D=n.n(S),E=n(232),B=n.n(E),U=n(190),V=Object(b.a)((function(e){return{container:{minHeight:"3rem",flexGrow:0,background:e.palette.background.default},blue:{background:"blue"},orange:{color:w.a[500]},right:{marginRight:"1rem"}}})),A=function(e){var t=e.switchc,n=e.toggleChat,r=V(),c=Object(d.b)(),a=Object(d.c)((function(e){return e.roomReducer.userVideo.audioOn})),i=Object(d.c)((function(e){return e.roomReducer.userVideo.videoOn})),o=Object(l.g)();return Object(p.jsx)(x.a,{elevation:3,className:r.container,children:Object(p.jsxs)(k.a,{justify:"space-between",container:!0,alignItems:"center",style:{height:"100%"},children:[Object(p.jsx)("div",{children:Object(p.jsx)(j.a,{color:"inherit",onClick:function(){t()},children:Object(p.jsx)(B.a,{})})}),Object(p.jsxs)("div",{children:[Object(p.jsx)(j.a,{color:"inherit",onClick:function(){c(Object(U.e)())},children:a?Object(p.jsx)(I.a,{}):Object(p.jsx)(h.a,{})}),Object(p.jsx)(j.a,{color:"inherit",onClick:function(){o.replace("/")},children:Object(p.jsx)(R.a,{className:r.orange})}),Object(p.jsx)(j.a,{color:"inherit",onClick:function(){c(Object(U.f)())},children:i?Object(p.jsx)(_.a,{}):Object(p.jsx)(T.a,{})})]}),Object(p.jsx)("div",{className:r.right,children:Object(p.jsx)(j.a,{onClick:n,children:Object(p.jsx)(D.a,{})})})]})})},z=n(206),H=n(58),F=n(313),W=n(48),J=n(239),P=n.n(J),G=n(310),L=n(304),q=n(303),X=(n(238),Object(b.a)((function(e){return{drawer:{width:360,flexShrink:0},drawerPaper:{width:360,height:"calc(100vh - 9rem)",borderRadius:"1rem",top:"5rem",right:"12px"},drawerHeader:Object(r.a)(Object(r.a)({display:"flex",alignItems:"center",padding:e.spacing(0,1)},e.mixins.toolbar),{},{justifyContent:"flex-start"}),chatInputContainer:{marginTop:"auto"},chatInput:{marginBottom:"2rem","& .MuiFilledInput-root":{borderRadius:"50px",borderBottom:0,paddingTop:"15px",paddingBottom:"15px","&::before":{borderBottom:0}}},messageBoxRight:{background:e.palette.background.paper,color:e.palette.text.primary},messageBoxLeft:{background:"#4870df",color:e.palette.background.default},messageSender:{color:e.palette.text.primary,fontSize:"10px"}}}))),K=function(e){Object(W.a)();var t=Object(d.c)((function(e){return e.userReducer.user})),n=X(),r=t.pk===e.sender.id?"chatApp__convMessageItem--right":"chatApp__convMessageItem--left",c=t.pk===e.sender.id?n.messageBoxRight:n.messageBoxLeft;return Object(p.jsx)("div",{className:"chatApp__convMessageItem "+r+" clearfix",children:Object(p.jsxs)("div",{className:"chatApp__convMessageValue ".concat(c),children:[t.pk!==e.sender.id&&Object(p.jsx)("div",{className:n.messageSender,children:e.sender.first_name}),Object(p.jsx)("div",{children:e.message})]})})},Q=u.a.memo((function(e){return Object(p.jsx)("div",{className:"chatApp__convTimeline",children:e.messages.slice(0).reverse().map((function(e,t){return Object(p.jsx)(K,{sender:e.sender,senderAvatar:e.senderAvatar,message:e.message},t)}))})})),Y=function(e){var t=e.open,n=e.setOpen,r=Object(s.useState)([]),c=Object(o.a)(r,2),a=c[0],i=c[1],u=Object(s.useState)(""),d=Object(o.a)(u,2),l=d[0],b=d[1],O=X();Object(s.useEffect)((function(){f.a.on("receive new message",(function(e){i((function(t){return[].concat(Object(H.a)(t),[e])}))}))}),[]);var h=Object(s.useCallback)((function(e){var t=e.target.value;b(t)}),[]);return Object(p.jsxs)(F.a,{className:O.drawer,variant:"persistent",anchor:"right",open:t,classes:{paper:O.drawerPaper},children:[Object(p.jsx)("div",{className:O.drawerHeader,children:Object(p.jsx)(j.a,{onClick:function(){n(!1)},children:Object(p.jsx)(P.a,{})})}),Object(p.jsx)(Q,{messages:a}),Object(p.jsx)("div",{className:O.chatInputContainer,children:Object(p.jsx)(G.a,{placeholder:"send a message to everyone",size:"small",variant:"filled",fullWidth:!0,multiline:!0,rowsMax:4,className:O.chatInput,value:l,onChange:h,InputProps:{endAdornment:Object(p.jsx)(q.a,{position:"end",children:l.length>0&&Object(p.jsx)(j.a,{"aria-label":"toggle password visibility",onClick:function(){f.a.sendMessage("send new message",l),b("")},children:Object(p.jsx)(L.a,{})})})}})})]})},Z=n(218),$=n(309),ee=n(305),te=n(306),ne=n(276),re=n.n(ne),ce=n(277),ae=n.n(ce),ie=n(141),oe=Object(ie.a)((function(e){return{modal:{"&& .modal-content":{background:e.palette.background.paper,color:e.palette.text.primary}}}})),se=function(e){var t=e.waitingUsers,n=e.setWaitingUsers,r=oe();return Object(p.jsxs)($.a,{show:Boolean(t.length),onHide:function(){},backdrop:"static",keyboard:!1,className:r.modal,children:[Object(p.jsx)($.a.Header,{children:Object(p.jsx)($.a.Title,{children:"Modal title"})}),Object(p.jsx)($.a.Body,{children:t.map((function(e,t){return Object(p.jsxs)(ee.a,{style:{alignItems:"center"},children:[Object(p.jsxs)(te.a,{children:[e.first_name," wants to join"]}),Object(p.jsx)(j.a,{onClick:function(){!function(e){f.a.sendMessage("give join permission status",{userID:e.id,status:"reject"}),n((function(t){return t.filter((function(t){return t.id!==e.id}))}))}(e)},children:Object(p.jsx)(re.a,{})}),Object(p.jsx)(j.a,{onClick:function(){!function(e){f.a.sendMessage("give join permission status",{userID:e.id,status:"accept"}),n((function(t){return t.filter((function(t){return t.id!==e.id}))}))}(e)},children:Object(p.jsx)(ae.a,{})})]},t)}))}),Object(p.jsx)($.a.Footer,{})]})},ue=function(e,t,n){return function(c){for(var a in e.current)e.current[a].peer.streams.forEach((function(e){e.getTracks().forEach((function(e){e.stop()}))}));t(Object(r.a)({},e.current)),n.removeTrack(n.getVideoTracks()[0]),n.addTrack(c.getVideoTracks()[0])}},de={height:window.innerHeight/2,width:window.innerWidth/2},fe=Object(b.a)((function(e){return{container:{display:"flex",height:"100%",width:"100%",flexDirection:"column",background:e.palette.background.default}}}));t.default=function(){var e=Object(l.i)().roomID,t=Object(s.useState)({}),n=Object(o.a)(t,2),c=n[0],u=n[1],b=Object(s.useRef)(),j=Object(s.useRef)(f.a),O=Object(s.useRef)({}),h=Object(d.c)((function(e){return e.userReducer.user.pk})),g=Object(s.useState)(),v=Object(o.a)(g,2),x=v[0],k=v[1],w=Object(s.useRef)(0),y=Object(z.b)(Object.keys(c).length+1),I=Object(s.useState)(!1),M=Object(o.a)(I,2),R=M[0],C=M[1],_=Object(d.c)((function(e){return e.roomReducer.userVideo.audioOn})),N=Object(d.c)((function(e){return e.roomReducer.userVideo.videoOn})),T=fe(),S=Object(d.c)((function(e){return e.userReducer.user})),D=Object(s.useState)([]),E=Object(o.a)(D,2),B=E[0],V=E[1],H=Object(d.b)(),F=function(){var e=Object(i.a)(a.a.mark((function e(){var t;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.getUserMedia({video:de,audio:!0});case 2:t=e.sent,k(t),b&&b.current&&(b.current.srcObject=t);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),W=function(){var t=Object(i.a)(a.a.mark((function t(){return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,F();case 2:j.current.sendMessage("join room",e);case 3:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return Object(s.useEffect)((function(){H(Object(U.b)(e)),H(Object(U.c)(e)),W()}),[]),Object(s.useEffect)((function(){!function(e,t,n,r,c,a,i){f.a.on("all users",Object(Z.a)(e,t,n,r)),f.a.on("user joined",Object(Z.f)(t,e,n,r,c,a)),f.a.on("receiving returned signal",Object(Z.e)(t,e)),f.a.on("user left",Object(Z.g)(e,r)),f.a.on("videoMedia",Object(Z.h)(e,r)),f.a.on("audioMedia",Object(Z.b)(e,r)),f.a.on("user want to join",Object(Z.d)(t,i))}(O,h,x,u,_,N,V)}),[x,_,N,h]),Object(s.useEffect)((function(){var e=x;return function(){e&&(e.getVideoTracks().forEach((function(e){e.stop()})),e.getAudioTracks().forEach((function(e){e.stop()})))}}),[x]),Object(s.useEffect)((function(){x&&(x.getAudioTracks()[0].enabled=_,1===j.current.state()&&j.current.sendMessage("audioMedia",{userID:h,audioOn:_}))}),[x,_,h]),Object(s.useEffect)((function(){x&&(x.getVideoTracks()[0].enabled=N,1===j.current.state()&&j.current.sendMessage("videoMedia",{userID:h,videoOn:N}))}),[x,N,h]),Object(s.useEffect)((function(){y=Object(z.b)(Object.keys(c).length+1)}),[c]),Object(p.jsxs)("div",{className:T.container,children:[Object(p.jsxs)("div",{style:{display:"flex",width:"100%",maxHeight:"calc(100vh - 7rem)",margin:"auto",flexGrow:"1",flexWrap:"wrap"},children:[Object(p.jsx)(m,{muted:!0,ref:b,user:Object(r.a)(Object(r.a)({},S),{},{videoOn:N,audioOn:_}),autoPlay:!0,playsInline:!0,size:y[1],rows:y.rows,isUserVideo:!0}),Object.values(O.current).map((function(e,t){return Object(p.jsx)(m,{peer:e.peer,user:e.user,size:y[t+2],rows:y.rows},t)}))]}),Object(p.jsx)(se,{waitingUsers:B,setWaitingUsers:V}),Object(p.jsx)(A,{switchc:function(){var e;(e=de,function(){var t=Object(i.a)(a.a.mark((function t(n){var c,i,o,s;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,navigator.mediaDevices.enumerateDevices();case 2:return c=t.sent,i=c.filter((function(e){return"videoinput"===e.kind})),n.current=(n.current+1)%i.length,o=Object(r.a)(Object(r.a)({},e),{},{deviceId:{exact:i[n.current].deviceId}}),e=o,t.next=9,navigator.mediaDevices.getUserMedia({video:e,audio:!0});case 9:s=t.sent,ue(s);case 11:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())(w)},toggleChat:function(){C((function(e){return!e}))}}),Object(p.jsx)(Y,{open:R,setOpen:C})]})}}}]);
//# sourceMappingURL=2.685c6476.chunk.js.map