{"version":3,"sources":["redux/actions/roomActions.js","components/WebsocketService.js","components/common/Video.js","components/Room/Controls.js","helper/utilFunctions.js","components/Room/Chat.js","helper/socketListeners.js","helper/peers.js","views/RoomView.js"],"names":["createNewRoom","data","url","create_room","dispatch","apiClient","post","then","res","apiDispatch","CREATE_ROOM","navigator","clipboard","writeText","getUrlFromCode","id","toast","success","catch","err","error","getRooms","get_room","get","GET_ROOMS","toggleAudio","TOGGLE_USER_AUDIO","toggleVideo","TOGGLE_USER_VIDEO","WebSocketService","callbacks","this","socketRef","fallback","forcedClose","chatroom_url","WebSocket","onopen","console","log","onmessage","e","socketNewMessage","onerror","debug","onclose","code","setTimeout","connect","reason","close","command","func","received_data","parsedData","JSON","parse","Object","keys","length","type","waitForConnection","send","stringify","bind","message","readyState","callback","interval","state","that","instance","WebSocketInstance","getInstance","useStyles","makeStyles","theme","responsive","size","rows","float","width","height","display","alignItems","videoTop","paddingTop","position","overflow","background","palette","paper","margin","borderRadius","micOff","right","top","videoOff","left","justifyContent","avatar","fontSize","Video","React","forwardRef","ref","peer","muted","isUserVideo","user","localRef","useRef","currentRef","classes","initials","first_name","toUpperCase","last_name","useEffect","on","stream","current","srcObject","className","style","objectFit","transform","videoOn","playsInline","autoPlay","audioOn","IconButton","Avatar","container","minHeight","flexGrow","default","blue","orange","color","red","marginRight","Controls","switchc","toggleChat","useDispatch","isAudioOn","useSelector","roomReducer","userVideo","isVideoOn","history","useHistory","Paper","elevation","Grid","justify","onClick","replace","split","x","n","Math","floor","sqrt","zp","pp","m","i","push","reverse","count","idx","getFullName","firstName","lastName","trim","drawer","flexShrink","drawerPaper","drawerHeader","padding","spacing","mixins","toolbar","chatInputContainer","marginTop","chatInput","marginBottom","borderBottom","paddingBottom","messageBoxRight","text","primary","messageBoxLeft","messageSender","MessageItem","props","useTheme","owner","userReducer","messagePosition","pk","sender","messageBackground","MessageList","memo","messages","slice","map","messageItem","senderAvatar","Chat","open","setOpen","useState","setMessages","currMessage","setCurrMessage","onCurrMessageChanged","useCallback","val","target","value","Drawer","variant","anchor","TextField","placeholder","fullWidth","multiline","rowsMax","onChange","InputProps","endAdornment","InputAdornment","aria-label","sendMessage","Send","all_users_listener","peersRef","myID","setPeers","users","temp","forEach","userToSignal","callerID","Peer","initiator","trickle","signal","WebsocketService","createPeer","user_joined_listener","isUserAudioOn","isUserVideoOn","payload","callerUser","usable_id","incomingSignal","addPeer","Boolean","peers","userID","info","videoConstraints","window","innerHeight","innerWidth","flexDirection","socketFunctions","receive_returned_signal","destroy","user_left_listener","videoMediaListener","audioMediaListener","Room","roomID","useParams","userStream","setUserStream","currentCameraRef","sizeMap","chatOpen","setChatOpen","me","setCameraStream","a","mediaDevices","getUserMedia","video","audio","updateStream","key","streams","getTracks","track","stop","removeTrack","getVideoTracks","addTrack","switchCamera","enumerateDevices","devices","videoDevices","filter","device","kind","updatedConstraints","deviceId","exact","socketConnect","refresh","location","hostname","websocketRef","userStreamRef","getAudioTracks","enabled","maxHeight","flexWrap","values","item","index"],"mappings":"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","file":"static/js/7.7c98a591.chunk.js","sourcesContent":["import apiClient from \"../../helper/apiclient\";\nimport { toast } from \"react-toastify\";\n\nimport {\n  CREATE_ROOM,\n  GET_ROOMS,\n  TOGGLE_USER_AUDIO,\n  TOGGLE_USER_VIDEO,\n} from \"./roomActionTypes\";\n\nimport { create_room, get_room, invite } from \"../../config/backend_api\";\n\nimport { apiDispatch, getUrlFromCode } from \"../../helper/helperFunctions\";\n\nexport const createNewRoom = (data) => {\n  const url = create_room;\n  return (dispatch) => {\n    apiClient\n      .post(url, data)\n      .then((res) => {\n        dispatch(apiDispatch(CREATE_ROOM, res.data));\n        navigator.clipboard.writeText(getUrlFromCode(res.data.id));\n        toast.success(\"copied to clipboard\");\n      })\n      .catch((err) => {\n        toast.error(`error occured in creating the room`);\n      });\n  };\n};\n\nexport const getRooms = () => {\n  const url = get_room;\n  return (dispatch) => {\n    apiClient\n      .get(url)\n      .then((res) => {\n        dispatch(apiDispatch(GET_ROOMS, res.data));\n      })\n      .catch((err) => {\n        toast.error(`error occured in fetching your rooms`, {});\n      });\n  };\n};\n\nexport const toggleAudio = () => {\n  return (dispatch) => {\n    dispatch(apiDispatch(TOGGLE_USER_AUDIO));\n  };\n};\nexport const toggleVideo = () => {\n  return (dispatch) => {\n    dispatch(apiDispatch(TOGGLE_USER_VIDEO));\n  };\n};\n\nexport const inviteUser = (roomId, data) => {\n  const url = invite(roomId);\n  return (dispatch) => {\n    apiClient\n      .post(url, data)\n      .then((res) => {\n        toast.success(\"user invited\");\n      })\n      .catch((err) => {\n        toast.error(err.data);\n      });\n  };\n};\n","class WebSocketService {\n  static instance = null;\n  callbacks = {};\n\n  static getInstance() {\n    if (!WebSocketService.instance) {\n      WebSocketService.instance = new WebSocketService();\n    }\n    return WebSocketService.instance;\n  }\n\n  constructor() {\n    this.socketRef = null;\n    this.fallback = null;\n    this.forcedClose = false;\n  }\n\n  connect(chatroom_url, fallback = () => {}) {\n    this.forcedClose = false;\n    this.fallback = fallback;\n    this.socketRef = new WebSocket(chatroom_url);\n\n    this.socketRef.onopen = () => {\n      console.log(\"websocket open\");\n    };\n\n    this.socketRef.onmessage = (e) => {\n      this.socketNewMessage(e.data);\n    };\n\n    this.socketRef.onerror = (e) => {\n      console.debug(e);\n    };\n\n    this.socketRef.onclose = (e) => {\n      if (e.code === 4000) {\n        this.fallback(e);\n      } else if (this.forcedClose) {\n        console.log(\"websocket closed\");\n      } else {\n        console.log(\"websockets closed lets reopen\");\n        setTimeout(() => {\n          this.connect(chatroom_url, fallback(e));\n        }, 5000);\n      }\n    };\n  }\n\n  close(code, reason) {\n    // Default CLOSE_NORMAL code\n    if (typeof code == \"undefined\") {\n      code = 1000;\n    }\n    this.forcedClose = true;\n    if (this.socketRef) {\n      this.socketRef.close(code, reason);\n    }\n  }\n  on(command, func) {\n    this.callbacks[command] = func;\n  }\n\n  socketNewMessage(received_data) {\n    const parsedData = JSON.parse(received_data);\n    const { command, data } = parsedData;\n    if (Object.keys(this.callbacks).length === 0) {\n      return;\n    }\n    if (this.callbacks[command]) {\n      this.callbacks[command](data);\n    }\n  }\n\n  sendMessage(type, data) {\n    try {\n      this.waitForConnection(\n        function () {\n          this.socketRef.send(JSON.stringify({ type, data }));\n        }.bind(this),\n        1000\n      );\n    } catch (err) {\n      console.log(err.message);\n    }\n  }\n  refresh() {\n    if (this.socketRef) {\n      this.socketRef.close();\n    }\n  }\n\n  state() {\n    return this.socketRef.readyState;\n  }\n  waitForConnection(callback, interval) {\n    if (this.state() === 1) {\n      callback();\n    } else {\n      var that = this;\n      // optional: implement backoff for interval here\n      setTimeout(function () {\n        that.waitForConnection(callback, interval);\n      }, interval);\n    }\n  }\n}\n\nconst WebSocketInstance = WebSocketService.getInstance();\n\nexport default WebSocketInstance;\n","import { IconButton, makeStyles } from \"@material-ui/core\";\nimport React, { useEffect, useRef, useState } from \"react\";\nimport MicOffIcon from \"@material-ui/icons/MicOff\";\nimport Avatar from \"@material-ui/core/Avatar\";\n\nconst useStyles = makeStyles((theme) => ({\n  responsive: ({ size, rows }) => ({\n    float: \"left\",\n    width: `${100 / size}%`,\n    height: `${100 / rows}%`,\n    display: \"flex\",\n    alignItems: \"center\",\n  }),\n  videoTop: {\n    width: \"95%\",\n    paddingTop: \"min(calc(100vh - 9rem), 56.25%)\",\n    position: \"relative\",\n    overflow: \"hidden\",\n    background: theme.palette.background.paper,\n    margin: \"auto\",\n    borderRadius: \"1rem\",\n  },\n  micOff: {\n    position: \"absolute\",\n    right: 0,\n    top: 0,\n  },\n  videoOff: {\n    position: \"absolute\",\n    width: \"100%\",\n    height: \"100%\",\n    top: 0,\n    left: 0,\n    display: \"flex\",\n    justifyContent: \"center\",\n    alignItems: \"center\",\n  },\n  avatar: {\n    width: \"min(50%, 10rem)\",\n    height: \"min(50%, 10rem)\",\n    fontSize: \"3rem\",\n  },\n}));\n\nconst Video = React.forwardRef(\n  ({ peer, muted, size, rows, isUserVideo, user }, ref) => {\n    const localRef = useRef(null);\n    const currentRef = ref || localRef;\n    const classes = useStyles({ size, rows });\n    let initials =\n      (user.first_name ? user.first_name[0].toUpperCase() : \"\") +\n      (user.last_name ? user.last_name[0].toUpperCase() : \"\");\n    useEffect(() => {\n      if (peer) {\n        peer.on(\"stream\", (stream) => {\n          currentRef.current.srcObject = stream;\n        });\n      }\n    }, []);\n    return (\n      <div className={classes.responsive}>\n        <div className={classes.videoTop}>\n          <video\n            style={{\n              objectFit: \"contain\",\n              transform: isUserVideo ? \"scaleX(-1)\" : 1,\n              position: \"absolute\",\n              top: \"0\",\n              left: \"0\",\n              display: user.videoOn ? \"block\" : \"none\",\n            }}\n            playsInline\n            width=\"100%\"\n            height=\"100%\"\n            autoPlay\n            muted={muted}\n            ref={currentRef}\n          />\n          {!user.audioOn && (\n            <IconButton className={classes.micOff}>\n              <MicOffIcon />\n            </IconButton>\n          )}\n          {!user.videoOn && (\n            <div className={classes.videoOff}>\n              <Avatar className={classes.avatar}>{initials}</Avatar>\n            </div>\n          )}\n        </div>\n      </div>\n    );\n  }\n);\n\nexport default Video;\n","import { Grid, IconButton, makeStyles, Paper } from \"@material-ui/core\";\nimport React from \"react\";\nimport { red } from \"@material-ui/core/colors\";\nimport MicIcon from \"@material-ui/icons/Mic\";\nimport CallEndIcon from \"@material-ui/icons/CallEnd\";\nimport MicOffIcon from \"@material-ui/icons/MicOff\";\nimport VideocamOutlinedIcon from \"@material-ui/icons/VideocamOutlined\";\nimport VideocamOffOutlinedIcon from \"@material-ui/icons/VideocamOffOutlined\";\nimport MessageOutlinedIcon from \"@material-ui/icons/MessageOutlined\";\nimport FlipCameraIosOutlinedIcon from \"@material-ui/icons/FlipCameraIosOutlined\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { toggleAudio, toggleVideo } from \"../../redux/actions/roomActions\";\nimport { useHistory } from \"react-router\";\n\nconst useStyles = makeStyles((theme) => ({\n  container: {\n    minHeight: \"3rem\",\n    flexGrow: 0,\n    background: theme.palette.background.default,\n  },\n  blue: { background: \"blue\" },\n  orange: {\n    color: red[500],\n  },\n  right: { marginRight: \"1rem\" },\n}));\n\nconst Controls = ({ switchc, toggleChat }) => {\n  const classes = useStyles();\n  const dispatch = useDispatch();\n  const isAudioOn = useSelector((state) => state.roomReducer.userVideo.audioOn);\n  const isVideoOn = useSelector((state) => state.roomReducer.userVideo.videoOn);\n  const history = useHistory();\n  const leftRoom = () => {\n    history.replace(\"/\");\n  };\n  return (\n    <Paper elevation={3} className={classes.container}>\n      <Grid\n        justify=\"space-between\"\n        container\n        alignItems=\"center\"\n        style={{ height: \"100%\" }}\n      >\n        <div>\n          <IconButton\n            color=\"inherit\"\n            onClick={() => {\n              switchc();\n            }}\n          >\n            <FlipCameraIosOutlinedIcon />\n          </IconButton>\n        </div>\n        <div>\n          <IconButton\n            color=\"inherit\"\n            onClick={() => {\n              dispatch(toggleAudio());\n            }}\n          >\n            {isAudioOn ? <MicIcon /> : <MicOffIcon />}\n          </IconButton>\n          <IconButton color=\"inherit\" onClick={leftRoom}>\n            <CallEndIcon className={classes.orange} />\n          </IconButton>\n          <IconButton\n            color=\"inherit\"\n            onClick={() => {\n              dispatch(toggleVideo());\n            }}\n          >\n            {isVideoOn ? <VideocamOutlinedIcon /> : <VideocamOffOutlinedIcon />}\n          </IconButton>\n        </div>\n        <div className={classes.right}>\n          <IconButton onClick={toggleChat}>\n            <MessageOutlinedIcon />\n          </IconButton>\n        </div>\n      </Grid>\n    </Paper>\n  );\n};\n\nexport default Controls;\n","export const split = (x) => {\n  let n = Math.floor(Math.sqrt(x));\n  let zp = n - (x % n);\n  let pp = Math.floor(x / n);\n  let m = [];\n  for (let i = 0; i < n; i++) {\n    if (i >= zp) {\n      m.push(pp + 1);\n    } else {\n      m.push(pp);\n    }\n  }\n  m = m.reverse();\n  let res = {};\n  let count = 1;\n  let idx = 0;\n  for (let i = 1; i <= x; i++) {\n    res[i] = m[idx];\n    count++;\n    if (count > m[idx]) {\n      count = 1;\n      idx++;\n    }\n  }\n  res[\"rows\"] = m.length;\n  return res;\n};\n\nexport function detectURL(message) {\n  var urlRegex = /(((https?:\\/\\/)|(www\\.))[^\\s]+)/g;\n  return message.replace(urlRegex, function (urlMatch) {\n    return `<a href=${urlMatch} target=\"_blank\" >${urlMatch}</a>`;\n  });\n}\nexport function sanitize(string) {\n  const map = {\n    \"&\": \"&amp;\",\n    \"<\": \"&lt;\",\n    \">\": \"&gt;\",\n    '\"': \"&quot;\",\n    \"'\": \"&#x27;\",\n    \"/\": \"&#x2F;\",\n  };\n  const reg = /[&<>\"'/]/gi;\n  return string.replace(reg, (match) => map[match]);\n}\n\nexport const getFullName = (firstName, lastName) => {\n  const fullName = firstName + \" \" + lastName;\n  return fullName.trim();\n};\n","import React, { useCallback, useEffect, useState } from \"react\";\nimport Drawer from \"@material-ui/core/Drawer\";\nimport { makeStyles, useTheme } from \"@material-ui/core/styles\";\nimport { IconButton } from \"@material-ui/core\";\nimport ChevronRightIcon from \"@material-ui/icons/ChevronRight\";\nimport WebSocketService from \"../WebsocketService\";\nimport TextField from \"@material-ui/core/TextField\";\nimport { Send } from \"@material-ui/icons\";\nimport InputAdornment from \"@material-ui/core/InputAdornment\";\nimport { useSelector } from \"react-redux\";\nimport \"./chat.css\";\nconst drawerWidth = 360;\n\nconst useStyles = makeStyles((theme) => ({\n  drawer: {\n    width: drawerWidth,\n    flexShrink: 0,\n  },\n  drawerPaper: {\n    width: drawerWidth,\n    height: \"calc(100vh - 9rem)\",\n    borderRadius: \"1rem\",\n    top: \"5rem\",\n    right: \"12px\",\n  },\n  drawerHeader: {\n    display: \"flex\",\n    alignItems: \"center\",\n    padding: theme.spacing(0, 1),\n    ...theme.mixins.toolbar,\n    justifyContent: \"flex-start\",\n  },\n  chatInputContainer: {\n    marginTop: \"auto\",\n  },\n  chatInput: {\n    marginBottom: \"2rem\",\n    \"& .MuiFilledInput-root\": {\n      borderRadius: \"50px\",\n      borderBottom: 0,\n      paddingTop: \"15px\",\n      paddingBottom: \"15px\",\n      \"&::before\": { borderBottom: 0 },\n    },\n  },\n  messageBoxRight: {\n    background: theme.palette.background.paper,\n    color: theme.palette.text.primary,\n  },\n  messageBoxLeft: {\n    background: \"#4870df\",\n    color: theme.palette.background.default,\n  },\n  messageSender: {\n    color: theme.palette.text.primary,\n    fontSize: \"10px\",\n  },\n}));\n\nconst MessageItem = (props) => {\n  const theme = useTheme();\n  const owner = useSelector((state) => state.userReducer.user);\n  const classes = useStyles();\n  let messagePosition =\n    owner.pk === props.sender.id\n      ? `chatApp__convMessageItem--right`\n      : `chatApp__convMessageItem--left`;\n  let messageBackground =\n    owner.pk === props.sender.id\n      ? classes.messageBoxRight\n      : classes.messageBoxLeft;\n  return (\n    <div\n      className={\"chatApp__convMessageItem \" + messagePosition + \" clearfix\"}\n    >\n      <div className={`chatApp__convMessageValue ${messageBackground}`}>\n        {owner.pk !== props.sender.id && (\n          <div className={classes.messageSender}>{props.sender.first_name}</div>\n        )}\n        <div>{props.message}</div>\n      </div>\n    </div>\n  );\n};\n\nconst MessageList = React.memo((props) => {\n  return (\n    <div className={\"chatApp__convTimeline\"}>\n      {props.messages\n        .slice(0)\n        .reverse()\n        .map((messageItem, idx) => (\n          <MessageItem\n            key={idx}\n            sender={messageItem.sender}\n            senderAvatar={messageItem.senderAvatar}\n            message={messageItem.message}\n          />\n        ))}\n    </div>\n  );\n});\n\nconst Chat = ({ open, setOpen }) => {\n  const [messages, setMessages] = useState([]);\n  const [currMessage, setCurrMessage] = useState(\"\");\n  const classes = useStyles();\n  useEffect(() => {\n    WebSocketService.on(\"receive new message\", (data) => {\n      setMessages((messages) => [...messages, data]);\n    });\n  }, []);\n  const sendMessage = () => {\n    WebSocketService.sendMessage(\"send new message\", currMessage);\n    setCurrMessage(\"\");\n  };\n\n  const onCurrMessageChanged = useCallback((e) => {\n    const val = e.target.value;\n    setCurrMessage(val);\n  }, []);\n  return (\n    <Drawer\n      className={classes.drawer}\n      variant=\"persistent\"\n      anchor=\"right\"\n      open={open}\n      classes={{\n        paper: classes.drawerPaper,\n      }}\n    >\n      <div className={classes.drawerHeader}>\n        <IconButton\n          onClick={() => {\n            setOpen(false);\n          }}\n        >\n          <ChevronRightIcon />\n        </IconButton>\n      </div>\n      <MessageList messages={messages} />\n      <div className={classes.chatInputContainer}>\n        <TextField\n          placeholder=\"send a message to everyone\"\n          size=\"small\"\n          variant=\"filled\"\n          fullWidth\n          multiline\n          rowsMax={4}\n          className={classes.chatInput}\n          value={currMessage}\n          onChange={onCurrMessageChanged}\n          InputProps={{\n            endAdornment: (\n              <InputAdornment position=\"end\">\n                {currMessage.length > 0 && (\n                  <IconButton\n                    aria-label=\"toggle password visibility\"\n                    onClick={sendMessage}\n                  >\n                    <Send />\n                  </IconButton>\n                )}\n              </InputAdornment>\n            ),\n          }}\n        />\n      </div>\n    </Drawer>\n  );\n};\n\nexport default Chat;\n","import { toast } from \"react-toastify\";\nimport WebsocketService from \"../components/WebsocketService\";\nimport { getFullName } from \"../helper/utilFunctions\";\nimport { addPeer, createPeer } from \"./peers\";\n\nexport const all_users_listener =\n  (peersRef, myID, stream, setPeers) => (users) => {\n    peersRef.current = {};\n    const temp = {};\n    users.forEach((user) => {\n      if (myID !== user.id) {\n        const peer = createPeer(user.id, myID, stream);\n\n        peersRef.current[user.id] = { user, peer };\n        temp[user.id] = {\n          user: user,\n          peer: peer,\n        };\n      }\n    });\n    setPeers(temp);\n  };\n\nexport const user_joined_listener =\n  (myID, peersRef, stream, setPeers, isUserAudioOn, isUserVideoOn) =>\n  (payload) => {\n    const user = payload.callerUser;\n    if (payload.usable_id === myID) {\n      const peer = addPeer(payload.signal, user.id, stream);\n      if (!Boolean(peersRef.current[user.id])) {\n        peersRef.current[user.id] = { user, peer };\n        setPeers((peers) => ({\n          ...peers,\n          [user.id]: {\n            user: user,\n            peer: peer,\n          },\n        }));\n      }\n      WebsocketService.sendMessage(\"audioMedia\", {\n        userID: myID,\n        audioOn: isUserAudioOn,\n      });\n      WebsocketService.sendMessage(\"videoMedia\", {\n        userID: myID,\n        videoOn: isUserVideoOn,\n      });\n      toast.info(`${getFullName(user.first_name, user.last_name)} joined`);\n    }\n  };\n\nexport const receive_returned_signal = (myID, peersRef) => (payload) => {\n  if (payload.usable_id === myID) {\n    const { peer } = peersRef.current[payload.id];\n    peer.signal(payload.signal);\n  }\n};\n\nexport const user_left_listener = (peersRef, setPeers) => (payload) => {\n  const user = payload.user;\n  if (peersRef.current[user.id]) {\n    peersRef.current[user.id].peer.destroy();\n  }\n  delete peersRef.current[user.id];\n  setPeers((peers) => {\n    const { [payload.user.id]: remove, ...rest } = peers;\n    return rest;\n  });\n  toast.info(`${getFullName(user.first_name, user.last_name)} left`);\n};\n\nexport const videoMediaListener = (peersRef, setPeers) => (payload) => {\n  const userID = payload.userID;\n  if (peersRef.current[userID]) {\n    peersRef.current[userID].user.videoOn = payload.videoOn;\n    setPeers((peers) => {\n      const { user, peer } = peers[userID];\n      return {\n        ...peers,\n        [userID]: { peer, user: { ...user, videoOn: payload.videoOn } },\n      };\n    });\n  }\n};\n\nexport const audioMediaListener = (peersRef, setPeers) => (payload) => {\n  const userID = payload.userID;\n  if (peersRef.current[userID]) {\n    peersRef.current[userID].user.audioOn = payload.audioOn;\n    setPeers((peers) => {\n      const { user, peer } = peers[userID];\n      return {\n        ...peers,\n        [userID]: { peer, user: { ...user, audioOn: payload.audioOn } },\n      };\n    });\n  }\n};\n\n\n","import Peer from \"simple-peer\";\nimport WebsocketService from \"../components/WebsocketService\";\n\nexport function createPeer(userToSignal, callerID, stream) {\n  const peer = new Peer({\n    initiator: true,\n    trickle: false,\n    stream,\n  });\n  peer.on(\"signal\", (signal) => {\n    WebsocketService.sendMessage(\"sending signal\", {\n      userToSignal,\n      callerID,\n      signal,\n    });\n  });\n  return peer;\n}\n\nexport function addPeer(incomingSignal, callerID, stream) {\n  const peer = new Peer({\n    initiator: false,\n    trickle: false,\n    stream,\n  });\n  peer.on(\"signal\", (signal) => {\n    WebsocketService.sendMessage(\"returning signal\", { signal, callerID });\n  });\n  peer.signal(incomingSignal);\n  return peer;\n}\n","import React, { useEffect, useRef, useState } from \"react\";\nimport { useSelector } from \"react-redux\";\nimport WebsocketService from \"../components/WebsocketService\";\nimport { useHistory, useParams } from \"react-router\";\nimport Video from \"../components/common/Video\";\nimport Controls from \"../components/Room/Controls\";\nimport { split } from \"../helper/utilFunctions\";\nimport Chat from \"../components/Room/Chat\";\nimport { makeStyles } from \"@material-ui/core\";\nimport {\n  all_users_listener,\n  user_joined_listener,\n  user_left_listener,\n  receive_returned_signal,\n  videoMediaListener,\n  audioMediaListener,\n} from \"../helper/socketListeners\";\n\nlet videoConstraints = {\n  height: window.innerHeight / 2,\n  width: window.innerWidth / 2,\n};\n\nconst useStyles = makeStyles((theme) => ({\n  container: {\n    display: \"flex\",\n    height: \"100%\",\n    width: \"100%\",\n    flexDirection: \"column\",\n    background: theme.palette.background.default,\n  },\n}));\n\nconst socketFunctions = (\n  peersRef,\n  myID,\n  stream,\n  setPeers,\n  isUserAudioOn,\n  isUserVideoOn\n) => {\n  WebsocketService.on(\n    \"all users\",\n    all_users_listener(peersRef, myID, stream, setPeers)\n  );\n  WebsocketService.on(\n    \"user joined\",\n    user_joined_listener(\n      myID,\n      peersRef,\n      stream,\n      setPeers,\n      isUserAudioOn,\n      isUserVideoOn\n    )\n  );\n\n  WebsocketService.on(\n    \"receiving returned signal\",\n    receive_returned_signal(myID, peersRef)\n  );\n\n  WebsocketService.on(\"user left\", user_left_listener(peersRef, setPeers));\n\n  WebsocketService.on(\"videoMedia\", videoMediaListener(peersRef, setPeers));\n\n  WebsocketService.on(\"audioMedia\", audioMediaListener(peersRef, setPeers));\n};\n\nconst Room = () => {\n  const { roomID } = useParams();\n  const [peers, setPeers] = useState({});\n  const userVideo = useRef();\n  const socketRef = useRef(WebsocketService);\n  const peersRef = useRef({});\n  const myID = useSelector((state) => state.userReducer.user.pk);\n  const [userStream, setUserStream] = useState();\n  const currentCameraRef = useRef(0);\n  let sizeMap = split(Object.keys(peers).length + 1);\n  const [chatOpen, setChatOpen] = useState(false);\n  const isUserAudioOn = useSelector(\n    (state) => state.roomReducer.userVideo.audioOn\n  );\n  const isUserVideoOn = useSelector(\n    (state) => state.roomReducer.userVideo.videoOn\n  );\n  const history = useHistory();\n  const classes = useStyles();\n  const me = useSelector((state) => state.userReducer.user);\n\n  const setCameraStream = async () => {\n    const stream = await navigator.mediaDevices.getUserMedia({\n      video: videoConstraints,\n      audio: true,\n    });\n    setUserStream(stream);\n    if (userVideo && userVideo.current) {\n      userVideo.current.srcObject = stream;\n    }\n  };\n\n  const updateStream = (stream) => {\n    for (let key in peersRef.current) {\n      // peersRef.current[key].removeTrack(\n      //   // userStream.getVideoTracks()[0],\n      //   peersRef.current[key].streams[0].getVideoTracks()[0],\n      //   userStream\n      // );\n      // peersRef.current[key].addTrack(stream.getVideoTracks()[0], userStream);\n      // peersRef.current[key]._pc.getSenders().forEach((sender) => {\n      //   if (sender.track.type === \"video\") {\n      //     sender.replaceTrack(userStream.getVideoTracks()[0]);\n      //   }\n      // });\n      peersRef.current[key].peer.streams.forEach((stream) => {\n        stream.getTracks().forEach((track) => {\n          track.stop();\n        });\n      });\n    }\n    setPeers({ ...peersRef.current });\n    userStream.removeTrack(userStream.getVideoTracks()[0]);\n    userStream.addTrack(stream.getVideoTracks()[0]);\n  };\n\n  const switchCamera = async (currentCameraRef) => {\n    const devices = await navigator.mediaDevices.enumerateDevices();\n    const videoDevices = devices.filter(\n      (device) => device.kind === \"videoinput\"\n    );\n    currentCameraRef.current =\n      (currentCameraRef.current + 1) % videoDevices.length;\n\n    const updatedConstraints = {\n      ...videoConstraints,\n      deviceId: {\n        exact: videoDevices[currentCameraRef.current].deviceId,\n      },\n    };\n    videoConstraints = updatedConstraints;\n\n    const stream = await navigator.mediaDevices.getUserMedia({\n      video: videoConstraints,\n      audio: true,\n    });\n    updateStream(stream);\n  };\n\n  function shareScreen() {\n    navigator.mediaDevices\n      .getDisplayMedia({ cursor: true })\n      .then((screenStream) => {\n        // const temp = {};\n        Object.keys(peersRef.current).forEach((key) => {\n          // let peer = peersRef.current[key];\n          peersRef.current[key].replaceTrack(\n            userStream.getVideoTracks()[0],\n            screenStream.getVideoTracks()[0],\n            userStream\n          );\n          // temp[key] = peer;\n        });\n      });\n  }\n\n  const socketConnect = async () => {\n    socketRef.current.refresh();\n    socketRef.current.connect(\n      `ws://${window.location.hostname}/ws/room/${roomID}/`,\n      // `ws://localhost:7000/ws/room/${roomID}/`,\n      (e) => {\n        console.log(e);\n        history.replace(\"/\", {\n          message: \"the url entered is incorrect.\",\n          type: \"error\",\n        });\n      }\n    );\n    await setCameraStream();\n    socketRef.current.sendMessage(\"join room\", roomID);\n  };\n\n  useEffect(() => {\n    let websocketRef = socketRef.current;\n    socketConnect();\n    return () => {\n      if (websocketRef) {\n        websocketRef.close();\n      }\n    };\n  }, []);\n\n  useEffect(() => {\n    let userStreamRef = userStream;\n    socketFunctions(\n      peersRef,\n      myID,\n      userStream,\n      setPeers,\n      isUserAudioOn,\n      isUserVideoOn\n    );\n    return () => {\n      if (userStreamRef) {\n        userStreamRef.getVideoTracks().forEach((track) => {\n          track.stop();\n        });\n        userStreamRef.getAudioTracks().forEach((track) => {\n          track.stop();\n        });\n      }\n    };\n  }, [userStream, isUserAudioOn, isUserVideoOn, myID]);\n\n  useEffect(() => {\n    if (userStream) {\n      userStream.getAudioTracks()[0].enabled = isUserAudioOn;\n      if (socketRef.current.state() === 1) {\n        socketRef.current.sendMessage(\"audioMedia\", {\n          userID: myID,\n          audioOn: isUserAudioOn,\n        });\n      }\n    }\n  }, [userStream, isUserAudioOn, myID]);\n\n  useEffect(() => {\n    if (userStream) {\n      userStream.getVideoTracks()[0].enabled = isUserVideoOn;\n      if (socketRef.current.state() === 1) {\n        socketRef.current.sendMessage(\"videoMedia\", {\n          userID: myID,\n          videoOn: isUserVideoOn,\n        });\n      }\n    }\n  }, [userStream, isUserVideoOn, myID]);\n\n  useEffect(() => {\n    sizeMap = split(Object.keys(peers).length + 1);\n  }, [peers]);\n\n  return (\n    <div className={classes.container}>\n      <div\n        style={{\n          display: \"flex\",\n          width: \"100%\",\n          maxHeight: \"calc(100vh - 7rem)\",\n          margin: \"auto\",\n          flexGrow: \"1\",\n          flexWrap: \"wrap\",\n        }}\n      >\n        <Video\n          muted\n          ref={userVideo}\n          user={{ ...me, videoOn: isUserVideoOn, audioOn: isUserAudioOn }}\n          autoPlay\n          playsInline\n          size={sizeMap[1]}\n          rows={sizeMap[\"rows\"]}\n          isUserVideo\n        />\n        {Object.values(peersRef.current).map((item, index) => {\n          return (\n            <Video\n              key={index}\n              peer={item.peer}\n              user={item.user}\n              muted\n              size={sizeMap[index + 2]}\n              rows={sizeMap[\"rows\"]}\n            />\n          );\n        })}\n      </div>\n      <Controls\n        switchc={() => {\n          switchCamera(currentCameraRef);\n        }}\n        toggleChat={() => {\n          setChatOpen((open) => !open);\n        }}\n      />\n      <Chat open={chatOpen} setOpen={setChatOpen} />\n    </div>\n  );\n};\n\nexport default Room;\n"],"sourceRoot":""}