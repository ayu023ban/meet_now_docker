(this.webpackJsonpteams_frontend=this.webpackJsonpteams_frontend||[]).push([[6],{189:function(e,t,n){"use strict";n.d(t,"a",(function(){return l})),n.d(t,"e",(function(){return d})),n.d(t,"b",(function(){return j})),n.d(t,"d",(function(){return f})),n.d(t,"j",(function(){return b})),n.d(t,"k",(function(){return O})),n.d(t,"f",(function(){return h})),n.d(t,"g",(function(){return m})),n.d(t,"c",(function(){return g})),n.d(t,"h",(function(){return p})),n.d(t,"i",(function(){return v}));var c=n(54),r=n(35),i=n(31),a=n(27),o=n(36),s=n(16),u=n(48),l=function(e){var t=o.a;return function(n){r.a.post(t,e).then((function(e){n(Object(s.a)(a.a,e.data)),navigator.clipboard.writeText(Object(s.e)(e.data.id)),i.b.success("copied to clipboard")})).catch((function(e){i.b.error("error occured in creating the room")}))}},d=function(){var e=o.d;return function(t){r.a.get(e).then((function(e){t(Object(s.a)(a.c,e.data))})).catch((function(e){i.b.error("error occured in fetching your rooms",{})}))}},j=function(e,t){var n="".concat(o.d).concat(e,"/");return function(c,i){r.a.delete(n).then((function(n){t(e)}))}},f=function(e){var t="".concat(o.d).concat(e,"/");return function(e){r.a.get(t).then((function(t){e(Object(s.a)(a.b,t.data))}))}},b=function(){return function(e){e(Object(s.a)(a.f))}},O=function(){return function(e){e(Object(s.a)(a.g))}},h=function(e,t){var n=Object(o.g)(e);return function(e){r.a.post(n,t).then((function(t){e(Object(s.a)(a.b,t.data)),i.b.success("user invited")})).catch((function(e){i.b.error(e.response.data)}))}},m=function(e,t){var n=Object(o.j)(e);return function(e){r.a.post(n,t).then((function(t){e(Object(s.a)(a.b,t.data)),e(Object(u.d)())})).catch((function(e){i.b.error(e.response.data)}))}},g=function(e){var t=Object(o.h)(e);return function(e){r.a.get(t).then((function(t){e(Object(s.a)(a.e,t.data.isCreator))}))}},p=function(e){return function(t){t(Object(s.a)(a.d,e))}},v=function(e){return function(t,n){var r=n().roomReducer.roomMessages;t(Object(s.a)(a.d,[].concat(Object(c.a)(r),[e])))}}},254:function(e,t,n){},280:function(e,t){},282:function(e,t){},324:function(e,t,n){"use strict";n.r(t);var c=n(42),r=n(0),i=n.n(r),a=n(199),o=n(200),s=function(){function e(){Object(a.a)(this,e),this.callbacks={},this.socketRef=null,this.fallback=null,this.forcedClose=!1}return Object(o.a)(e,[{key:"connect",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};this.forcedClose=!1,this.fallback=n,this.socketRef=new WebSocket(e),this.socketRef.onopen=function(){console.log("websocket open")},this.socketRef.onmessage=function(e){t.socketNewMessage(e.data)},this.socketRef.onerror=function(e){console.debug(e)},this.socketRef.onclose=function(c){console.log(c),4e3===c.code?t.fallback(c):t.forcedClose?console.log("websocket closed"):(console.log("websockets closed lets reopen"),setTimeout((function(){t.connect(e,n(c))}),5e3))}}},{key:"close",value:function(e,t){"undefined"==typeof e&&(e=1e3),this.forcedClose=!0,this.socketRef&&this.socketRef.close(e,t)}},{key:"on",value:function(e,t){this.callbacks[e]=t}},{key:"socketNewMessage",value:function(e){var t=JSON.parse(e),n=t.command,c=t.data;0!==Object.keys(this.callbacks).length&&this.callbacks[n]&&this.callbacks[n](c)}},{key:"sendMessage",value:function(e,t){try{this.waitForConnection(function(){this.socketRef.send(JSON.stringify({type:e,data:t}))}.bind(this),1e3)}catch(n){console.log(n.message)}}},{key:"refresh",value:function(){this.socketRef&&this.socketRef.close()}},{key:"state",value:function(){return this.socketRef.readyState}},{key:"waitForConnection",value:function(e,t){if(1===this.state())e();else{var n=this;setTimeout((function(){n.waitForConnection(e,t)}),t)}}}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}]),e}();s.instance=null;var u=s.getInstance(),l=n(10),d=n(4),j=n(207),f=n.n(j),b=n(208),O=n(13),h=n(87),m=n(177),g=n(327),p=n(182),v=n(181),x=n(209),k=n.n(x),w=n(187),y=n(310),R=n(241),C=n.n(R),M=n(242),I=n.n(M),_=n(31),S=n(240),N=n.n(S),T=n(239),D=n.n(T),U=n(2),E=Object(m.a)((function(e){return{responsive:function(){return{float:"left",display:"flex",alignItems:"center",transition:"width 0.5s, height 0.5s"}},videoTop:{background:e.palette.background.paper},micOff:{position:"absolute",right:0,top:0},videoOff:{position:"absolute",width:"100%",height:"100%",top:0,left:0,display:"flex",justifyContent:"center",alignItems:"center"},avatar:{width:"min(50%, 10rem)",height:"min(50%, 10rem)",fontSize:"3rem"},hoverDiv:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%"},remove:{color:"white","&:disabled":{color:"#444"}},name:{position:"absolute",bottom:"0.5rem",left:"1rem",color:"white"}}})),B=i.a.forwardRef((function(e,t){var n=e.peer,a=e.muted,o=e.size,s=e.rows,l=e.isUserVideo,d=e.user,j=e.isSharingScreen,f=e.pinnedUser,b=e.setPinnedUser,m=Object(r.useRef)(null),x=t||m,R=d.pk||d.id,M=E(),S=i.a.useState(!1),T=Object(c.a)(S,2),B=T[0],V=T[1],z=Object(O.c)((function(e){return e.roomReducer.isUserCreator})),J=Object(O.c)((function(e){return e.roomReducer.currentRoom.invited_users})),P=Object(r.useRef)(null),A=i.a.useState(),F=Object(c.a)(A,2),H=F[0],W=F[1],L=i.a.useState(),q=Object(c.a)(L,2),G=q[0],X=q[1],Y=new ResizeObserver((function(e){var t,n,c,r=Object(h.a)(e);try{for(r.s();!(c=r.n()).done;){var i=c.value;i.contentBoxSize&&(t=9*i.contentRect.width/16<i.contentRect.height?.95*i.contentRect.width:.95*i.contentRect.height*16/9,n=9*i.contentRect.width/16>i.contentRect.height?.95*i.contentRect.height:.95*i.contentRect.width*9/16)}}catch(a){r.e(a)}finally{r.f()}W(t),X(n)}));Object(r.useEffect)((function(){Y.observe(P.current)}),[]);var K=(d.first_name?d.first_name[0].toUpperCase():"")+(d.last_name?d.last_name[0].toUpperCase():""),Q=d.first_name+" "+d.last_name;Q=Q.trim(),l&&(Q="You"),Object(r.useEffect)((function(){n&&n.on("stream",(function(e){x.current.srcObject=e}))}),[]);return Object(U.jsx)("div",{className:M.responsive,ref:P,style:{width:"".concat(f===R?100:-1===f?100/o-2:0,"%"),height:"".concat(f===R?100:-1===f?100/s-2:0,"%")},children:Object(U.jsxs)("div",{className:M.videoTop,style:{width:H,height:G,position:"relative",overflow:"hidden",margin:"auto",borderRadius:"1rem"},children:[Object(U.jsx)("video",{style:{objectFit:"contain",transform:l&&!j?"scaleX(-1)":1,position:"absolute",top:"0",left:"0",display:d.videoOn?"block":"none"},playsInline:!0,width:"100%",height:"100%",autoPlay:!0,muted:a,ref:x,onClick:function(){},onMouseEnter:function(){V(!0)}}),Object(U.jsx)(y.a,{in:B,children:Object(U.jsx)("div",{className:M.hoverDiv,onMouseLeave:function(){V(!1)},children:Object(U.jsxs)("div",{style:{opacity:.6,background:"black",width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center"},children:[Object(U.jsx)(g.a,{title:f===R?"remove pin":"pin the user",children:Object(U.jsx)(p.a,{className:M.remove,onClick:function(){b(f===R?-1:R)},children:f===R?Object(U.jsx)(D.a,{fontSize:"large"}):Object(U.jsx)(N.a,{fontSize:"large"})})}),Object(U.jsx)(g.a,{title:"remove user",children:Object(U.jsx)(p.a,{className:M.remove,onClick:function(){z&&!l&&u.sendMessage("user kick",{userID:d.id})},disabled:!z||l,children:Object(U.jsx)(C.a,{fontSize:"large"})})}),Object(U.jsx)(g.a,{title:"Block user",children:Object(U.jsx)(p.a,{className:M.remove,onClick:function(){z&&!l&&(J.some((function(e){return e.id===d.id}))?_.b.error("user is invited. first remove the invitation"):u.sendMessage("user block",{userID:d.id}))},disabled:!z||l,children:Object(U.jsx)(I.a,{fontSize:"large"})})}),Object(U.jsx)(v.a,{variant:"p",className:M.name,children:Q})]})})}),!d.audioOn&&Object(U.jsx)(p.a,{className:M.micOff,children:Object(U.jsx)(k.a,{})}),!d.videoOn&&Object(U.jsx)("div",{className:M.videoOff,children:Object(U.jsx)(w.a,{className:M.avatar,children:K})})]})})})),V=n(143),z=n(236),J=n(151),P=n(188),A=n(66),F=n(243),H=n.n(F),W=n(244),L=n.n(W),q=n(246),G=n.n(q),X=n(247),Y=n.n(X),K=n(252),Q=n.n(K),Z=n(189),$=n(251),ee=n.n($),te=n(250),ne=n.n(te),ce=n(311),re=n(313),ie=n(314),ae=n(315),oe=n(316),se=n(229),ue=n(206),le=n.n(ue),de=function(e){var t=e.open,n=e.setOpen,c=Object(O.c)((function(e){return e.roomReducer.currentRoom.room_name}));return Object(U.jsxs)(ce.a,{open:t,onClose:function(){n((function(e){return!e}))},"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[Object(U.jsx)(re.a,{id:"alert-dialog-title",children:"Meeting Details"}),Object(U.jsxs)(ie.a,{children:[Object(U.jsx)(v.a,{variant:"h5",children:c}),Object(U.jsx)("br",{}),Object(U.jsx)(v.a,{variant:"p",children:"Joining info"}),Object(U.jsx)(ae.a,{id:"alert-dialog-description",children:window.location.href})]}),Object(U.jsx)(oe.a,{children:Object(U.jsx)(le.a,{text:window.location.href,onCopy:function(){_.b.success("copied to clipboard")},children:Object(U.jsx)(se.a,{children:"Copy link"})})})]})},je=n(323),fe=n(317),be=n(318),Oe=n(210),he=n.n(Oe),me=n(198),ge=n.n(me),pe=n(16),ve=function(e){var t=e.open,n=e.setOpen,i=Object(l.i)().roomID,a=Object(O.c)((function(e){return e.roomReducer.currentRoom.invited_users||[]})),o=Object(r.useState)({str:"",err_message:""}),s=Object(c.a)(o,2),u=s[0],d=s[1],j=Object(O.b)();return Object(U.jsxs)(ce.a,{open:t,onClose:function(){n((function(e){return!e}))},children:[Object(U.jsx)(re.a,{children:"Invite people"}),Object(U.jsxs)(ie.a,{children:[a.map((function(e,t){return Object(U.jsxs)(fe.a,{style:{alignItems:"center"},children:[Object(U.jsx)(be.a,{children:e.email}),Object(U.jsx)(p.a,{onClick:function(){j(Object(Z.g)(i,{invitee:e.email}))},children:Object(U.jsx)(he.a,{})})]},t)})),Object(U.jsx)(je.a,{error:u.err_message.length>0,value:u.str,onChange:function(e){var t=e.target.value;d({str:t,err_message:""})},helperText:u.err_message}),Object(U.jsx)(p.a,{onClick:function(){var e=u.str,t="";0===e.length?t="email can't be empty":Object(pe.f)(e)?(j(Object(Z.f)(i,{invitee:e})),d({str:"",err_message:""})):t="email not valid",t.length&&d({str:e,err_message:t})},children:Object(U.jsx)(ge.a,{})})]})]})},xe=n(309),ke=n(97),we=n(253),ye=n.n(we),Re=n(248),Ce=n.n(Re),Me=n(249),Ie=n.n(Me),_e=n(245),Se=n.n(_e),Ne=Object(m.a)((function(e){return{container:{minHeight:"3rem",flexGrow:0,background:e.palette.background.default},blue:{background:"blue"},orange:{color:A.a[500]},right:{marginRight:"1rem"}}})),Te=function(e){var t=e.switchc,n=e.shareScreen,a=e.toggleChat,o=e.isJoinedRoom,s=e.setIsJoinedRoom,u=Ne(),d=Object(O.b)(),j=Object(O.c)((function(e){return e.roomReducer.userVideo.audioOn})),f=Object(O.c)((function(e){return e.roomReducer.userVideo.videoOn})),b=Object(r.useState)(!1),h=Object(c.a)(b,2),m=h[0],x=h[1],w=Object(r.useState)(!1),y=Object(c.a)(w,2),R=y[0],C=y[1],M=Object(l.g)(),I=Object(O.c)((function(e){return e.roomReducer.currentRoom.room_name})),_=Object(O.c)((function(e){return e.roomReducer.isUserCreator})),S=Object(ke.a)(),N=Object(xe.a)(S.breakpoints.down("sm")),T=i.a.useState(null),D=Object(c.a)(T,2),E=D[0],B=D[1],A=Boolean(E);return Object(U.jsx)(V.a,{elevation:3,className:u.container,children:Object(U.jsxs)(z.a,{justify:"space-between",container:!0,alignItems:"center",style:{height:"100%"},children:[Object(U.jsx)("div",{children:Object(U.jsx)(v.a,{variant:"h5",style:{marginLeft:"1rem"},children:I})}),Object(U.jsxs)("div",{children:[Object(U.jsx)(g.a,{title:j?"Mic On":"Mic off",children:Object(U.jsx)(p.a,{color:"inherit",onClick:function(){d(Object(Z.j)())},children:j?Object(U.jsx)(H.a,{}):Object(U.jsx)(k.a,{})})}),o?Object(U.jsx)(g.a,{title:"end call",children:Object(U.jsx)(p.a,{color:"inherit",onClick:function(){M.replace("/")},children:Object(U.jsx)(L.a,{className:u.orange})})}):Object(U.jsx)(g.a,{title:"Join the meeting",children:Object(U.jsx)(p.a,{color:"inherit",onClick:function(){s(!0)},children:Object(U.jsx)(Se.a,{})})}),Object(U.jsx)(g.a,{title:f?"video on":"video off",children:Object(U.jsx)(p.a,{color:"inherit",onClick:function(){d(Object(Z.k)())},children:f?Object(U.jsx)(G.a,{}):Object(U.jsx)(Y.a,{})})}),o&&Object(U.jsx)(g.a,{title:"share screen",children:Object(U.jsx)(p.a,{color:"inherit",onClick:function(){n()},children:Object(U.jsx)(Ce.a,{})})})]}),!N&&Object(U.jsxs)("div",{className:u.right,children:[Object(U.jsx)(g.a,{title:"switch camera",children:Object(U.jsx)(p.a,{color:"inherit",onClick:function(){t()},children:Object(U.jsx)(Ie.a,{})})}),_&&o&&Object(U.jsx)(g.a,{title:"invite users",children:Object(U.jsx)(p.a,{onClick:function(){C((function(e){return!e}))},children:Object(U.jsx)(ne.a,{})})}),Object(U.jsx)(g.a,{title:"Meeting Details",children:Object(U.jsx)(p.a,{onClick:function(){x((function(e){return!e}))},children:Object(U.jsx)(ee.a,{})})}),Object(U.jsx)(g.a,{title:"Chat",children:Object(U.jsx)(p.a,{onClick:a,children:Object(U.jsx)(Q.a,{})})})]}),N&&Object(U.jsxs)("div",{className:u.right,children:[Object(U.jsx)(p.a,{"aria-controls":"simple-theme-menu","aria-haspopup":"true",color:"inherit",className:"header-title-button",onClick:function(e){return B(e.currentTarget)},children:Object(U.jsx)(ye.a,{})}),Object(U.jsxs)(J.a,{anchorEl:E,id:"controls-menu",keepMounted:!0,open:A,onClose:function(){B(null)},children:[_&&o&&Object(U.jsx)(P.a,{onClick:function(){B(null),C((function(e){return!e}))},children:"Invite User"}),Object(U.jsx)(P.a,{onClick:function(){B(null),x((function(e){return!e}))},children:"Meeting Details"}),Object(U.jsx)(P.a,{onClick:function(){B(null),a()},children:"Chat"})]})]}),_&&o&&Object(U.jsx)(ve,{open:R,setOpen:C}),Object(U.jsx)(de,{open:m,setOpen:x})]})})},De=function(e){for(var t=Math.floor(Math.sqrt(e)),n=t-e%t,c=Math.floor(e/t),r=[],i=0;i<t;i++)i>=n?r.push(c+1):r.push(c);r=r.reverse();for(var a={},o=1,s=0,u=1;u<=e;u++)a[u]=r[s],++o>r[s]&&(o=1,s++);return a.rows=r.length,a};var Ue=function(e,t){return(e+" "+t).trim()},Ee=n(328),Be=n(255),Ve=n.n(Be),ze=n(320),Je=n(319),Pe=(n(254),Object(m.a)((function(e){return{drawer:{width:360,flexShrink:0},drawerPaper:{width:360,height:"calc(100vh - 9rem)",borderRadius:"1rem",top:"5rem",right:"12px"},drawerHeader:Object(d.a)(Object(d.a)({display:"flex",alignItems:"center",padding:e.spacing(0,1)},e.mixins.toolbar),{},{justifyContent:"flex-start"}),chatInputContainer:{marginTop:"auto"},chatInput:{marginBottom:"2rem","& .MuiFilledInput-root":{borderRadius:"50px",borderBottom:0,paddingTop:"15px",paddingBottom:"15px","&::before":{borderBottom:0}}},messageBoxRight:{background:e.palette.background.paper,color:e.palette.text.primary},messageBoxLeft:{background:"#4870df",color:e.palette.background.default},messageSender:{color:e.palette.text.primary,fontSize:"10px"}}}))),Ae=function(e){var t=Object(O.c)((function(e){return e.userReducer.user})),n=Pe(),c=t.pk===e.sender.id?"chatApp__convMessageItem--right":"chatApp__convMessageItem--left",r=t.pk===e.sender.id?n.messageBoxRight:n.messageBoxLeft;return Object(U.jsx)("div",{className:"chatApp__convMessageItem "+c+" clearfix",children:Object(U.jsxs)("div",{className:"chatApp__convMessageValue ".concat(r),children:[t.pk!==e.sender.id&&Object(U.jsx)("div",{className:n.messageSender,children:e.sender.first_name}),Object(U.jsx)("div",{children:e.message})]})})},Fe=i.a.memo((function(e){return Object(U.jsx)("div",{className:"chatApp__convTimeline",children:e.messages.slice(0).reverse().map((function(e,t){return Object(U.jsx)(Ae,{sender:e.user,message:e.message},t)}))})})),He=function(e){var t=e.open,n=e.setOpen,i=Object(O.c)((function(e){return e.roomReducer.roomMessages})),a=Object(r.useState)(""),o=Object(c.a)(a,2),s=o[0],l=o[1],d=Pe(),j=Object(O.b)();Object(r.useEffect)((function(){u.on("receive new message",(function(e){j(Object(Z.i)(e))})),u.on("get all messages",(function(e){j(Object(Z.h)(e.messages))}))}),[]);var f=Object(r.useCallback)((function(e){var t=e.target.value;l(t)}),[]);return Object(U.jsxs)(Ee.a,{className:d.drawer,variant:"persistent",anchor:"right",open:t,classes:{paper:d.drawerPaper},children:[Object(U.jsx)("div",{className:d.drawerHeader,children:Object(U.jsx)(p.a,{onClick:function(){n(!1)},children:Object(U.jsx)(Ve.a,{})})}),Object(U.jsx)(Fe,{messages:i}),Object(U.jsx)("div",{className:d.chatInputContainer,children:Object(U.jsx)(je.a,{placeholder:"send a message to everyone",size:"small",variant:"filled",fullWidth:!0,multiline:!0,rowsMax:4,className:d.chatInput,value:s,onChange:f,InputProps:{endAdornment:Object(U.jsx)(Je.a,{position:"end",children:s.length>0&&Object(U.jsx)(p.a,{"aria-label":"toggle password visibility",onClick:function(){u.sendMessage("send new message",s),l("")},children:Object(U.jsx)(ze.a,{})})})}})})]})},We=n(37),Le=n(295),qe=n(72),Ge=n(256),Xe=n.n(Ge);var Ye=function(e,t,n,c){return function(r){e.current={};var i={};r.forEach((function(c){if(t!==c.id){var r=function(e,t,n){var c=new Xe.a({initiator:!0,trickle:!1,stream:n});return c.on("signal",(function(n){u.sendMessage("sending signal",{userToSignal:e,callerID:t,signal:n})})),c}(c.id,t,n);e.current[c.id]={user:c,peer:r},i[c.id]={user:c,peer:r}}})),c(i)}},Ke=function(e,t,n,c,r,i){return function(r){var i=r.callerUser;if(r.usable_id===e){var a=function(e,t,n){var c=new Xe.a({initiator:!1,trickle:!1,stream:n});return c.on("signal",(function(e){u.sendMessage("returning signal",{signal:e,callerID:t})})),c.signal(e),c}(r.signal,i.id,n);t.current[i.id]={user:i,peer:a},c((function(e){return Object(d.a)(Object(d.a)({},e),{},Object(qe.a)({},i.id,{user:i,peer:a}))})),_.b.info("".concat(Ue(i.first_name,i.last_name)," joined"))}}},Qe=n(322),Ze=n(292),$e=n.n(Ze),et=n(144),tt=Object(et.a)((function(e){return{modal:{"&& .modal-content":{background:e.palette.background.paper,color:e.palette.text.primary}}}})),nt=function(e){var t=e.waitingUsers,n=e.setWaitingUsers,c=tt();return Object(U.jsxs)(Qe.a,{show:Boolean(t.length),onHide:function(){},backdrop:"static",keyboard:!1,className:c.modal,children:[Object(U.jsx)(Qe.a.Header,{children:Object(U.jsx)(Qe.a.Title,{children:"Modal title"})}),Object(U.jsx)(Qe.a.Body,{children:t.map((function(e,t){return Object(U.jsxs)(fe.a,{style:{alignItems:"center"},children:[Object(U.jsxs)(be.a,{children:[e.first_name," wants to join"]}),Object(U.jsx)(p.a,{onClick:function(){!function(e){u.sendMessage("give join permission status",{userID:e.id,status:"reject"}),n((function(t){return t.filter((function(t){return t.id!==e.id}))}))}(e)},children:Object(U.jsx)(he.a,{})}),Object(U.jsx)(p.a,{onClick:function(){!function(e){u.sendMessage("give join permission status",{userID:e.id,status:"accept"}),n((function(t){return t.filter((function(t){return t.id!==e.id}))}))}(e)},children:Object(U.jsx)($e.a,{})})]},t)}))}),Object(U.jsx)(Qe.a.Footer,{})]})},ct=function(e,t,n){return function(c){for(var r in e.current)e.current[r].peer.replaceTrack(n.getVideoTracks()[0],c.getVideoTracks()[0],n);t(Object(d.a)({},e.current)),n.removeTrack(n.getVideoTracks()[0]),n.addTrack(c.getVideoTracks()[0])}},rt=function(){var e=Object(b.a)(f.a.mark((function e(t,n,c,r,i){var a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.getDisplayMedia({cursor:!0});case 2:a=e.sent,ct(t,n,r)(a),i(!0),a.getTracks()[0].onended=Object(b.a)(f.a.mark((function e(){var a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.getUserMedia({video:c,audio:!0});case 2:a=e.sent,ct(t,n,r)(a),i(!1);case 5:case"end":return e.stop()}}),e)})));case 6:case"end":return e.stop()}}),e)})));return function(t,n,c,r,i){return e.apply(this,arguments)}}(),it={height:window.innerHeight/2,width:window.innerWidth/2},at=Object(m.a)((function(e){return{container:{display:"flex",height:"100%",width:"100%",flexDirection:"column",background:e.palette.background.default}}})),ot=function(e,t,n,c,r,i,a){u.on("all users",Ye(e,t,n,c)),u.on("user joined",Ke(t,e,n,c)),u.on("receiving returned signal",function(e,t,n,c){return function(r){r.usable_id===e&&(t.current[r.id].peer.signal(r.signal),u.sendMessage("audioMedia",{userID:e,audioOn:n}),u.sendMessage("videoMedia",{userID:e,videoOn:c}),u.sendMessage("get media",""))}}(t,e,r,i)),u.on("user left",function(e,t,n){return function(c){var r=c.user;t.current[r.id]&&t.current[r.id].peer.destroy(),delete t.current[r.id],n((function(e){var t=c.user.id;return e[t],Object(We.a)(e,[t].map(Le.a))})),c.user.id!==e&&_.b.info("".concat(Ue(r.first_name,r.last_name)," left"))}}(t,e,c)),u.on("videoMedia",function(e,t){return function(n){var c=n.userID;e.current[c]&&(e.current[c].user.videoOn=n.videoOn,t((function(e){var t=e[c],r=t.user,i=t.peer;return Object(d.a)(Object(d.a)({},e),{},Object(qe.a)({},c,{peer:i,user:Object(d.a)(Object(d.a)({},r),{},{videoOn:n.videoOn})}))})))}}(e,c)),u.on("audioMedia",function(e,t){return function(n){var c=n.userID;e.current[c]&&(e.current[c].user.audioOn=n.audioOn,t((function(e){var t=e[c],r=t.user,i=t.peer;return Object(d.a)(Object(d.a)({},e),{},Object(qe.a)({},c,{peer:i,user:Object(d.a)(Object(d.a)({},r),{},{audioOn:n.audioOn})}))})))}}(e,c)),u.on("user want to join",function(e,t){return function(n){n.usable_id===e&&t((function(e){return e.push(n.user),Object(pe.d)(e,"id")}))}}(t,a)),u.on("get media",function(e,t){return function(n){for(var c in e.current)n.audio[c]&&(e.current[c].user.audioOn=n.audio[c]),n.video[c]&&(e.current[c].user.videoOn=n.video[c]);t((function(e){for(var t in e)n.audio[t]&&(e[t].user.audioOn=n.audio[t]),n.video[t]&&(e[t].user.videoOn=n.video[t]);return Object(d.a)({},e)}))}}(e,c))},st=function(){var e=Object(l.i)().roomID,t=Object(r.useState)({}),n=Object(c.a)(t,2),i=n[0],a=n[1],o=Object(r.useRef)(),s=Object(r.useRef)({}),j=Object(O.c)((function(e){return e.userReducer.user.pk})),h=Object(r.useState)(),m=Object(c.a)(h,2),g=m[0],p=m[1],v=Object(r.useRef)(0),x=De(Object.keys(i).length+1),k=Object(r.useState)(!1),w=Object(c.a)(k,2),y=w[0],R=w[1],C=Object(O.c)((function(e){return e.roomReducer.userVideo.audioOn})),M=Object(O.c)((function(e){return e.roomReducer.userVideo.videoOn})),I=at(),_=Object(O.c)((function(e){return e.userReducer.user})),S=Object(r.useState)([]),N=Object(c.a)(S,2),T=N[0],D=N[1],E=Object(O.b)(),V=Object(r.useState)(!1),z=Object(c.a)(V,2),J=z[0],P=z[1],A=Object(r.useState)(-1),F=Object(c.a)(A,2),H=F[0],W=F[1],L=Object(r.useState)(!1),q=Object(c.a)(L,2),G=q[0],X=q[1],Y=function(){var e=Object(b.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.getUserMedia({video:!0,audio:!0});case 2:t=e.sent,p(t),o&&o.current&&(o.current.srcObject=t);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),K=function(){var e=Object(b.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Y();case 2:u.sendMessage("get all messages","");case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(r.useEffect)((function(){E(Object(Z.c)(e)),E(Object(Z.d)(e)),K()}),[]),Object(r.useEffect)((function(){G&&ot(s,j,g,a,C,M,D)}),[G,g,C,M,j]),Object(r.useEffect)((function(){var e=g;return function(){e&&(e.getVideoTracks().forEach((function(e){e.stop()})),e.getAudioTracks().forEach((function(e){e.stop()})))}}),[g]),Object(r.useEffect)((function(){g&&(g.getAudioTracks()[0].enabled=C,1===u.state()&&u.sendMessage("audioMedia",{userID:j,audioOn:C}))}),[g,C,j]),Object(r.useEffect)((function(){G&&u.sendMessage("join room",e)}),[G]),Object(r.useEffect)((function(){g&&(g.getVideoTracks()[0].enabled=M,1===u.state()&&u.sendMessage("videoMedia",{userID:j,videoOn:M}))}),[g,M,j]),Object(r.useEffect)((function(){x=De(Object.keys(i).length+1)}),[i]),Object(U.jsxs)("div",{className:I.container,children:[Object(U.jsxs)("div",{style:{display:"flex",width:"100%",maxHeight:"calc(100vh - 7rem)",margin:"auto",flexGrow:"1",flexWrap:"wrap"},children:[Object(U.jsx)(B,{muted:!0,ref:o,user:Object(d.a)(Object(d.a)({},_),{},{videoOn:M,audioOn:C}),autoPlay:!0,playsInline:!0,size:x[1],rows:x.rows,isUserVideo:!0,isSharingScreen:J,pinnedUser:H,setPinnedUser:W}),Object.values(i).map((function(e,t){return Object(U.jsx)(B,{peer:e.peer,user:e.user,size:x[t+2],rows:x.rows,pinnedUser:H,setPinnedUser:W},t)}))]}),Object(U.jsx)(nt,{waitingUsers:T,setWaitingUsers:D}),Object(U.jsx)(Te,{switchc:function(){!function(e,t,n,c){return function(){var r=Object(b.a)(f.a.mark((function r(i){var a,o,s,u;return f.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,navigator.mediaDevices.enumerateDevices();case 2:return a=r.sent,o=a.filter((function(e){return"videoinput"===e.kind})),i.current=(i.current+1)%o.length,s=Object(d.a)(Object(d.a)({},c),{},{deviceId:{exact:o[i.current].deviceId}}),c=s,r.next=9,navigator.mediaDevices.getUserMedia({video:c,audio:!0});case 9:u=r.sent,ct(e,t,n)(u);case 11:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}()}(s,a,g,it)(v)},shareScreen:function(){rt(s,a,it,g,P)},toggleChat:function(){R((function(e){return!e}))},isJoinedRoom:G,setIsJoinedRoom:X}),Object(U.jsx)(He,{open:y,setOpen:R})]})},ut=n(173),lt=Object(et.a)((function(e){return{container:{background:e.palette.background.default,height:"100%",width:"100%",position:"relative"},color:{color:e.palette.text.primary},paper:{display:"flex",alignItems:"center",justifyContent:"center",maxWidth:"75vw",position:"relative",marginLeft:"auto",marginRight:"auto",top:"3rem"}}}));t.default=function(){var e=Object(l.i)().roomID,t=Object(l.g)(),n=lt(),i=Object(O.c)((function(e){return e.userReducer.user.pk})),a=Object(r.useState)("pending"),o=Object(c.a)(a,2),s=o[0],d=o[1],j=Object(r.useState)(""),f=Object(c.a)(j,2),b=f[0],h=f[1];return Object(r.useEffect)((function(){u.refresh();var n="http:"===window.location.protocol?"ws":"wss",c=window.location.hostname.includes("localhost")?"localhost:7000":window.location.hostname;return u.connect("".concat(n,"://").concat(c,"/ws/room/").concat(e,"/"),(function(e){t.replace("/",{message:"the url entered is incorrect.",type:"error"})})),u.on("get permission",function(e,t){return function(n){n.usable_id===e&&t(n.status)}}(i,d)),u.on("join message",function(e,t){return function(n){e("message"),"creator not available"===n?t("The Organisor has not joined the room yet. Please try joining after some time"):"user blocked"===n&&t("The Organisor has blocked you.")}}(d,h)),u.on("user kicked",function(e,t){return function(n){n.usable_id===e&&t.replace("/",{message:"The Organisor removed you from room",type:"error"})}}(i,t)),u.on("user blocked",function(e,t){return function(n){n.usable_id===e&&t.replace("/",{message:"The Organisor blocked you from room",type:"error"})}}(i,t)),function(){u.close()}}),[]),Object(r.useEffect)((function(){"reject"===s&&t.replace("/",{message:"The creator rejected the join request",type:"error"})}),[s]),Object(U.jsx)(U.Fragment,{children:"pending"===s?Object(U.jsx)("div",{className:n.container,children:Object(U.jsxs)(V.a,{elevation:3,variant:"outlined",className:n.paper,children:[Object(U.jsx)(v.a,{variant:"h2",className:n.color,style:{width:"max-content"},children:"Joining the room"}),Object(U.jsx)(ut.a,{className:n.color,style:{marginLeft:"1rem"}})]})}):"accept"===s?Object(U.jsx)(st,{}):"message"===s?Object(U.jsx)("div",{className:n.container,children:Object(U.jsx)(V.a,{elevation:3,variant:"outlined",className:n.paper,children:Object(U.jsx)(v.a,{variant:"h2",className:n.color,style:{width:"max-content"},align:"center",children:b})})}):null})}}}]);
//# sourceMappingURL=6.d642b8b2.chunk.js.map