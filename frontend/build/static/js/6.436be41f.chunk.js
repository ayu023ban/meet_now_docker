(this.webpackJsonpteams_frontend=this.webpackJsonpteams_frontend||[]).push([[6],{190:function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"e",(function(){return l})),n.d(t,"b",(function(){return d})),n.d(t,"d",(function(){return j})),n.d(t,"h",(function(){return f})),n.d(t,"i",(function(){return b})),n.d(t,"f",(function(){return h})),n.d(t,"g",(function(){return O})),n.d(t,"c",(function(){return g}));var r=n(35),c=n(31),i=n(29),a=n(36),o=n(16),s=n(48),u=function(e){var t=a.a;return function(n){r.a.post(t,e).then((function(e){n(Object(o.a)(i.a,e.data)),navigator.clipboard.writeText(Object(o.e)(e.data.id)),c.b.success("copied to clipboard")})).catch((function(e){c.b.error("error occured in creating the room")}))}},l=function(){var e=a.d;return function(t){r.a.get(e).then((function(e){t(Object(o.a)(i.c,e.data))})).catch((function(e){c.b.error("error occured in fetching your rooms",{})}))}},d=function(e,t){var n="".concat(a.d).concat(e,"/");return function(c,i){r.a.delete(n).then((function(n){t(e)}))}},j=function(e){var t="".concat(a.d).concat(e,"/");return function(e){r.a.get(t).then((function(t){e(Object(o.a)(i.b,t.data))}))}},f=function(){return function(e){e(Object(o.a)(i.e))}},b=function(){return function(e){e(Object(o.a)(i.f))}},h=function(e,t){var n=Object(a.g)(e);return function(e){r.a.post(n,t).then((function(t){e(Object(o.a)(i.b,t.data)),c.b.success("user invited")})).catch((function(e){c.b.error(e.response.data)}))}},O=function(e,t){var n=Object(a.j)(e);return function(e){r.a.post(n,t).then((function(t){e(Object(o.a)(i.b,t.data)),e(Object(s.d)())})).catch((function(e){c.b.error(e.response.data)}))}},g=function(e){var t=Object(a.h)(e);return function(e){r.a.get(t).then((function(t){e(Object(o.a)(i.d,t.data.isCreator))}))}}},249:function(e,t,n){},275:function(e,t){},277:function(e,t){},319:function(e,t,n){"use strict";n.r(t);var r=n(42),c=n(0),i=n.n(c),a=n(199),o=n(200),s=function(){function e(){Object(a.a)(this,e),this.callbacks={},this.socketRef=null,this.fallback=null,this.forcedClose=!1}return Object(o.a)(e,[{key:"connect",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};this.forcedClose=!1,this.fallback=n,this.socketRef=new WebSocket(e),this.socketRef.onopen=function(){console.log("websocket open")},this.socketRef.onmessage=function(e){t.socketNewMessage(e.data)},this.socketRef.onerror=function(e){console.debug(e)},this.socketRef.onclose=function(r){console.log(r),4e3===r.code?t.fallback(r):t.forcedClose?console.log("websocket closed"):(console.log("websockets closed lets reopen"),setTimeout((function(){t.connect(e,n(r))}),5e3))}}},{key:"close",value:function(e,t){"undefined"==typeof e&&(e=1e3),this.forcedClose=!0,this.socketRef&&this.socketRef.close(e,t)}},{key:"on",value:function(e,t){this.callbacks[e]=t}},{key:"socketNewMessage",value:function(e){var t=JSON.parse(e),n=t.command,r=t.data;0!==Object.keys(this.callbacks).length&&this.callbacks[n]&&this.callbacks[n](r)}},{key:"sendMessage",value:function(e,t){try{this.waitForConnection(function(){this.socketRef.send(JSON.stringify({type:e,data:t}))}.bind(this),1e3)}catch(n){console.log(n.message)}}},{key:"refresh",value:function(){this.socketRef&&this.socketRef.close()}},{key:"state",value:function(){return this.socketRef.readyState}},{key:"waitForConnection",value:function(e,t){if(1===this.state())e();else{var n=this;setTimeout((function(){n.waitForConnection(e,t)}),t)}}}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}]),e}();s.instance=null;var u=s.getInstance(),l=n(10),d=n(4),j=n(207),f=n.n(j),b=n(208),h=n(13),O=n(177),g=n(322),m=n(182),p=n(181),v=n(209),x=n.n(v),k=n(187),w=n(305),y=n(239),C=n.n(y),R=n(240),M=n.n(R),I=n(31),_=n(2),N=Object(O.a)((function(e){return{responsive:function(e){var t=e.size,n=e.rows;return{float:"left",width:"".concat(100/t-2,"%"),height:"".concat(100/n-2,"%"),display:"flex",alignItems:"center"}},videoTop:{background:e.palette.background.paper},micOff:{position:"absolute",right:0,top:0},videoOff:{position:"absolute",width:"100%",height:"100%",top:0,left:0,display:"flex",justifyContent:"center",alignItems:"center"},avatar:{width:"min(50%, 10rem)",height:"min(50%, 10rem)",fontSize:"3rem"},hoverDiv:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%"},remove:{color:"white","&:disabled":{color:"#444"}},name:{position:"absolute",bottom:"0.5rem",left:"1rem",color:"white"}}})),T=i.a.forwardRef((function(e,t){var n=e.peer,a=e.muted,o=e.size,s=e.rows,l=e.isUserVideo,d=e.user,j=Object(c.useRef)(null),f=t||j,b=N({size:o,rows:s}),O=i.a.useState(!1),v=Object(r.a)(O,2),y=v[0],R=v[1],T=Object(h.c)((function(e){return e.roomReducer.isUserCreator})),D=Object(h.c)((function(e){return e.roomReducer.currentRoom.invited_users})),S=Object(c.useRef)(null),B=S.current?9*S.current.getBoundingClientRect().width/16<S.current.getBoundingClientRect().height?"".concat(.95*S.current.getBoundingClientRect().width,"px"):"".concat(.95*S.current.getBoundingClientRect().height*16/9,"px"):"auto",E=S.current?9*S.current.getBoundingClientRect().width/16>S.current.getBoundingClientRect().height?"".concat(.95*S.current.getBoundingClientRect().height,"px"):"".concat(.95*S.current.getBoundingClientRect().width*9/16,"px"):"auto",U=(d.first_name?d.first_name[0].toUpperCase():"")+(d.last_name?d.last_name[0].toUpperCase():""),V=d.first_name+" "+d.last_name;V=V.trim(),l&&(V="You"),Object(c.useEffect)((function(){n&&n.on("stream",(function(e){f.current.srcObject=e}))}),[]);return Object(_.jsx)("div",{className:b.responsive,ref:S,children:Object(_.jsxs)("div",{className:b.videoTop,style:{width:B,height:E,position:"relative",overflow:"hidden",margin:"auto",borderRadius:"1rem"},children:[Object(_.jsx)("video",{style:{objectFit:"contain",transform:l?"scaleX(-1)":1,position:"absolute",top:"0",left:"0",display:d.videoOn?"block":"none"},playsInline:!0,width:"100%",height:"100%",autoPlay:!0,muted:a,ref:f,onClick:function(){},onMouseEnter:function(){R(!0)}}),Object(_.jsx)(w.a,{in:y,children:Object(_.jsx)("div",{className:b.hoverDiv,onMouseLeave:function(){R(!1)},children:Object(_.jsxs)("div",{style:{opacity:.6,background:"black",width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center"},children:[Object(_.jsx)(g.a,{title:"remove user",children:Object(_.jsx)(m.a,{className:b.remove,onClick:function(){T&&!l&&u.sendMessage("user kick",{userID:d.id})},disabled:!T||l,children:Object(_.jsx)(C.a,{fontSize:"large"})})}),Object(_.jsx)(g.a,{title:"Block user",children:Object(_.jsx)(m.a,{className:b.remove,onClick:function(){T&&!l&&(D.some((function(e){return e.id===d.id}))?I.b.error("user is invited. first remove the invitation"):u.sendMessage("user block",{userID:d.id}))},disabled:!T||l,children:Object(_.jsx)(M.a,{fontSize:"large"})})}),Object(_.jsx)(p.a,{variant:"p",className:b.name,children:V})]})})}),!d.audioOn&&Object(_.jsx)(m.a,{className:b.micOff,children:Object(_.jsx)(x.a,{})}),!d.videoOn&&Object(_.jsx)("div",{className:b.videoOff,children:Object(_.jsx)(k.a,{className:b.avatar,children:U})})]})})})),D=n(143),S=n(236),B=n(151),E=n(188),U=n(66),V=n(241),z=n.n(V),A=n(242),F=n.n(A),H=n(243),W=n.n(H),J=n(244),L=n.n(J),P=n(247),q=n.n(P),G=n(190),X=n(246),Y=n.n(X),K=n(245),Q=n.n(K),Z=n(306),$=n(308),ee=n(309),te=n(310),ne=n(311),re=n(229),ce=n(206),ie=n.n(ce),ae=function(e){var t=e.open,n=e.setOpen,r=Object(h.c)((function(e){return e.roomReducer.currentRoom.room_name}));return Object(_.jsxs)(Z.a,{open:t,onClose:function(){n((function(e){return!e}))},"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[Object(_.jsx)($.a,{id:"alert-dialog-title",children:"Meeting Details"}),Object(_.jsxs)(ee.a,{children:[Object(_.jsx)(p.a,{variant:"h5",children:r}),Object(_.jsx)("br",{}),Object(_.jsx)(p.a,{variant:"p",children:"Joining info"}),Object(_.jsx)(te.a,{id:"alert-dialog-description",children:window.location.href})]}),Object(_.jsx)(ne.a,{children:Object(_.jsx)(ie.a,{text:window.location.href,onCopy:function(){I.b.success("copied to clipboard")},children:Object(_.jsx)(re.a,{children:"Copy link"})})})]})},oe=n(318),se=n(312),ue=n(313),le=n(210),de=n.n(le),je=n(198),fe=n.n(je),be=n(16),he=function(e){var t=e.open,n=e.setOpen,i=Object(l.i)().roomID,a=Object(h.c)((function(e){return e.roomReducer.currentRoom.invited_users||[]})),o=Object(c.useState)({str:"",err_message:""}),s=Object(r.a)(o,2),u=s[0],d=s[1],j=Object(h.b)();return Object(_.jsxs)(Z.a,{open:t,onClose:function(){n((function(e){return!e}))},children:[Object(_.jsx)($.a,{children:"Invite people"}),Object(_.jsxs)(ee.a,{children:[a.map((function(e,t){return Object(_.jsxs)(se.a,{style:{alignItems:"center"},children:[Object(_.jsx)(ue.a,{children:e.email}),Object(_.jsx)(m.a,{onClick:function(){j(Object(G.g)(i,{invitee:e.email}))},children:Object(_.jsx)(de.a,{})})]},t)})),Object(_.jsx)(oe.a,{error:u.err_message.length>0,value:u.str,onChange:function(e){var t=e.target.value;d({str:t,err_message:""})},helperText:u.err_message}),Object(_.jsx)(m.a,{onClick:function(){var e=u.str,t="";0===e.length?t="email can't be empty":Object(be.f)(e)?(j(Object(G.f)(i,{invitee:e})),d({str:"",err_message:""})):t="email not valid",t.length&&d({str:e,err_message:t})},children:Object(_.jsx)(fe.a,{})})]})]})},Oe=n(304),ge=n(97),me=n(248),pe=n.n(me),ve=Object(O.a)((function(e){return{container:{minHeight:"3rem",flexGrow:0,background:e.palette.background.default},blue:{background:"blue"},orange:{color:U.a[500]},right:{marginRight:"1rem"}}})),xe=function(e){e.switchc;var t=e.toggleChat,n=ve(),a=Object(h.b)(),o=Object(h.c)((function(e){return e.roomReducer.userVideo.audioOn})),s=Object(h.c)((function(e){return e.roomReducer.userVideo.videoOn})),u=Object(c.useState)(!1),d=Object(r.a)(u,2),j=d[0],f=d[1],b=Object(c.useState)(!1),O=Object(r.a)(b,2),v=O[0],k=O[1],w=Object(l.g)(),y=Object(h.c)((function(e){return e.roomReducer.currentRoom.room_name})),C=Object(h.c)((function(e){return e.roomReducer.isUserCreator})),R=Object(ge.a)(),M=Object(Oe.a)(R.breakpoints.down("sm")),I=i.a.useState(null),N=Object(r.a)(I,2),T=N[0],U=N[1],V=Boolean(T);return Object(_.jsx)(D.a,{elevation:3,className:n.container,children:Object(_.jsxs)(S.a,{justify:"space-between",container:!0,alignItems:"center",style:{height:"100%"},children:[Object(_.jsx)("div",{children:Object(_.jsx)(p.a,{variant:"h5",style:{marginLeft:"1rem"},children:y})}),Object(_.jsxs)("div",{children:[Object(_.jsx)(g.a,{title:o?"Mic On":"Mic off",children:Object(_.jsx)(m.a,{color:"inherit",onClick:function(){a(Object(G.h)())},children:o?Object(_.jsx)(z.a,{}):Object(_.jsx)(x.a,{})})}),Object(_.jsx)(g.a,{title:"end call",children:Object(_.jsx)(m.a,{color:"inherit",onClick:function(){w.replace("/")},children:Object(_.jsx)(F.a,{className:n.orange})})}),Object(_.jsx)(g.a,{title:s?"video on":"video off",children:Object(_.jsx)(m.a,{color:"inherit",onClick:function(){a(Object(G.i)())},children:s?Object(_.jsx)(W.a,{}):Object(_.jsx)(L.a,{})})})]}),!M&&Object(_.jsxs)("div",{className:n.right,children:[C&&Object(_.jsx)(g.a,{title:"invite users",children:Object(_.jsx)(m.a,{onClick:function(){k((function(e){return!e}))},children:Object(_.jsx)(Q.a,{})})}),Object(_.jsx)(g.a,{title:"Meeting Details",children:Object(_.jsx)(m.a,{onClick:function(){f((function(e){return!e}))},children:Object(_.jsx)(Y.a,{})})}),Object(_.jsx)(g.a,{title:"Chat",children:Object(_.jsx)(m.a,{onClick:t,children:Object(_.jsx)(q.a,{})})})]}),M&&Object(_.jsxs)("div",{className:n.right,children:[Object(_.jsx)(m.a,{"aria-controls":"simple-theme-menu","aria-haspopup":"true",color:"inherit",className:"header-title-button",onClick:function(e){return U(e.currentTarget)},children:Object(_.jsx)(pe.a,{})}),Object(_.jsxs)(B.a,{anchorEl:T,id:"controls-menu",keepMounted:!0,open:V,onClose:function(){U(null)},children:[Object(_.jsx)(E.a,{onClick:function(){U(null),k((function(e){return!e}))},children:"Invite User"}),Object(_.jsx)(E.a,{onClick:function(){U(null),f((function(e){return!e}))},children:"Meeting Details"}),Object(_.jsx)(E.a,{onClick:function(){U(null),t()},children:"Chat"})]})]}),C&&Object(_.jsx)(he,{open:v,setOpen:k}),Object(_.jsx)(ae,{open:j,setOpen:f})]})})},ke=function(e){for(var t=Math.floor(Math.sqrt(e)),n=t-e%t,r=Math.floor(e/t),c=[],i=0;i<t;i++)i>=n?c.push(r+1):c.push(r);c=c.reverse();for(var a={},o=1,s=0,u=1;u<=e;u++)a[u]=c[s],++o>c[s]&&(o=1,s++);return a.rows=c.length,a};var we=function(e,t){return(e+" "+t).trim()},ye=n(58),Ce=n(323),Re=n(250),Me=n.n(Re),Ie=n(315),_e=n(314),Ne=(n(249),Object(O.a)((function(e){return{drawer:{width:360,flexShrink:0},drawerPaper:{width:360,height:"calc(100vh - 9rem)",borderRadius:"1rem",top:"5rem",right:"12px"},drawerHeader:Object(d.a)(Object(d.a)({display:"flex",alignItems:"center",padding:e.spacing(0,1)},e.mixins.toolbar),{},{justifyContent:"flex-start"}),chatInputContainer:{marginTop:"auto"},chatInput:{marginBottom:"2rem","& .MuiFilledInput-root":{borderRadius:"50px",borderBottom:0,paddingTop:"15px",paddingBottom:"15px","&::before":{borderBottom:0}}},messageBoxRight:{background:e.palette.background.paper,color:e.palette.text.primary},messageBoxLeft:{background:"#4870df",color:e.palette.background.default},messageSender:{color:e.palette.text.primary,fontSize:"10px"}}}))),Te=function(e){var t=Object(h.c)((function(e){return e.userReducer.user})),n=Ne(),r=t.pk===e.sender.id?"chatApp__convMessageItem--right":"chatApp__convMessageItem--left",c=t.pk===e.sender.id?n.messageBoxRight:n.messageBoxLeft;return Object(_.jsx)("div",{className:"chatApp__convMessageItem "+r+" clearfix",children:Object(_.jsxs)("div",{className:"chatApp__convMessageValue ".concat(c),children:[t.pk!==e.sender.id&&Object(_.jsx)("div",{className:n.messageSender,children:e.sender.first_name}),Object(_.jsx)("div",{children:e.message})]})})},De=i.a.memo((function(e){return Object(_.jsx)("div",{className:"chatApp__convTimeline",children:e.messages.slice(0).reverse().map((function(e,t){return Object(_.jsx)(Te,{sender:e.sender,senderAvatar:e.senderAvatar,message:e.message},t)}))})})),Se=function(e){var t=e.open,n=e.setOpen,i=Object(c.useState)([]),a=Object(r.a)(i,2),o=a[0],s=a[1],l=Object(c.useState)(""),d=Object(r.a)(l,2),j=d[0],f=d[1],b=Ne();Object(c.useEffect)((function(){u.on("receive new message",(function(e){s((function(t){return[].concat(Object(ye.a)(t),[e])}))}))}),[]);var h=Object(c.useCallback)((function(e){var t=e.target.value;f(t)}),[]);return Object(_.jsxs)(Ce.a,{className:b.drawer,variant:"persistent",anchor:"right",open:t,classes:{paper:b.drawerPaper},children:[Object(_.jsx)("div",{className:b.drawerHeader,children:Object(_.jsx)(m.a,{onClick:function(){n(!1)},children:Object(_.jsx)(Me.a,{})})}),Object(_.jsx)(De,{messages:o}),Object(_.jsx)("div",{className:b.chatInputContainer,children:Object(_.jsx)(oe.a,{placeholder:"send a message to everyone",size:"small",variant:"filled",fullWidth:!0,multiline:!0,rowsMax:4,className:b.chatInput,value:j,onChange:h,InputProps:{endAdornment:Object(_.jsx)(_e.a,{position:"end",children:j.length>0&&Object(_.jsx)(m.a,{"aria-label":"toggle password visibility",onClick:function(){u.sendMessage("send new message",j),f("")},children:Object(_.jsx)(Ie.a,{})})})}})})]})},Be=n(37),Ee=n(290),Ue=n(72),Ve=n(251),ze=n.n(Ve);var Ae=function(e,t,n,r){return function(c){e.current={};var i={};c.forEach((function(r){if(t!==r.id){var c=function(e,t,n){var r=new ze.a({initiator:!0,trickle:!1,stream:n});return r.on("signal",(function(n){u.sendMessage("sending signal",{userToSignal:e,callerID:t,signal:n})})),r}(r.id,t,n);e.current[r.id]={user:r,peer:c},i[r.id]={user:r,peer:c}}})),r(i)}},Fe=function(e,t,n,r,c,i){return function(a){var o=a.callerUser;if(a.usable_id===e){var s=function(e,t,n){var r=new ze.a({initiator:!1,trickle:!1,stream:n});return r.on("signal",(function(e){u.sendMessage("returning signal",{signal:e,callerID:t})})),r.signal(e),r}(a.signal,o.id,n);t.current[o.id]={user:o,peer:s},r((function(e){return Object(d.a)(Object(d.a)({},e),{},Object(Ue.a)({},o.id,{user:o,peer:s}))})),u.sendMessage("audioMedia",{userID:e,audioOn:c}),u.sendMessage("videoMedia",{userID:e,videoOn:i}),I.b.info("".concat(we(o.first_name,o.last_name)," joined"))}}},He=n(317),We=n(287),Je=n.n(We),Le=n(144),Pe=Object(Le.a)((function(e){return{modal:{"&& .modal-content":{background:e.palette.background.paper,color:e.palette.text.primary}}}})),qe=function(e){var t=e.waitingUsers,n=e.setWaitingUsers,r=Pe();return Object(_.jsxs)(He.a,{show:Boolean(t.length),onHide:function(){},backdrop:"static",keyboard:!1,className:r.modal,children:[Object(_.jsx)(He.a.Header,{children:Object(_.jsx)(He.a.Title,{children:"Modal title"})}),Object(_.jsx)(He.a.Body,{children:t.map((function(e,t){return Object(_.jsxs)(se.a,{style:{alignItems:"center"},children:[Object(_.jsxs)(ue.a,{children:[e.first_name," wants to join"]}),Object(_.jsx)(m.a,{onClick:function(){!function(e){u.sendMessage("give join permission status",{userID:e.id,status:"reject"}),n((function(t){return t.filter((function(t){return t.id!==e.id}))}))}(e)},children:Object(_.jsx)(de.a,{})}),Object(_.jsx)(m.a,{onClick:function(){!function(e){u.sendMessage("give join permission status",{userID:e.id,status:"accept"}),n((function(t){return t.filter((function(t){return t.id!==e.id}))}))}(e)},children:Object(_.jsx)(Je.a,{})})]},t)}))}),Object(_.jsx)(He.a.Footer,{})]})},Ge=function(e,t,n){return function(r){for(var c in e.current)e.current[c].peer.streams.forEach((function(e){e.getTracks().forEach((function(e){e.stop()}))}));t(Object(d.a)({},e.current)),n.removeTrack(n.getVideoTracks()[0]),n.addTrack(r.getVideoTracks()[0])}},Xe={height:window.innerHeight/2,width:window.innerWidth/2},Ye=Object(O.a)((function(e){return{container:{display:"flex",height:"100%",width:"100%",flexDirection:"column",background:e.palette.background.default}}})),Ke=function(e,t,n,r,c,i,a){u.on("all users",Ae(e,t,n,r)),u.on("user joined",Fe(t,e,n,r,c,i)),u.on("receiving returned signal",function(e,t){return function(n){n.usable_id===e&&t.current[n.id].peer.signal(n.signal)}}(t,e)),u.on("user left",function(e,t,n){return function(r){var c=r.user;t.current[c.id]&&t.current[c.id].peer.destroy(),delete t.current[c.id],n((function(e){var t=r.user.id;return e[t],Object(Be.a)(e,[t].map(Ee.a))})),r.user.id!==e&&I.b.info("".concat(we(c.first_name,c.last_name)," left"))}}(t,e,r)),u.on("videoMedia",function(e,t){return function(n){var r=n.userID;e.current[r]&&(e.current[r].user.videoOn=n.videoOn,t((function(e){var t=e[r],c=t.user,i=t.peer;return Object(d.a)(Object(d.a)({},e),{},Object(Ue.a)({},r,{peer:i,user:Object(d.a)(Object(d.a)({},c),{},{videoOn:n.videoOn})}))})))}}(e,r)),u.on("audioMedia",function(e,t){return function(n){var r=n.userID;e.current[r]&&(e.current[r].user.audioOn=n.audioOn,t((function(e){var t=e[r],c=t.user,i=t.peer;return Object(d.a)(Object(d.a)({},e),{},Object(Ue.a)({},r,{peer:i,user:Object(d.a)(Object(d.a)({},c),{},{audioOn:n.audioOn})}))})))}}(e,r)),u.on("user want to join",function(e,t){return function(n){n.usable_id===e&&t((function(e){return e.push(n.user),Object(be.d)(e,"id")}))}}(t,a))},Qe=function(){var e=Object(l.i)().roomID,t=Object(c.useState)({}),n=Object(r.a)(t,2),i=n[0],a=n[1],o=Object(c.useRef)(),s=Object(c.useRef)(u),j=Object(c.useRef)({}),O=Object(h.c)((function(e){return e.userReducer.user.pk})),g=Object(c.useState)(),m=Object(r.a)(g,2),p=m[0],v=m[1],x=Object(c.useRef)(0),k=ke(Object.keys(i).length+1),w=Object(c.useState)(!1),y=Object(r.a)(w,2),C=y[0],R=y[1],M=Object(h.c)((function(e){return e.roomReducer.userVideo.audioOn})),I=Object(h.c)((function(e){return e.roomReducer.userVideo.videoOn})),N=Ye(),D=Object(h.c)((function(e){return e.userReducer.user})),S=Object(c.useState)([]),B=Object(r.a)(S,2),E=B[0],U=B[1],V=Object(h.b)(),z=function(){var e=Object(b.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.getUserMedia({video:!0,audio:!0});case 2:t=e.sent,v(t),o&&o.current&&(o.current.srcObject=t);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),A=function(){var t=Object(b.a)(f.a.mark((function t(){return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,z();case 2:s.current.sendMessage("join room",e);case 3:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return Object(c.useEffect)((function(){V(Object(G.c)(e)),V(Object(G.d)(e)),A()}),[]),Object(c.useEffect)((function(){Ke(j,O,p,a,M,I,U)}),[p,M,I,O]),Object(c.useEffect)((function(){var e=p;return function(){e&&(e.getVideoTracks().forEach((function(e){e.stop()})),e.getAudioTracks().forEach((function(e){e.stop()})))}}),[p]),Object(c.useEffect)((function(){p&&(p.getAudioTracks()[0].enabled=M,1===s.current.state()&&s.current.sendMessage("audioMedia",{userID:O,audioOn:M}))}),[p,M,O]),Object(c.useEffect)((function(){p&&(p.getVideoTracks()[0].enabled=I,1===s.current.state()&&s.current.sendMessage("videoMedia",{userID:O,videoOn:I}))}),[p,I,O]),Object(c.useEffect)((function(){k=ke(Object.keys(i).length+1)}),[i]),Object(_.jsxs)("div",{className:N.container,children:[Object(_.jsxs)("div",{style:{display:"flex",width:"100%",maxHeight:"calc(100vh - 7rem)",margin:"auto",flexGrow:"1",flexWrap:"wrap"},children:[Object(_.jsx)(T,{muted:!0,ref:o,user:Object(d.a)(Object(d.a)({},D),{},{videoOn:I,audioOn:M}),autoPlay:!0,playsInline:!0,size:k[1],rows:k.rows,isUserVideo:!0}),Object.values(j.current).map((function(e,t){return Object(_.jsx)(T,{peer:e.peer,user:e.user,size:k[t+2],rows:k.rows},t)}))]}),Object(_.jsx)(qe,{waitingUsers:E,setWaitingUsers:U}),Object(_.jsx)(xe,{switchc:function(){var e;(e=Xe,function(){var t=Object(b.a)(f.a.mark((function t(n){var r,c,i,a;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,navigator.mediaDevices.enumerateDevices();case 2:return r=t.sent,c=r.filter((function(e){return"videoinput"===e.kind})),n.current=(n.current+1)%c.length,i=Object(d.a)(Object(d.a)({},e),{},{deviceId:{exact:c[n.current].deviceId}}),e=i,t.next=9,navigator.mediaDevices.getUserMedia({video:e,audio:!0});case 9:a=t.sent,Ge(a);case 11:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())(x)},toggleChat:function(){R((function(e){return!e}))}}),Object(_.jsx)(Se,{open:C,setOpen:R})]})},Ze=n(173),$e=Object(Le.a)((function(e){return{container:{background:e.palette.background.default,height:"100%",width:"100%",position:"relative"},color:{color:e.palette.text.primary},paper:{display:"flex",alignItems:"center",justifyContent:"center",maxWidth:"75vw",position:"relative",marginLeft:"auto",marginRight:"auto",top:"3rem"}}}));t.default=function(){var e=Object(l.i)().roomID,t=Object(l.g)(),n=$e(),i=Object(h.c)((function(e){return e.userReducer.user.pk})),a=Object(c.useState)("pending"),o=Object(r.a)(a,2),s=o[0],d=o[1],j=Object(c.useState)(""),f=Object(r.a)(j,2),b=f[0],O=f[1];return Object(c.useEffect)((function(){u.refresh();var n="http:"===window.location.protocol?"ws":"wss",r=window.location.hostname.includes("localhost")?"localhost:7000":window.location.hostname;return u.connect("".concat(n,"://").concat(r,"/ws/room/").concat(e,"/"),(function(e){t.replace("/",{message:"the url entered is incorrect.",type:"error"})})),u.on("get permission",function(e,t){return function(n){n.usable_id===e&&t(n.status)}}(i,d)),u.on("join message",function(e,t){return function(n){e("message"),"creator not available"===n?t("The Organisor has not joined the room yet. Please try joining after some time"):"user blocked"===n&&t("The Organisor has blocked you.")}}(d,O)),u.on("user kicked",function(e,t){return function(n){n.usable_id===e&&t.replace("/",{message:"The Organisor removed you from room",type:"error"})}}(i,t)),u.on("user blocked",function(e,t){return function(n){n.usable_id===e&&t.replace("/",{message:"The Organisor blocked you from room",type:"error"})}}(i,t)),function(){u.close()}}),[]),Object(c.useEffect)((function(){"reject"===s&&t.replace("/",{message:"The creator rejected the join request",type:"error"})}),[s]),Object(_.jsx)(_.Fragment,{children:"pending"===s?Object(_.jsx)("div",{className:n.container,children:Object(_.jsxs)(D.a,{elevation:3,variant:"outlined",className:n.paper,children:[Object(_.jsx)(p.a,{variant:"h2",className:n.color,style:{width:"max-content"},children:"Joining the room"}),Object(_.jsx)(Ze.a,{className:n.color,style:{marginLeft:"1rem"}})]})}):"accept"===s?Object(_.jsx)(Qe,{}):"message"===s?Object(_.jsx)("div",{className:n.container,children:Object(_.jsx)(D.a,{elevation:3,variant:"outlined",className:n.paper,children:Object(_.jsx)(p.a,{variant:"h2",className:n.color,style:{width:"max-content"},align:"center",children:b})})}):null})}}}]);
//# sourceMappingURL=6.436be41f.chunk.js.map