{"version":3,"sources":["redux/actions/roomActions.js","helper/WebsocketService.js","components/common/Video.js","components/Room/DetailModal.js","components/Room/InviteModal.js","components/Room/Controls.js","helper/utilFunctions.js","components/Room/Chat.js","helper/socketListeners.js","helper/peers.js","components/Room/JoinModal.js","helper/streamFunctions.js","views/RoomView.js","views/View.js"],"names":["createNewRoom","data","url","create_room","dispatch","apiClient","post","then","res","apiDispatch","CREATE_ROOM","navigator","clipboard","writeText","getUrlFromCode","id","toast","success","catch","err","error","getRooms","get_room","get","GET_ROOMS","deleteRoom","roomID","fallback","getState","delete","getRoom","GET_ROOM","toggleAudio","TOGGLE_USER_AUDIO","toggleVideo","TOGGLE_USER_VIDEO","inviteUser","roomId","invite","response","removeInviteUser","removeInvite","getInvitations","getIsUserCreator","isUserCreator","SET_USER_IS_CREATOR","isCreator","setMessages","SET_MESSAGES","setNewMessage","messages","roomReducer","roomMessages","WebSocketService","callbacks","this","socketRef","forcedClose","chatroom_url","WebSocket","onopen","console","log","onmessage","e","socketNewMessage","onerror","debug","onclose","code","setTimeout","connect","reason","close","command","func","received_data","parsedData","JSON","parse","Object","keys","length","type","waitForConnection","send","stringify","bind","message","readyState","callback","interval","state","that","instance","WebSocketInstance","getInstance","useStyles","makeStyles","theme","responsive","float","display","alignItems","transition","videoTop","background","palette","paper","micOff","position","right","top","videoOff","width","height","left","justifyContent","avatar","fontSize","hoverDiv","zIndex","remove","color","name","bottom","Video","React","forwardRef","ref","peer","muted","size","rows","isUserVideo","user","isSharingScreen","pinnedUser","setPinnedUser","localRef","useRef","currentRef","userId","pk","classes","useState","open","setOpen","useSelector","invitedUsers","currentRoom","invited_users","mangoRef","videoWidth","setVideoWidth","videoHeight","setVideoHeight","resizeObserver","ResizeObserver","entries","newWidth","newHeight","entry","contentBoxSize","contentRect","useEffect","observe","current","initials","first_name","toUpperCase","last_name","fullName","trim","on","stream","srcObject","className","style","overflow","margin","borderRadius","objectFit","transform","videoOn","playsInline","autoPlay","onClick","onMouseEnter","onTouchEnd","o","Fade","in","onMouseLeave","opacity","Tooltip","title","IconButton","stopPropagation","sendMessage","userID","disabled","some","el","Typography","variant","audioOn","Avatar","DetailModal","roomName","room_name","Dialog","onClose","aria-labelledby","aria-describedby","DialogTitle","DialogContent","DialogContentText","window","location","href","DialogActions","text","onCopy","Button","InviteModal","useParams","str","err_message","email","setEmail","useDispatch","map","idx","Row","Col","invitee","TextField","value","onChange","target","helperText","validateEmailAddress","container","minHeight","flexGrow","default","blue","orange","red","marginRight","join","primary","Controls","switchc","shareScreen","toggleChat","isJoinedRoom","setIsJoinedRoom","leaveMeet","isAudioOn","userVideo","isVideoOn","detailModalOpen","setDetailModalOpen","inviteModalOpen","setInviteModalOpen","useTheme","isMobile","useMediaQuery","breakpoints","down","anchorEl","setAnchorEl","isMenuOpen","Boolean","Paper","elevation","Grid","justify","marginLeft","aria-controls","aria-haspopup","event","currentTarget","Menu","keepMounted","MenuItem","split","x","n","Math","floor","sqrt","zp","pp","m","i","push","reverse","count","drawer","flexShrink","drawerPaper","drawerHeader","padding","spacing","mixins","toolbar","chatInputContainer","marginTop","chatInput","marginBottom","borderBottom","paddingTop","paddingBottom","messageBoxRight","messageBoxLeft","messageSender","MessageItem","props","owner","userReducer","messagePosition","sender","messageBackground","MessageList","memo","slice","messageItem","Chat","currMessage","setCurrMessage","onCurrMessageChanged","useCallback","val","Drawer","anchor","placeholder","fullWidth","multiline","rowsMax","InputProps","endAdornment","InputAdornment","aria-label","all_users_listener","peersRef","myID","setPeers","users","temp","forEach","userToSignal","callerID","Peer","initiator","trickle","signal","WebsocketService","createPeer","user_joined_listener","isUserAudioOn","isUserVideoOn","payload","firstName","lastName","callerUser","usable_id","incomingSignal","addPeer","peers","info","modal","JoinModal","waitingUsers","setWaitingUsers","Modal","show","onHide","backdrop","keyboard","Header","Title","Body","status","filter","rejectUser","acceptUser","Footer","updateStream","userStream","track","key","replaceTrack","getVideoTracks","removeTrack","addTrack","videoConstraints","setIsSharingScreen","a","mediaDevices","getDisplayMedia","cursor","screenStream","currTrack","screenTrack","onended","getUserMedia","video","audio","innerHeight","innerWidth","flexDirection","socketFunctions","receive_returned_signal","destroy","user_left_listener","videoMediaListener","audioMediaListener","getUniqueArray","getPermissionRequestListener","getMediaListener","Room","setUserStream","currentCameraRef","sizeMap","chatOpen","setChatOpen","me","setCameraStream","socketConnect","userStreamRef","stop","getAudioTracks","enabled","del","maxHeight","flexWrap","values","item","index","enumerateDevices","devices","videoDevices","device","kind","updatedConstraints","deviceId","exact","switchCamera","maxWidth","View","history","useHistory","acceptStatus","setAcceptStatus","serverMessage","setServerMessage","refresh","protocol","host","hostname","includes","replace","getPermissionListener","joinMessageListener","userKickedListener","userBlockedListener","CircularProgress","align"],"mappings":"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","file":"static/js/5.b1d5cf05.chunk.js","sourcesContent":["import apiClient from \"../../helper/apiclient\";\nimport { toast } from \"react-toastify\";\n\nimport {\n  CREATE_ROOM,\n  GET_ROOM,\n  GET_ROOMS,\n  SET_MESSAGES,\n  SET_USER_IS_CREATOR,\n  TOGGLE_USER_AUDIO,\n  TOGGLE_USER_VIDEO,\n} from \"./roomActionTypes\";\n\nimport {\n  create_room,\n  get_room,\n  invite,\n  isUserCreator,\n  removeInvite,\n} from \"../../config/backend_api\";\n\nimport { apiDispatch, getUrlFromCode } from \"../../helper/helperFunctions\";\nimport { getInvitations } from \"./userActions\";\n\nexport const createNewRoom = (data) => {\n  const url = create_room;\n  return (dispatch) => {\n    apiClient\n      .post(url, data)\n      .then((res) => {\n        dispatch(apiDispatch(CREATE_ROOM, res.data));\n        navigator.clipboard.writeText(getUrlFromCode(res.data.id));\n        toast.success(\"copied to clipboard\");\n      })\n      .catch((err) => {\n        toast.error(`error occured in creating the room`);\n      });\n  };\n};\n\nexport const getRooms = () => {\n  const url = get_room;\n  return (dispatch) => {\n    apiClient\n      .get(url)\n      .then((res) => {\n        dispatch(apiDispatch(GET_ROOMS, res.data));\n      })\n      .catch((err) => {\n        toast.error(`error occured in fetching your rooms`, {});\n      });\n  };\n};\n\nexport const deleteRoom = (roomID, fallback) => {\n  const url = `${get_room}${roomID}/`;\n  return (dispatch, getState) => {\n    apiClient.delete(url).then((res) => {\n      fallback(roomID);\n    });\n  };\n};\n\nexport const getRoom = (roomID) => {\n  const url = `${get_room}${roomID}/`;\n  return (dispatch) => {\n    apiClient.get(url).then((res) => {\n      dispatch(apiDispatch(GET_ROOM, res.data));\n    });\n  };\n};\n\nexport const toggleAudio = () => {\n  return (dispatch) => {\n    dispatch(apiDispatch(TOGGLE_USER_AUDIO));\n  };\n};\nexport const toggleVideo = () => {\n  return (dispatch) => {\n    dispatch(apiDispatch(TOGGLE_USER_VIDEO));\n  };\n};\n\nexport const inviteUser = (roomId, data) => {\n  const url = invite(roomId);\n  return (dispatch) => {\n    apiClient\n      .post(url, data)\n      .then((res) => {\n        dispatch(apiDispatch(GET_ROOM, res.data));\n        toast.success(\"user invited\");\n      })\n      .catch((err) => {\n        toast.error(err.response.data);\n      });\n  };\n};\n\nexport const removeInviteUser = (roomID, data) => {\n  const url = removeInvite(roomID);\n  return (dispatch) => {\n    apiClient\n      .post(url, data)\n      .then((res) => {\n        dispatch(apiDispatch(GET_ROOM, res.data));\n        dispatch(getInvitations());\n      })\n      .catch((err) => {\n        toast.error(err.response.data);\n      });\n  };\n};\n\nexport const getIsUserCreator = (roomId) => {\n  const url = isUserCreator(roomId);\n  return (dispatch) => {\n    apiClient.get(url).then((res) => {\n      dispatch(apiDispatch(SET_USER_IS_CREATOR, res.data.isCreator));\n    });\n  };\n};\n\nexport const setMessages = (data) => {\n  return (dispatch) => {\n    dispatch(apiDispatch(SET_MESSAGES, data));\n  };\n};\n\nexport const setNewMessage = (data) => {\n  return (dispatch, getState) => {\n    const messages = getState().roomReducer.roomMessages;\n    dispatch(apiDispatch(SET_MESSAGES, [...messages, data]));\n  };\n};\n","class WebSocketService {\n  static instance = null;\n  callbacks = {};\n\n  static getInstance() {\n    if (!WebSocketService.instance) {\n      WebSocketService.instance = new WebSocketService();\n    }\n    return WebSocketService.instance;\n  }\n\n  constructor() {\n    this.socketRef = null;\n    this.fallback = null;\n    this.forcedClose = false;\n  }\n\n  connect(chatroom_url, fallback = () => {}) {\n    this.forcedClose = false;\n    this.fallback = fallback;\n    this.socketRef = new WebSocket(chatroom_url);\n\n    this.socketRef.onopen = () => {\n      console.log(\"websocket open\");\n    };\n\n    this.socketRef.onmessage = (e) => {\n      this.socketNewMessage(e.data);\n    };\n\n    this.socketRef.onerror = (e) => {\n      console.debug(e);\n    };\n\n    this.socketRef.onclose = (e) => {\n      console.log(e);\n      if (e.code === 4000) {\n        this.fallback(e);\n      } else if (this.forcedClose) {\n        console.log(\"websocket closed\");\n      } else {\n        console.log(\"websockets closed lets reopen\");\n        setTimeout(() => {\n          this.connect(chatroom_url, fallback(e));\n        }, 5000);\n      }\n    };\n  }\n\n  close(code, reason) {\n    // Default CLOSE_NORMAL code\n    if (typeof code == \"undefined\") {\n      code = 1000;\n    }\n    this.forcedClose = true;\n    if (this.socketRef) {\n      this.socketRef.close(code, reason);\n    }\n  }\n  on(command, func) {\n    this.callbacks[command] = func;\n  }\n  del(command) {\n    if (this.callbacks[command]) {\n      delete this.callbacks[command];\n    }\n  }\n\n  socketNewMessage(received_data) {\n    const parsedData = JSON.parse(received_data);\n    const { command, data } = parsedData;\n    console.log(parsedData);\n    if (Object.keys(this.callbacks).length === 0) {\n      return;\n    }\n    if (this.callbacks[command]) {\n      this.callbacks[command](data);\n    }\n  }\n\n  sendMessage(type, data) {\n    try {\n      console.log(type, data);\n      this.waitForConnection(\n        function () {\n          this.socketRef.send(JSON.stringify({ type, data }));\n        }.bind(this),\n        1000\n      );\n    } catch (err) {\n      console.log(err.message);\n    }\n  }\n  refresh() {\n    if (this.socketRef) {\n      this.socketRef.close();\n    }\n  }\n\n  state() {\n    return this.socketRef.readyState;\n  }\n  waitForConnection(callback, interval) {\n    if (this.state() === 1) {\n      callback();\n    } else {\n      var that = this;\n      // optional: implement backoff for interval here\n      setTimeout(function () {\n        that.waitForConnection(callback, interval);\n      }, interval);\n    }\n  }\n}\n\nconst WebSocketInstance = WebSocketService.getInstance();\n\nexport default WebSocketInstance;\n","import { IconButton, makeStyles, Tooltip, Typography } from \"@material-ui/core\";\nimport React, { useEffect, useRef } from \"react\";\nimport MicOffIcon from \"@material-ui/icons/MicOff\";\nimport Avatar from \"@material-ui/core/Avatar\";\nimport Fade from \"@material-ui/core/Fade\";\nimport RemoveCircleOutlineIcon from \"@material-ui/icons/RemoveCircleOutline\";\nimport WebSocketInstance from \"../../helper/WebsocketService\";\nimport { useSelector } from \"react-redux\";\nimport BlockIcon from \"@material-ui/icons/Block\";\nimport { toast } from \"react-toastify\";\nimport FlashOnIcon from \"@material-ui/icons/FlashOn\";\nimport FlashOffIcon from \"@material-ui/icons/FlashOff\";\n\nconst useStyles = makeStyles((theme) => ({\n  responsive: () => ({\n    float: \"left\",\n    display: \"flex\",\n    alignItems: \"center\",\n    transition: \"width 0.5s, height 0.5s\",\n  }),\n  videoTop: {\n    background: theme.palette.background.paper,\n  },\n  micOff: {\n    position: \"absolute\",\n    right: 0,\n    top: 0,\n  },\n  videoOff: {\n    position: \"absolute\",\n    width: \"100%\",\n    height: \"100%\",\n    top: 0,\n    left: 0,\n    display: \"flex\",\n    justifyContent: \"center\",\n    alignItems: \"center\",\n  },\n  avatar: {\n    width: \"min(50%, 10rem)\",\n    height: \"min(50%, 10rem)\",\n    fontSize: \"3rem\",\n  },\n  hoverDiv: {\n    position: \"absolute\",\n    zIndex: 3,\n    top: \"0\",\n    left: \"0\",\n    width: \"100%\",\n    height: \"100%\",\n  },\n  remove: {\n    color: \"white\",\n    \"&:disabled\": { color: \"#444\" },\n  },\n  name: {\n    position: \"absolute\",\n    bottom: \"0.5rem\",\n    left: \"1rem\",\n    color: \"white\",\n  },\n}));\n\nconst Video = React.forwardRef(\n  (\n    {\n      peer,\n      muted,\n      size,\n      rows,\n      isUserVideo,\n      user,\n      isSharingScreen,\n      pinnedUser,\n      setPinnedUser,\n    },\n    ref\n  ) => {\n    const localRef = useRef(null);\n    const currentRef = ref || localRef;\n    const userId = user.pk || user.id;\n    const classes = useStyles();\n    const [open, setOpen] = React.useState(false);\n    const isCreator = useSelector((state) => state.roomReducer.isUserCreator);\n    const invitedUsers = useSelector(\n      (state) => state.roomReducer.currentRoom.invited_users\n    );\n    const mangoRef = useRef(null);\n    const [videoWidth, setVideoWidth] = React.useState();\n    const [videoHeight, setVideoHeight] = React.useState();\n\n    const resizeObserver = new ResizeObserver((entries) => {\n      let newWidth, newHeight;\n      for (let entry of entries) {\n        if (entry.contentBoxSize) {\n          newWidth =\n            (entry.contentRect.width * 9) / 16 < entry.contentRect.height\n              ? 0.95 * entry.contentRect.width\n              : (0.95 * entry.contentRect.height * 16) / 9;\n          newHeight =\n            (entry.contentRect.width * 9) / 16 > entry.contentRect.height\n              ? 0.95 * entry.contentRect.height\n              : (0.95 * entry.contentRect.width * 9) / 16;\n        }\n      }\n      setVideoWidth(newWidth);\n      setVideoHeight(newHeight);\n    });\n    useEffect(() => {\n      resizeObserver.observe(mangoRef.current);\n    }, []);\n    let initials =\n      (user.first_name ? user.first_name[0].toUpperCase() : \"\") +\n      (user.last_name ? user.last_name[0].toUpperCase() : \"\");\n    let fullName = user.first_name + \" \" + user.last_name;\n    fullName = fullName.trim();\n    if (isUserVideo) fullName = \"You\";\n\n    useEffect(() => {\n      if (peer) {\n        peer.on(\"stream\", (stream) => {\n          currentRef.current.srcObject = stream;\n        });\n      }\n    }, []);\n    const removeUser = (e) => {\n      e.stopPropagation();\n      if (!isCreator || isUserVideo || !open) return;\n      WebSocketInstance.sendMessage(\"user kick\", { userID: user.id });\n    };\n    const blockUser = (e) => {\n      e.stopPropagation();\n      if (!isCreator || isUserVideo || !open) return;\n      if (invitedUsers.some((el) => el.id === user.id)) {\n        toast.error(\"user is invited. first remove the invitation\");\n      } else {\n        WebSocketInstance.sendMessage(\"user block\", { userID: user.id });\n      }\n    };\n\n    return (\n      <div\n        className={classes.responsive}\n        ref={mangoRef}\n        style={{\n          width: `${\n            pinnedUser === userId ? 100 : pinnedUser === -1 ? 100 / size - 2 : 0\n          }%`,\n          height: `${\n            pinnedUser === userId ? 100 : pinnedUser === -1 ? 100 / rows - 2 : 0\n          }%`,\n        }}\n      >\n        <div\n          className={classes.videoTop}\n          style={{\n            width: videoWidth,\n            height: videoHeight,\n            position: \"relative\",\n            overflow: \"hidden\",\n            margin: \"auto\",\n            borderRadius: \"1rem\",\n          }}\n        >\n          <video\n            style={{\n              objectFit: \"contain\",\n              transform: isUserVideo && !isSharingScreen ? \"scaleX(-1)\" : 1,\n              position: \"absolute\",\n              top: \"0\",\n              left: \"0\",\n              display: user.videoOn ? \"block\" : \"none\",\n            }}\n            playsInline\n            width=\"100%\"\n            height=\"100%\"\n            autoPlay\n            muted={muted}\n            ref={currentRef}\n            onClick={() => {}}\n            onMouseEnter={() => {\n              setOpen(true);\n            }}\n            onTouchEnd={() => {\n              setOpen((o) => !o);\n            }}\n          />\n          {open && (\n            <Fade in={open}>\n              <div\n                className={classes.hoverDiv}\n                onMouseLeave={() => {\n                  setOpen(false);\n                }}\n                onTouchEnd={() => {\n                  setOpen((o) => !o);\n                }}\n              >\n                <div\n                  style={{\n                    opacity: 0.6,\n                    background: \"black\",\n                    width: \"100%\",\n                    height: \"100%\",\n                    display: \"flex\",\n                    justifyContent: \"center\",\n                    alignItems: \"center\",\n                  }}\n                >\n                  <Tooltip\n                    title={\n                      pinnedUser === userId ? \"remove pin\" : \"pin the user\"\n                    }\n                  >\n                    <IconButton\n                      className={classes.remove}\n                      onClick={(e) => {\n                        e.stopPropagation();\n                        if (!open) return;\n                        if (pinnedUser === userId) {\n                          setPinnedUser(-1);\n                        } else {\n                          setPinnedUser(userId);\n                        }\n                      }}\n                    >\n                      {pinnedUser === userId ? (\n                        <FlashOffIcon fontSize=\"large\" />\n                      ) : (\n                        <FlashOnIcon fontSize=\"large\" />\n                      )}\n                    </IconButton>\n                  </Tooltip>\n                  <Tooltip title=\"remove user\">\n                    <IconButton\n                      className={classes.remove}\n                      onClick={removeUser}\n                      disabled={!isCreator || isUserVideo}\n                    >\n                      <RemoveCircleOutlineIcon fontSize=\"large\" />\n                    </IconButton>\n                  </Tooltip>\n                  <Tooltip title=\"Block user\">\n                    <IconButton\n                      className={classes.remove}\n                      onClick={blockUser}\n                      disabled={!isCreator || isUserVideo}\n                    >\n                      <BlockIcon fontSize=\"large\" />\n                    </IconButton>\n                  </Tooltip>\n                  <Typography variant=\"p\" className={classes.name}>\n                    {fullName}\n                  </Typography>\n                </div>\n              </div>\n            </Fade>\n          )}\n          {!user.audioOn && (\n            <IconButton className={classes.micOff}>\n              <MicOffIcon />\n            </IconButton>\n          )}\n          {!user.videoOn && (\n            <div\n              className={classes.videoOff}\n              onMouseEnter={() => {\n                setOpen(true);\n              }}\n              onTouchEnd={() => {\n                setOpen((o) => !o);\n              }}\n            >\n              <Avatar className={classes.avatar}>{initials}</Avatar>\n            </div>\n          )}\n        </div>\n      </div>\n    );\n  }\n);\n\nexport default Video;\n","import React from \"react\";\nimport {\n  Typography,\n  Dialog,\n  DialogContent,\n  DialogContentText,\n  DialogTitle,\n  DialogActions,\n  Button,\n} from \"@material-ui/core\";\nimport { useSelector } from \"react-redux\";\nimport CopyToClipboard from \"react-copy-to-clipboard\";\nimport { toast } from \"react-toastify\";\n\nconst DetailModal = ({ open, setOpen }) => {\n  const roomName = useSelector(\n    (state) => state.roomReducer.currentRoom.room_name\n  );\n  return (\n    <Dialog\n      open={open}\n      onClose={() => {\n        setOpen((o) => !o);\n      }}\n      aria-labelledby=\"alert-dialog-title\"\n      aria-describedby=\"alert-dialog-description\"\n    >\n      <DialogTitle id=\"alert-dialog-title\">{\"Meeting Details\"}</DialogTitle>\n      <DialogContent>\n        <Typography variant=\"h5\">{roomName}</Typography>\n        <br></br>\n        <Typography variant=\"p\">{\"Joining info\"}</Typography>\n        <DialogContentText id=\"alert-dialog-description\">\n          {window.location.href}\n        </DialogContentText>\n      </DialogContent>\n      <DialogActions>\n        <CopyToClipboard\n          text={window.location.href}\n          onCopy={() => {\n            toast.success(\"copied to clipboard\");\n          }}\n        >\n          <Button>Copy link</Button>\n        </CopyToClipboard>\n      </DialogActions>\n    </Dialog>\n  );\n};\n\nexport default DetailModal;\n","import React from \"react\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogTitle,\n  IconButton,\n  TextField,\n} from \"@material-ui/core\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { Col, Row } from \"react-bootstrap\";\nimport CloseIcon from \"@material-ui/icons/Close\";\nimport { useState } from \"react\";\nimport SendIcon from \"@material-ui/icons/Send\";\nimport { validateEmailAddress } from \"../../helper/helperFunctions\";\nimport { inviteUser, removeInviteUser } from \"../../redux/actions/roomActions\";\nimport { useParams } from \"react-router\";\n\nconst InviteModal = ({ open, setOpen }) => {\n  const { roomID } = useParams();\n  const invitedUsers = useSelector(\n    (state) => state.roomReducer.currentRoom.invited_users || []\n  );\n  const [email, setEmail] = useState({\n    str: \"\",\n    err_message: \"\",\n  });\n  const dispatch = useDispatch();\n  const invite = () => {\n    const str = email.str;\n    let err_message = \"\";\n    if (str.length === 0) err_message = \"email can't be empty\";\n    else if (!validateEmailAddress(str)) err_message = \"email not valid\";\n    else {\n      dispatch(\n        inviteUser(roomID, {\n          invitee: str,\n        })\n      );\n      setEmail({ str: \"\", err_message: \"\" });\n    }\n    if (err_message.length) {\n      setEmail({ str, err_message });\n    }\n  };\n  return (\n    <Dialog\n      open={open}\n      onClose={() => {\n        setOpen((o) => !o);\n      }}\n    >\n      <DialogTitle>{\"Invite people\"}</DialogTitle>\n      <DialogContent>\n        {invitedUsers.map((user, idx) => (\n          <Row key={idx} style={{ alignItems: \"center\" }}>\n            <Col>{user.email}</Col>\n            <IconButton\n              onClick={() => {\n                dispatch(removeInviteUser(roomID, { invitee: user.email }));\n              }}\n            >\n              <CloseIcon />\n            </IconButton>\n          </Row>\n        ))}\n        <TextField\n          error={email.err_message.length > 0}\n          value={email.str}\n          onChange={(value) => {\n            const email = value.target.value;\n            setEmail({ str: email, err_message: \"\" });\n          }}\n          helperText={email.err_message}\n        />\n        <IconButton onClick={invite}>\n          <SendIcon />\n        </IconButton>\n      </DialogContent>\n    </Dialog>\n  );\n};\n\nexport default InviteModal;\n","import {\n  Grid,\n  IconButton,\n  makeStyles,\n  Paper,\n  Typography,\n  Tooltip,\n  Menu,\n  MenuItem,\n  Button,\n} from \"@material-ui/core\";\nimport React, { useState } from \"react\";\nimport { red } from \"@material-ui/core/colors\";\nimport MicIcon from \"@material-ui/icons/Mic\";\nimport CallEndIcon from \"@material-ui/icons/CallEnd\";\nimport MicOffIcon from \"@material-ui/icons/MicOff\";\nimport VideocamOutlinedIcon from \"@material-ui/icons/VideocamOutlined\";\nimport VideocamOffOutlinedIcon from \"@material-ui/icons/VideocamOffOutlined\";\nimport MessageOutlinedIcon from \"@material-ui/icons/MessageOutlined\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { toggleAudio, toggleVideo } from \"../../redux/actions/roomActions\";\nimport { useHistory } from \"react-router\";\nimport InfoOutlinedIcon from \"@material-ui/icons/InfoOutlined\";\nimport PersonAddIcon from \"@material-ui/icons/PersonAdd\";\nimport DetailModal from \"./DetailModal\";\nimport InviteModal from \"./InviteModal\";\nimport { useMediaQuery } from \"@material-ui/core\";\nimport { useTheme } from \"@material-ui/styles\";\nimport MoreVertIcon from \"@material-ui/icons/MoreVert\";\nimport ScreenShareOutlinedIcon from \"@material-ui/icons/ScreenShareOutlined\";\nimport FlipCameraAndroidIcon from \"@material-ui/icons/FlipCameraAndroid\";\n\nconst useStyles = makeStyles((theme) => ({\n  container: {\n    minHeight: \"3rem\",\n    flexGrow: 0,\n    background: theme.palette.background.default,\n  },\n  blue: { background: \"blue\" },\n  orange: {\n    color: red[500],\n  },\n  right: { marginRight: \"1rem\" },\n  join: {\n    color: theme.palette.background.default,\n    background: theme.palette.text.primary,\n    \"&:hover\": {\n      color: theme.palette.text.primary,\n      background: theme.palette.background.default,\n    },\n  },\n}));\n\nconst Controls = ({\n  switchc,\n  shareScreen,\n  toggleChat,\n  isJoinedRoom,\n  setIsJoinedRoom,\n  leaveMeet,\n}) => {\n  const classes = useStyles();\n  const dispatch = useDispatch();\n  const isAudioOn = useSelector((state) => state.roomReducer.userVideo.audioOn);\n  const isVideoOn = useSelector((state) => state.roomReducer.userVideo.videoOn);\n  const [detailModalOpen, setDetailModalOpen] = useState(false);\n  const [inviteModalOpen, setInviteModalOpen] = useState(false);\n  const roomName = useSelector(\n    (state) => state.roomReducer.currentRoom.room_name\n  );\n  const isUserCreator = useSelector((state) => state.roomReducer.isUserCreator);\n  const theme = useTheme();\n  const isMobile = useMediaQuery(theme.breakpoints.down(\"sm\"));\n  const [anchorEl, setAnchorEl] = React.useState(null);\n  const isMenuOpen = Boolean(anchorEl);\n\n  return (\n    <Paper elevation={3} className={classes.container}>\n      <Grid\n        justify=\"space-between\"\n        container\n        alignItems=\"center\"\n        style={{ height: \"100%\" }}\n      >\n        <div>\n          <Typography variant=\"h5\" style={{ marginLeft: \"1rem\" }}>\n            {roomName}\n          </Typography>\n        </div>\n        <div>\n          <Tooltip title={isAudioOn ? \"Mic On\" : \"Mic off\"}>\n            <IconButton\n              color=\"inherit\"\n              onClick={() => {\n                dispatch(toggleAudio());\n              }}\n            >\n              {isAudioOn ? <MicIcon /> : <MicOffIcon />}\n            </IconButton>\n          </Tooltip>\n          {isJoinedRoom ? (\n            <Tooltip title=\"end call\">\n              <IconButton color=\"inherit\" onClick={leaveMeet}>\n                <CallEndIcon className={classes.orange} />\n              </IconButton>\n            </Tooltip>\n          ) : (\n            <Tooltip title=\"Join the meeting\">\n              <Button\n                onClick={() => {\n                  setIsJoinedRoom(true);\n                }}\n                className={classes.join}\n              >\n                Join Room\n              </Button>\n            </Tooltip>\n          )}\n          <Tooltip title={isVideoOn ? \"video on\" : \"video off\"}>\n            <IconButton\n              color=\"inherit\"\n              onClick={() => {\n                dispatch(toggleVideo());\n              }}\n            >\n              {isVideoOn ? (\n                <VideocamOutlinedIcon />\n              ) : (\n                <VideocamOffOutlinedIcon />\n              )}\n            </IconButton>\n          </Tooltip>\n\n          {isJoinedRoom && (\n            <Tooltip title=\"share screen\">\n              <IconButton\n                color=\"inherit\"\n                onClick={() => {\n                  shareScreen();\n                }}\n              >\n                <ScreenShareOutlinedIcon />\n              </IconButton>\n            </Tooltip>\n          )}\n        </div>\n        {!isMobile && (\n          <div className={classes.right}>\n            <Tooltip title=\"switch camera\">\n              <IconButton\n                color=\"inherit\"\n                onClick={() => {\n                  switchc();\n                }}\n              >\n                <FlipCameraAndroidIcon />\n              </IconButton>\n            </Tooltip>\n            {isUserCreator && isJoinedRoom && (\n              <Tooltip title=\"invite users\">\n                <IconButton\n                  onClick={() => {\n                    setInviteModalOpen((o) => !o);\n                  }}\n                >\n                  <PersonAddIcon />\n                </IconButton>\n              </Tooltip>\n            )}\n            <Tooltip title=\"Meeting Details\">\n              <IconButton\n                onClick={() => {\n                  setDetailModalOpen((o) => !o);\n                }}\n              >\n                <InfoOutlinedIcon />\n              </IconButton>\n            </Tooltip>\n            <Tooltip title=\"Chat\">\n              <IconButton onClick={toggleChat}>\n                <MessageOutlinedIcon />\n              </IconButton>\n            </Tooltip>\n          </div>\n        )}\n        {isMobile && (\n          <div className={classes.right}>\n            <IconButton\n              aria-controls=\"simple-theme-menu\"\n              aria-haspopup=\"true\"\n              color=\"inherit\"\n              className=\"header-title-button\"\n              onClick={(event) => setAnchorEl(event.currentTarget)}\n            >\n              <MoreVertIcon />\n            </IconButton>\n            <Menu\n              anchorEl={anchorEl}\n              id={\"controls-menu\"}\n              keepMounted\n              open={isMenuOpen}\n              onClose={() => {\n                setAnchorEl(null);\n              }}\n            >\n              <MenuItem\n                onClick={() => {\n                  switchc();\n                }}\n              >\n                Switch Camera\n              </MenuItem>\n              {isUserCreator && isJoinedRoom && (\n                <MenuItem\n                  onClick={() => {\n                    setAnchorEl(null);\n                    setInviteModalOpen((o) => !o);\n                  }}\n                >\n                  Invite User\n                </MenuItem>\n              )}\n              <MenuItem\n                onClick={() => {\n                  setAnchorEl(null);\n                  setDetailModalOpen((o) => !o);\n                }}\n              >\n                Meeting Details\n              </MenuItem>\n              <MenuItem\n                onClick={() => {\n                  setAnchorEl(null);\n                  toggleChat();\n                }}\n              >\n                Chat\n              </MenuItem>\n            </Menu>\n          </div>\n        )}\n        {isUserCreator && isJoinedRoom && (\n          <InviteModal open={inviteModalOpen} setOpen={setInviteModalOpen} />\n        )}\n        <DetailModal open={detailModalOpen} setOpen={setDetailModalOpen} />\n      </Grid>\n    </Paper>\n  );\n};\n\nexport default Controls;\n","export const split = (x) => {\n  let n = Math.floor(Math.sqrt(x));\n  let zp = n - (x % n);\n  let pp = Math.floor(x / n);\n  let m = [];\n  for (let i = 0; i < n; i++) {\n    if (i >= zp) {\n      m.push(pp + 1);\n    } else {\n      m.push(pp);\n    }\n  }\n  m = m.reverse();\n  let res = {};\n  let count = 1;\n  let idx = 0;\n  for (let i = 1; i <= x; i++) {\n    res[i] = m[idx];\n    count++;\n    if (count > m[idx]) {\n      count = 1;\n      idx++;\n    }\n  }\n  res[\"rows\"] = m.length;\n  return res;\n};\n\nexport function detectURL(message) {\n  var urlRegex = /(((https?:\\/\\/)|(www\\.))[^\\s]+)/g;\n  return message.replace(urlRegex, function (urlMatch) {\n    return `<a href=${urlMatch} target=\"_blank\" >${urlMatch}</a>`;\n  });\n}\nexport function sanitize(string) {\n  const map = {\n    \"&\": \"&amp;\",\n    \"<\": \"&lt;\",\n    \">\": \"&gt;\",\n    '\"': \"&quot;\",\n    \"'\": \"&#x27;\",\n    \"/\": \"&#x2F;\",\n  };\n  const reg = /[&<>\"'/]/gi;\n  return string.replace(reg, (match) => map[match]);\n}\n\nexport const getFullName = (firstName, lastName) => {\n  const fullName = firstName + \" \" + lastName;\n  return fullName.trim();\n};\n","import React, { useCallback, useEffect, useState } from \"react\";\nimport Drawer from \"@material-ui/core/Drawer\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport { IconButton } from \"@material-ui/core\";\nimport ChevronRightIcon from \"@material-ui/icons/ChevronRight\";\nimport WebSocketService from \"../../helper/WebsocketService\";\nimport TextField from \"@material-ui/core/TextField\";\nimport { Send } from \"@material-ui/icons\";\nimport InputAdornment from \"@material-ui/core/InputAdornment\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport \"./chat.css\";\nimport { setMessages, setNewMessage } from \"../../redux/actions/roomActions\";\nconst drawerWidth = 360;\n\nconst useStyles = makeStyles((theme) => ({\n  drawer: {\n    width: drawerWidth,\n    flexShrink: 0,\n  },\n  drawerPaper: {\n    width: drawerWidth,\n    height: \"calc(100vh - 9rem)\",\n    borderRadius: \"1rem\",\n    top: \"5rem\",\n    right: \"12px\",\n  },\n  drawerHeader: {\n    display: \"flex\",\n    alignItems: \"center\",\n    padding: theme.spacing(0, 1),\n    ...theme.mixins.toolbar,\n    justifyContent: \"flex-start\",\n  },\n  chatInputContainer: {\n    marginTop: \"auto\",\n  },\n  chatInput: {\n    marginBottom: \"2rem\",\n    \"& .MuiFilledInput-root\": {\n      borderRadius: \"50px\",\n      borderBottom: 0,\n      paddingTop: \"15px\",\n      paddingBottom: \"15px\",\n      \"&::before\": { borderBottom: 0 },\n    },\n  },\n  messageBoxRight: {\n    background: theme.palette.background.paper,\n    color: theme.palette.text.primary,\n  },\n  messageBoxLeft: {\n    background: \"#4870df\",\n    color: theme.palette.background.default,\n  },\n  messageSender: {\n    color: theme.palette.text.primary,\n    fontSize: \"10px\",\n  },\n}));\n\nconst MessageItem = (props) => {\n  const owner = useSelector((state) => state.userReducer.user);\n  const classes = useStyles();\n  let messagePosition =\n    owner.pk === props.sender.id\n      ? `chatApp__convMessageItem--right`\n      : `chatApp__convMessageItem--left`;\n  let messageBackground =\n    owner.pk === props.sender.id\n      ? classes.messageBoxRight\n      : classes.messageBoxLeft;\n  return (\n    <div\n      className={\"chatApp__convMessageItem \" + messagePosition + \" clearfix\"}\n    >\n      <div className={`chatApp__convMessageValue ${messageBackground}`}>\n        {owner.pk !== props.sender.id && (\n          <div className={classes.messageSender}>{props.sender.first_name}</div>\n        )}\n        <div>{props.message}</div>\n      </div>\n    </div>\n  );\n};\n\nconst MessageList = React.memo((props) => {\n  return (\n    <div className={\"chatApp__convTimeline\"}>\n      {props.messages\n        .slice(0)\n        .reverse()\n        .map((messageItem, idx) => (\n          <MessageItem\n            key={idx}\n            sender={messageItem.user}\n            message={messageItem.message}\n          />\n        ))}\n    </div>\n  );\n});\n\nconst Chat = ({ open, setOpen }) => {\n  const messages = useSelector((state) => state.roomReducer.roomMessages);\n  const [currMessage, setCurrMessage] = useState(\"\");\n  const classes = useStyles();\n  const dispatch = useDispatch();\n  useEffect(() => {\n    WebSocketService.on(\"receive new message\", (data) => {\n      dispatch(setNewMessage(data));\n    });\n    WebSocketService.on(\"get all messages\", (data) => {\n      dispatch(setMessages(data.messages));\n    });\n  }, []);\n  const sendMessage = () => {\n    WebSocketService.sendMessage(\"send new message\", currMessage);\n    setCurrMessage(\"\");\n  };\n\n  const onCurrMessageChanged = useCallback((e) => {\n    const val = e.target.value;\n    setCurrMessage(val);\n  }, []);\n  return (\n    <Drawer\n      className={classes.drawer}\n      variant=\"persistent\"\n      anchor=\"right\"\n      open={open}\n      classes={{\n        paper: classes.drawerPaper,\n      }}\n    >\n      <div className={classes.drawerHeader}>\n        <IconButton\n          onClick={() => {\n            setOpen(false);\n          }}\n        >\n          <ChevronRightIcon />\n        </IconButton>\n      </div>\n      <MessageList messages={messages} />\n      <div className={classes.chatInputContainer}>\n        <TextField\n          placeholder=\"send a message to everyone\"\n          size=\"small\"\n          variant=\"filled\"\n          fullWidth\n          multiline\n          rowsMax={4}\n          className={classes.chatInput}\n          value={currMessage}\n          onChange={onCurrMessageChanged}\n          InputProps={{\n            endAdornment: (\n              <InputAdornment position=\"end\">\n                {currMessage.length > 0 && (\n                  <IconButton\n                    aria-label=\"toggle password visibility\"\n                    onClick={sendMessage}\n                  >\n                    <Send />\n                  </IconButton>\n                )}\n              </InputAdornment>\n            ),\n          }}\n        />\n      </div>\n    </Drawer>\n  );\n};\n\nexport default Chat;\n","import { toast } from \"react-toastify\";\nimport WebsocketService from \"./WebsocketService\";\nimport { getFullName } from \"../helper/utilFunctions\";\nimport { getUniqueArray } from \"./helperFunctions\";\nimport { addPeer, createPeer } from \"./peers\";\n\nexport const all_users_listener =\n  (peersRef, myID, stream, setPeers) => (users) => {\n    peersRef.current = {};\n    const temp = {};\n    users.forEach((user) => {\n      if (myID !== user.id) {\n        const peer = createPeer(user.id, myID, stream);\n\n        peersRef.current[user.id] = { user, peer };\n        temp[user.id] = {\n          user: user,\n          peer: peer,\n        };\n      }\n    });\n    setPeers(temp);\n  };\n\nexport const user_joined_listener =\n  (myID, peersRef, stream, setPeers, isUserAudioOn, isUserVideoOn) =>\n  (payload) => {\n    const user = payload.callerUser;\n    if (payload.usable_id === myID) {\n      const peer = addPeer(payload.signal, user.id, stream);\n      peersRef.current[user.id] = { user, peer };\n      setPeers((peers) => ({\n        ...peers,\n        [user.id]: {\n          user: user,\n          peer: peer,\n        },\n      }));\n      toast.info(`${getFullName(user.first_name, user.last_name)} joined`);\n    }\n  };\n\nexport const receive_returned_signal =\n  (myID, peersRef, isUserAudioOn, isUserVideoOn) => (payload) => {\n    if (payload.usable_id === myID) {\n      const { peer } = peersRef.current[payload.id];\n      peer.signal(payload.signal);\n\n      WebsocketService.sendMessage(\"audioMedia\", {\n        userID: myID,\n        audioOn: isUserAudioOn,\n      });\n      WebsocketService.sendMessage(\"videoMedia\", {\n        userID: myID,\n        videoOn: isUserVideoOn,\n      });\n      WebsocketService.sendMessage(\"get media\", \"\");\n    }\n  };\n\nexport const user_left_listener = (myID, peersRef, setPeers) => (payload) => {\n  const user = payload.user;\n  if (peersRef.current[user.id]) {\n    peersRef.current[user.id].peer.destroy();\n  }\n  delete peersRef.current[user.id];\n  setPeers((peers) => {\n    const { [payload.user.id]: remove, ...rest } = peers;\n    return rest;\n  });\n};\n\nexport const videoMediaListener = (peersRef, setPeers) => (payload) => {\n  const userID = payload.userID;\n  if (peersRef.current[userID]) {\n    peersRef.current[userID].user.videoOn = payload.videoOn;\n    setPeers((peers) => {\n      const { user, peer } = peers[userID];\n      return {\n        ...peers,\n        [userID]: { peer, user: { ...user, videoOn: payload.videoOn } },\n      };\n    });\n  }\n};\n\nexport const audioMediaListener = (peersRef, setPeers) => (payload) => {\n  const userID = payload.userID;\n  if (peersRef.current[userID]) {\n    peersRef.current[userID].user.audioOn = payload.audioOn;\n    setPeers((peers) => {\n      const { user, peer } = peers[userID];\n      return {\n        ...peers,\n        [userID]: { peer, user: { ...user, audioOn: payload.audioOn } },\n      };\n    });\n  }\n};\n\nexport const getMediaListener = (peersRef, setPeers) => (payload) => {\n  for (let key in peersRef.current) {\n    if (payload.audio[key]) {\n      peersRef.current[key].user.audioOn = payload.audio[key];\n    }\n    if (payload.video[key]) {\n      peersRef.current[key].user.videoOn = payload.video[key];\n    }\n  }\n  setPeers((peers) => {\n    for (let key in peers) {\n      if (payload.audio[key]) {\n        peers[key].user.audioOn = payload.audio[key];\n      }\n      if (payload.video[key]) {\n        peers[key].user.videoOn = payload.video[key];\n      }\n    }\n    return { ...peers };\n  });\n};\n\nexport const getPermissionListener = (myID, setAcceptStatus) => (payload) => {\n  if (payload.usable_id === myID) {\n    setAcceptStatus(payload.status);\n  }\n};\n\nexport const getPermissionRequestListener =\n  (myID, setWaitingUsers) => (payload) => {\n    if (payload.usable_id === myID) {\n      setWaitingUsers((users) => {\n        users.push(payload.user);\n        const newUsers = getUniqueArray(users, \"id\");\n        return newUsers;\n      });\n    }\n  };\n\nexport const userKickedListener = (myID, history) => (payload) => {\n  if (payload.usable_id === myID) {\n    history.replace(\"/\", {\n      message: \"The Organisor removed you from room\",\n      type: \"error\",\n    });\n  }\n};\n\nexport const userBlockedListener = (myID, history) => (payload) => {\n  if (payload.usable_id === myID) {\n    history.replace(\"/\", {\n      message: \"The Organisor blocked you from room\",\n      type: \"error\",\n    });\n  }\n};\n\nexport const joinMessageListener =\n  (setAcceptStatus, setServerMessage) => (message) => {\n    setAcceptStatus(\"message\");\n    if (message === \"creator not available\") {\n      setServerMessage(\n        \"The Organisor has not joined the room yet. Please try joining after some time\"\n      );\n    } else if (message === \"user blocked\") {\n      setServerMessage(\"The Organisor has blocked you.\");\n    }\n  };\n","import Peer from \"simple-peer\";\nimport WebsocketService from \"./WebsocketService\";\n\nexport function createPeer(userToSignal, callerID, stream) {\n  const peer = new Peer({\n    initiator: true,\n    trickle: false,\n    stream,\n  });\n  peer.on(\"signal\", (signal) => {\n    WebsocketService.sendMessage(\"sending signal\", {\n      userToSignal,\n      callerID,\n      signal,\n    });\n  });\n  return peer;\n}\n\nexport function addPeer(incomingSignal, callerID, stream) {\n  const peer = new Peer({\n    initiator: false,\n    trickle: false,\n    stream,\n  });\n  peer.on(\"signal\", (signal) => {\n    WebsocketService.sendMessage(\"returning signal\", { signal, callerID });\n  });\n  peer.signal(incomingSignal);\n  return peer;\n}\n","import { IconButton } from \"@material-ui/core\";\nimport React from \"react\";\nimport { Modal, Row, Col } from \"react-bootstrap\";\nimport CloseIcon from \"@material-ui/icons/Close\";\nimport CheckIcon from \"@material-ui/icons/Check\";\nimport { makeStyles } from \"@material-ui/styles\";\nimport WebSocketInstance from \"../../helper/WebsocketService\";\n\nconst useStyles = makeStyles((theme) => ({\n  modal: {\n    \"&& .modal-content\": {\n      background: theme.palette.background.paper,\n      color: theme.palette.text.primary,\n    },\n  },\n}));\n\nconst JoinModal = ({ waitingUsers, setWaitingUsers }) => {\n  const classes = useStyles();\n  const rejectUser = (user) => {\n    WebSocketInstance.sendMessage(\"give join permission status\", {\n      userID: user.id,\n      status: \"reject\",\n    });\n    setWaitingUsers((users) => users.filter((el) => el.id !== user.id));\n  };\n  const acceptUser = (user) => {\n    WebSocketInstance.sendMessage(\"give join permission status\", {\n      userID: user.id,\n      status: \"accept\",\n    });\n    setWaitingUsers((users) => users.filter((el) => el.id !== user.id));\n  };\n  return (\n    <Modal\n      show={Boolean(waitingUsers.length)}\n      onHide={() => {}}\n      backdrop=\"static\"\n      keyboard={false}\n      className={classes.modal}\n    >\n      <Modal.Header>\n        <Modal.Title>Modal title</Modal.Title>\n      </Modal.Header>\n      <Modal.Body>\n        {waitingUsers.map((user, idx) => (\n          <Row key={idx} style={{ alignItems: \"center\" }}>\n            <Col>{user.first_name} wants to join</Col>\n            <IconButton\n              onClick={() => {\n                rejectUser(user);\n              }}\n            >\n              <CloseIcon />\n            </IconButton>\n            <IconButton\n              onClick={() => {\n                acceptUser(user);\n              }}\n            >\n              <CheckIcon />\n            </IconButton>\n          </Row>\n        ))}\n      </Modal.Body>\n      <Modal.Footer></Modal.Footer>\n    </Modal>\n  );\n};\n\nexport default JoinModal;\n","export const updateStream = (peersRef, setPeers, userStream) => (track) => {\n  for (let key in peersRef.current) {\n    peersRef.current[key].peer.replaceTrack(\n      userStream.getVideoTracks()[0],\n      track,\n      userStream\n    );\n  }\n  setPeers({ ...peersRef.current });\n  userStream.removeTrack(userStream.getVideoTracks()[0]);\n  userStream.addTrack(track);\n};\n\nexport const switchCamera =\n  (peersRef, setPeers, userStream, videoConstraints) =>\n  async (currentCameraRef) => {\n    const devices = await navigator.mediaDevices.enumerateDevices();\n    const videoDevices = devices.filter(\n      (device) => device.kind === \"videoinput\"\n    );\n    currentCameraRef.current =\n      (currentCameraRef.current + 1) % videoDevices.length;\n\n    const updatedConstraints = {\n      ...videoConstraints,\n      deviceId: {\n        exact: videoDevices[currentCameraRef.current].deviceId,\n      },\n    };\n    videoConstraints = updatedConstraints;\n\n    const stream = await navigator.mediaDevices.getUserMedia({\n      video: videoConstraints,\n      audio: true,\n    });\n    updateStream(peersRef, setPeers, userStream)(stream.getVideoTracks()[0]);\n  };\n\nexport const shareScreen = async (\n  peersRef,\n  setPeers,\n  videoConstraints,\n  userStream,\n  setIsSharingScreen\n) => {\n  const screenStream = await navigator.mediaDevices.getDisplayMedia({\n    cursor: true,\n  });\n  let currTrack = userStream.getVideoTracks()[0];\n  let screenTrack = screenStream.getVideoTracks()[0];\n  updateStream(peersRef, setPeers, userStream)(screenTrack);\n  setIsSharingScreen(true);\n\n  screenTrack.onended = async () => {\n    const stream = await navigator.mediaDevices.getUserMedia({\n      video: videoConstraints,\n      audio: true,\n    });\n    updateStream(peersRef, setPeers, userStream)(currTrack);\n    setIsSharingScreen(false);\n  };\n};\n","import React, { useEffect, useRef, useState } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport WebsocketService from \"../helper/WebsocketService\";\nimport { useParams } from \"react-router\";\nimport Video from \"../components/common/Video\";\nimport Controls from \"../components/Room/Controls\";\nimport { split } from \"../helper/utilFunctions\";\nimport Chat from \"../components/Room/Chat\";\nimport { makeStyles } from \"@material-ui/core\";\nimport {\n  all_users_listener,\n  user_joined_listener,\n  user_left_listener,\n  receive_returned_signal,\n  videoMediaListener,\n  audioMediaListener,\n  getPermissionRequestListener,\n  getMediaListener,\n} from \"../helper/socketListeners\";\nimport JoinModal from \"../components/Room/JoinModal\";\nimport { shareScreen, switchCamera } from \"../helper/streamFunctions\";\nimport { getIsUserCreator, getRoom } from \"../redux/actions/roomActions\";\n\nlet videoConstraints = {\n  height: window.innerHeight / 2,\n  width: window.innerWidth / 2,\n};\n\nconst useStyles = makeStyles((theme) => ({\n  container: {\n    display: \"flex\",\n    height: \"100%\",\n    width: \"100%\",\n    flexDirection: \"column\",\n    background: theme.palette.background.default,\n  },\n}));\n\nconst socketFunctions = (\n  peersRef,\n  myID,\n  stream,\n  setPeers,\n  isUserAudioOn,\n  isUserVideoOn,\n  setWaitingUsers\n) => {\n  WebsocketService.on(\n    \"all users\",\n    all_users_listener(peersRef, myID, stream, setPeers)\n  );\n  WebsocketService.on(\n    \"user joined\",\n    user_joined_listener(\n      myID,\n      peersRef,\n      stream,\n      setPeers,\n      isUserAudioOn,\n      isUserVideoOn\n    )\n  );\n\n  WebsocketService.on(\n    \"receiving returned signal\",\n    receive_returned_signal(myID, peersRef, isUserAudioOn, isUserVideoOn)\n  );\n\n  WebsocketService.on(\n    \"user left\",\n    user_left_listener(myID, peersRef, setPeers)\n  );\n\n  WebsocketService.on(\"videoMedia\", videoMediaListener(peersRef, setPeers));\n\n  WebsocketService.on(\"audioMedia\", audioMediaListener(peersRef, setPeers));\n  WebsocketService.on(\n    \"user want to join\",\n    getPermissionRequestListener(myID, setWaitingUsers)\n  );\n  WebsocketService.on(\"get media\", getMediaListener(peersRef, setPeers));\n};\n\nconst resetSocketFunctions = () => {\n  WebsocketService.del(\"all users\");\n  WebsocketService.del(\"user joined\");\n  WebsocketService.del(\"receiving returned signal\");\n  WebsocketService.del(\"user left\");\n};\n\nconst Room = () => {\n  const { roomID } = useParams();\n  const [peers, setPeers] = useState({});\n  const userVideo = useRef();\n  const peersRef = useRef({});\n  const myID = useSelector((state) => state.userReducer.user.pk);\n  const [userStream, setUserStream] = useState();\n  const currentCameraRef = useRef(0);\n  let sizeMap = split(Object.keys(peers).length + 1);\n  const [chatOpen, setChatOpen] = useState(false);\n  const isUserAudioOn = useSelector(\n    (state) => state.roomReducer.userVideo.audioOn\n  );\n  const isUserVideoOn = useSelector(\n    (state) => state.roomReducer.userVideo.videoOn\n  );\n  const classes = useStyles();\n  const me = useSelector((state) => state.userReducer.user);\n  const [waitingUsers, setWaitingUsers] = useState([]);\n  const dispatch = useDispatch();\n  const [isSharingScreen, setIsSharingScreen] = useState(false);\n  const [pinnedUser, setPinnedUser] = useState(-1);\n\n  const [isJoinedRoom, setIsJoinedRoom] = useState(false);\n\n  const setCameraStream = async () => {\n    const stream = await navigator.mediaDevices.getUserMedia({\n      video: true,\n      audio: true,\n    });\n    setUserStream(stream);\n    if (userVideo && userVideo.current) {\n      userVideo.current.srcObject = stream;\n    }\n  };\n\n  const socketConnect = async () => {\n    await setCameraStream();\n    WebsocketService.sendMessage(\"get all messages\", \"\");\n  };\n\n  useEffect(() => {\n    dispatch(getIsUserCreator(roomID));\n    dispatch(getRoom(roomID));\n    socketConnect();\n  }, []);\n\n  useEffect(() => {\n    if (isJoinedRoom) {\n      socketFunctions(\n        peersRef,\n        myID,\n        userStream,\n        setPeers,\n        isUserAudioOn,\n        isUserVideoOn,\n        setWaitingUsers\n      );\n    }\n  }, [isJoinedRoom, userStream, isUserAudioOn, isUserVideoOn, myID]);\n\n  useEffect(() => {\n    let userStreamRef = userStream;\n    return () => {\n      if (userStreamRef) {\n        userStreamRef.getVideoTracks().forEach((track) => {\n          track.stop();\n        });\n        userStreamRef.getAudioTracks().forEach((track) => {\n          track.stop();\n        });\n      }\n    };\n  }, [userStream]);\n\n  useEffect(() => {\n    if (userStream) {\n      userStream.getAudioTracks()[0].enabled = isUserAudioOn;\n      if (WebsocketService.state() === 1) {\n        WebsocketService.sendMessage(\"audioMedia\", {\n          userID: myID,\n          audioOn: isUserAudioOn,\n        });\n      }\n    }\n  }, [userStream, isUserAudioOn, myID]);\n\n  useEffect(() => {\n    if (isJoinedRoom) {\n      WebsocketService.sendMessage(\"join room\", roomID);\n    } else {\n      resetSocketFunctions();\n      for (let key in peersRef.current) {\n        peersRef.current[key].peer.destroy();\n      }\n      WebsocketService.sendMessage(\"user left\",\"\")\n      peersRef.current = {};\n      setPeers({});\n    }\n  }, [isJoinedRoom]);\n\n  useEffect(() => {\n    if (userStream) {\n      userStream.getVideoTracks()[0].enabled = isUserVideoOn;\n      if (WebsocketService.state() === 1) {\n        WebsocketService.sendMessage(\"videoMedia\", {\n          userID: myID,\n          videoOn: isUserVideoOn,\n        });\n      }\n    }\n  }, [userStream, isUserVideoOn, myID]);\n\n  useEffect(() => {\n    sizeMap = split(Object.keys(peers).length + 1);\n  }, [peers]);\n\n  const leaveMeet = () => {\n    setIsJoinedRoom(false);\n  };\n\n  return (\n    <div className={classes.container}>\n      <div\n        style={{\n          display: \"flex\",\n          width: \"100%\",\n          maxHeight: \"calc(100vh - 7rem)\",\n          margin: \"auto\",\n          flexGrow: \"1\",\n          flexWrap: \"wrap\",\n        }}\n      >\n        <Video\n          muted\n          ref={userVideo}\n          user={{ ...me, videoOn: isUserVideoOn, audioOn: isUserAudioOn }}\n          autoPlay\n          playsInline\n          size={sizeMap[1]}\n          rows={sizeMap[\"rows\"]}\n          isUserVideo\n          isSharingScreen={isSharingScreen}\n          pinnedUser={pinnedUser}\n          setPinnedUser={setPinnedUser}\n        />\n        {Object.values(peers).map((item, index) => {\n          return (\n            <Video\n              key={index}\n              peer={item.peer}\n              user={item.user}\n              size={sizeMap[index + 2]}\n              rows={sizeMap[\"rows\"]}\n              pinnedUser={pinnedUser}\n              setPinnedUser={setPinnedUser}\n            />\n          );\n        })}\n      </div>\n      <JoinModal\n        waitingUsers={waitingUsers}\n        setWaitingUsers={setWaitingUsers}\n      />\n      <Controls\n        switchc={() => {\n          switchCamera(\n            peersRef,\n            setPeers,\n            userStream,\n            videoConstraints\n          )(currentCameraRef);\n        }}\n        shareScreen={() => {\n          shareScreen(\n            peersRef,\n            setPeers,\n            videoConstraints,\n            userStream,\n            setIsSharingScreen\n          );\n        }}\n        toggleChat={() => {\n          setChatOpen((open) => !open);\n        }}\n        isJoinedRoom={isJoinedRoom}\n        setIsJoinedRoom={setIsJoinedRoom}\n        leaveMeet={leaveMeet}\n      />\n      <Chat open={chatOpen} setOpen={setChatOpen} />\n    </div>\n  );\n};\n\nexport default Room;\n","import React, { useEffect, useState } from \"react\";\nimport WebSocketInstance from \"../helper/WebsocketService\";\nimport { useHistory, useParams } from \"react-router\";\nimport Room from \"./RoomView\";\nimport {\n  getPermissionListener,\n  joinMessageListener,\n  userBlockedListener,\n  userKickedListener,\n} from \"../helper/socketListeners\";\nimport { useSelector } from \"react-redux\";\nimport Typography from \"@material-ui/core/Typography\";\nimport CircularProgress from \"@material-ui/core/CircularProgress\";\nimport { makeStyles } from \"@material-ui/styles\";\nimport { Paper } from \"@material-ui/core\";\nconst useStyles = makeStyles((theme) => ({\n  container: {\n    background: theme.palette.background.default,\n    height: \"100%\",\n    width: \"100%\",\n    position: \"relative\",\n  },\n  color: { color: theme.palette.text.primary },\n  paper: {\n    display: \"flex\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    maxWidth: \"75vw\",\n    position: \"relative\",\n    marginLeft: \"auto\",\n    marginRight: \"auto\",\n    top: \"3rem\",\n  },\n}));\n\nconst View = () => {\n  const { roomID } = useParams();\n  const history = useHistory();\n  const classes = useStyles();\n  const myID = useSelector((state) => state.userReducer.user.pk);\n  const [acceptStatus, setAcceptStatus] = useState(\"pending\");\n  const [serverMessage, setServerMessage] = useState(\"\");\n  useEffect(() => {\n    WebSocketInstance.refresh();\n    let protocol = window.location.protocol === \"http:\" ? \"ws\" : \"wss\";\n    let host = window.location.hostname.includes(\"localhost\")\n      ? \"localhost:7000\"\n      : window.location.hostname;\n    WebSocketInstance.connect(\n      `${protocol}://${host}/ws/room/${roomID}/`,\n      (e) => {\n        history.replace(\"/\", {\n          message: \"the url entered is incorrect.\",\n          type: \"error\",\n        });\n      }\n    );\n    WebSocketInstance.on(\n      \"get permission\",\n      getPermissionListener(myID, setAcceptStatus)\n    );\n    WebSocketInstance.on(\n      \"join message\",\n      joinMessageListener(setAcceptStatus, setServerMessage)\n    );\n    WebSocketInstance.on(\"user kicked\", userKickedListener(myID, history));\n    WebSocketInstance.on(\"user blocked\", userBlockedListener(myID, history));\n    return () => {\n      WebSocketInstance.close();\n    };\n  }, []);\n\n  useEffect(() => {\n    if (acceptStatus === \"reject\") {\n      history.replace(\"/\", {\n        message: \"The creator rejected the join request\",\n        type: \"error\",\n      });\n    }\n  }, [acceptStatus]);\n\n  return (\n    <>\n      {acceptStatus === \"pending\" ? (\n        <div className={classes.container}>\n          <Paper elevation={3} variant=\"outlined\" className={classes.paper}>\n            <Typography\n              variant=\"h2\"\n              className={classes.color}\n              style={{ width: \"max-content\" }}\n            >\n              Joining the room\n            </Typography>\n            <CircularProgress\n              className={classes.color}\n              style={{ marginLeft: \"1rem\" }}\n            />\n          </Paper>\n        </div>\n      ) : acceptStatus === \"accept\" ? (\n        <Room />\n      ) : acceptStatus === \"message\" ? (\n        <div className={classes.container}>\n          <Paper elevation={3} variant=\"outlined\" className={classes.paper}>\n            <Typography\n              variant=\"h2\"\n              className={classes.color}\n              style={{ width: \"max-content\" }}\n              align=\"center\"\n            >\n              {serverMessage}\n            </Typography>\n          </Paper>\n        </div>\n      ) : null}\n    </>\n  );\n};\n\nexport default View;\n"],"sourceRoot":""}