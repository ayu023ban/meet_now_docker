{"version":3,"sources":["redux/actions/roomActions.js","helper/WebsocketService.js","components/common/Video.js","components/Room/DetailModal.js","components/Room/InviteModal.js","components/Room/Controls.js","helper/utilFunctions.js","components/Room/Chat.js","helper/socketListeners.js","helper/peers.js","components/Room/JoinModal.js","helper/unusedFunctions.js","views/RoomView.js","views/View.js"],"names":["createNewRoom","data","url","create_room","dispatch","apiClient","post","then","res","apiDispatch","CREATE_ROOM","navigator","clipboard","writeText","getUrlFromCode","id","toast","success","catch","err","error","getRooms","get_room","get","GET_ROOMS","deleteRoom","roomID","fallback","getState","delete","getRoom","GET_ROOM","toggleAudio","TOGGLE_USER_AUDIO","toggleVideo","TOGGLE_USER_VIDEO","inviteUser","roomId","invite","response","removeInviteUser","removeInvite","getInvitations","getIsUserCreator","isUserCreator","SET_USER_IS_CREATOR","isCreator","setMessages","SET_MESSAGES","setNewMessage","messages","roomReducer","roomMessages","WebSocketService","callbacks","this","socketRef","forcedClose","chatroom_url","WebSocket","onopen","console","log","onmessage","e","socketNewMessage","onerror","debug","onclose","code","setTimeout","connect","reason","close","command","func","received_data","parsedData","JSON","parse","Object","keys","length","type","waitForConnection","send","stringify","bind","message","readyState","callback","interval","state","that","instance","WebSocketInstance","getInstance","useStyles","makeStyles","theme","responsive","float","display","alignItems","transition","videoTop","background","palette","paper","micOff","position","right","top","videoOff","width","height","left","justifyContent","avatar","fontSize","hoverDiv","remove","color","name","bottom","Video","React","forwardRef","ref","peer","muted","size","rows","isUserVideo","user","isSharingScreen","pinnedUser","setPinnedUser","localRef","useRef","currentRef","userId","pk","classes","useState","open","setOpen","useSelector","invitedUsers","currentRoom","invited_users","mangoRef","videoWidth","setVideoWidth","videoHeight","setVideoHeight","resizeObserver","ResizeObserver","entries","newWidth","newHeight","entry","contentBoxSize","contentRect","useEffect","observe","current","initials","first_name","toUpperCase","last_name","fullName","trim","on","stream","srcObject","className","style","overflow","margin","borderRadius","objectFit","transform","videoOn","playsInline","autoPlay","onClick","onMouseEnter","Fade","in","onMouseLeave","opacity","Tooltip","title","IconButton","sendMessage","userID","disabled","some","el","Typography","variant","audioOn","Avatar","DetailModal","roomName","room_name","Dialog","onClose","o","aria-labelledby","aria-describedby","DialogTitle","DialogContent","DialogContentText","window","location","href","DialogActions","text","onCopy","Button","InviteModal","useParams","str","err_message","email","setEmail","useDispatch","map","idx","Row","Col","invitee","TextField","value","onChange","target","helperText","validateEmailAddress","container","minHeight","flexGrow","default","blue","orange","red","marginRight","Controls","switchc","shareScreen","toggleChat","isJoinedRoom","setIsJoinedRoom","isAudioOn","userVideo","isVideoOn","detailModalOpen","setDetailModalOpen","inviteModalOpen","setInviteModalOpen","history","useHistory","useTheme","isMobile","useMediaQuery","breakpoints","down","anchorEl","setAnchorEl","isMenuOpen","Boolean","Paper","elevation","Grid","justify","marginLeft","replace","aria-controls","aria-haspopup","event","currentTarget","Menu","keepMounted","MenuItem","split","x","n","Math","floor","sqrt","zp","pp","m","i","push","reverse","count","getFullName","firstName","lastName","drawer","flexShrink","drawerPaper","drawerHeader","padding","spacing","mixins","toolbar","chatInputContainer","marginTop","chatInput","marginBottom","borderBottom","paddingTop","paddingBottom","messageBoxRight","primary","messageBoxLeft","messageSender","MessageItem","props","owner","userReducer","messagePosition","sender","messageBackground","MessageList","memo","slice","messageItem","Chat","currMessage","setCurrMessage","onCurrMessageChanged","useCallback","val","Drawer","anchor","placeholder","fullWidth","multiline","rowsMax","InputProps","endAdornment","InputAdornment","aria-label","all_users_listener","peersRef","myID","setPeers","users","temp","forEach","userToSignal","callerID","Peer","initiator","trickle","signal","WebsocketService","createPeer","user_joined_listener","isUserAudioOn","isUserVideoOn","payload","callerUser","usable_id","incomingSignal","addPeer","peers","info","modal","JoinModal","waitingUsers","setWaitingUsers","Modal","show","onHide","backdrop","keyboard","Header","Title","Body","status","filter","rejectUser","acceptUser","Footer","updateStream","userStream","key","replaceTrack","getVideoTracks","removeTrack","addTrack","videoConstraints","setIsSharingScreen","a","mediaDevices","getDisplayMedia","cursor","screenStream","getTracks","onended","getUserMedia","video","audio","innerHeight","innerWidth","flexDirection","socketFunctions","receive_returned_signal","destroy","user_left_listener","videoMediaListener","audioMediaListener","getUniqueArray","getPermissionRequestListener","getMediaListener","Room","setUserStream","currentCameraRef","sizeMap","chatOpen","setChatOpen","me","setCameraStream","socketConnect","userStreamRef","track","stop","getAudioTracks","enabled","maxHeight","flexWrap","values","item","index","enumerateDevices","devices","videoDevices","device","kind","updatedConstraints","deviceId","exact","switchCamera","maxWidth","View","acceptStatus","setAcceptStatus","serverMessage","setServerMessage","refresh","protocol","host","hostname","includes","getPermissionListener","joinMessageListener","userKickedListener","userBlockedListener","CircularProgress","align"],"mappings":"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","file":"static/js/6.d642b8b2.chunk.js","sourcesContent":["import apiClient from \"../../helper/apiclient\";\nimport { toast } from \"react-toastify\";\n\nimport {\n  CREATE_ROOM,\n  GET_ROOM,\n  GET_ROOMS,\n  SET_MESSAGES,\n  SET_USER_IS_CREATOR,\n  TOGGLE_USER_AUDIO,\n  TOGGLE_USER_VIDEO,\n} from \"./roomActionTypes\";\n\nimport {\n  create_room,\n  get_room,\n  invite,\n  isUserCreator,\n  removeInvite,\n} from \"../../config/backend_api\";\n\nimport { apiDispatch, getUrlFromCode } from \"../../helper/helperFunctions\";\nimport { getInvitations } from \"./userActions\";\n\nexport const createNewRoom = (data) => {\n  const url = create_room;\n  return (dispatch) => {\n    apiClient\n      .post(url, data)\n      .then((res) => {\n        dispatch(apiDispatch(CREATE_ROOM, res.data));\n        navigator.clipboard.writeText(getUrlFromCode(res.data.id));\n        toast.success(\"copied to clipboard\");\n      })\n      .catch((err) => {\n        toast.error(`error occured in creating the room`);\n      });\n  };\n};\n\nexport const getRooms = () => {\n  const url = get_room;\n  return (dispatch) => {\n    apiClient\n      .get(url)\n      .then((res) => {\n        dispatch(apiDispatch(GET_ROOMS, res.data));\n      })\n      .catch((err) => {\n        toast.error(`error occured in fetching your rooms`, {});\n      });\n  };\n};\n\nexport const deleteRoom = (roomID, fallback) => {\n  const url = `${get_room}${roomID}/`;\n  return (dispatch, getState) => {\n    apiClient.delete(url).then((res) => {\n      fallback(roomID);\n    });\n  };\n};\n\nexport const getRoom = (roomID) => {\n  const url = `${get_room}${roomID}/`;\n  return (dispatch) => {\n    apiClient.get(url).then((res) => {\n      dispatch(apiDispatch(GET_ROOM, res.data));\n    });\n  };\n};\n\nexport const toggleAudio = () => {\n  return (dispatch) => {\n    dispatch(apiDispatch(TOGGLE_USER_AUDIO));\n  };\n};\nexport const toggleVideo = () => {\n  return (dispatch) => {\n    dispatch(apiDispatch(TOGGLE_USER_VIDEO));\n  };\n};\n\nexport const inviteUser = (roomId, data) => {\n  const url = invite(roomId);\n  return (dispatch) => {\n    apiClient\n      .post(url, data)\n      .then((res) => {\n        dispatch(apiDispatch(GET_ROOM, res.data));\n        toast.success(\"user invited\");\n      })\n      .catch((err) => {\n        toast.error(err.response.data);\n      });\n  };\n};\n\nexport const removeInviteUser = (roomID, data) => {\n  const url = removeInvite(roomID);\n  return (dispatch) => {\n    apiClient\n      .post(url, data)\n      .then((res) => {\n        dispatch(apiDispatch(GET_ROOM, res.data));\n        dispatch(getInvitations());\n      })\n      .catch((err) => {\n        toast.error(err.response.data);\n      });\n  };\n};\n\nexport const getIsUserCreator = (roomId) => {\n  const url = isUserCreator(roomId);\n  return (dispatch) => {\n    apiClient.get(url).then((res) => {\n      dispatch(apiDispatch(SET_USER_IS_CREATOR, res.data.isCreator));\n    });\n  };\n};\n\nexport const setMessages = (data) => {\n  return (dispatch) => {\n    dispatch(apiDispatch(SET_MESSAGES, data));\n  };\n};\n\nexport const setNewMessage = (data) => {\n  return (dispatch, getState) => {\n    const messages = getState().roomReducer.roomMessages;\n    dispatch(apiDispatch(SET_MESSAGES, [...messages, data]));\n  };\n};\n","class WebSocketService {\n  static instance = null;\n  callbacks = {};\n\n  static getInstance() {\n    if (!WebSocketService.instance) {\n      WebSocketService.instance = new WebSocketService();\n    }\n    return WebSocketService.instance;\n  }\n\n  constructor() {\n    this.socketRef = null;\n    this.fallback = null;\n    this.forcedClose = false;\n  }\n\n  connect(chatroom_url, fallback = () => {}) {\n    this.forcedClose = false;\n    this.fallback = fallback;\n    this.socketRef = new WebSocket(chatroom_url);\n\n    this.socketRef.onopen = () => {\n      console.log(\"websocket open\");\n    };\n\n    this.socketRef.onmessage = (e) => {\n      this.socketNewMessage(e.data);\n    };\n\n    this.socketRef.onerror = (e) => {\n      console.debug(e);\n    };\n\n    this.socketRef.onclose = (e) => {\n      console.log(e);\n      if (e.code === 4000) {\n        this.fallback(e);\n      } else if (this.forcedClose) {\n        console.log(\"websocket closed\");\n      } else {\n        console.log(\"websockets closed lets reopen\");\n        setTimeout(() => {\n          this.connect(chatroom_url, fallback(e));\n        }, 5000);\n      }\n    };\n  }\n\n  close(code, reason) {\n    // Default CLOSE_NORMAL code\n    if (typeof code == \"undefined\") {\n      code = 1000;\n    }\n    this.forcedClose = true;\n    if (this.socketRef) {\n      this.socketRef.close(code, reason);\n    }\n  }\n  on(command, func) {\n    this.callbacks[command] = func;\n  }\n\n  socketNewMessage(received_data) {\n    const parsedData = JSON.parse(received_data);\n    const { command, data } = parsedData;\n    if (Object.keys(this.callbacks).length === 0) {\n      return;\n    }\n    if (this.callbacks[command]) {\n      this.callbacks[command](data);\n    }\n  }\n\n  sendMessage(type, data) {\n    try {\n      this.waitForConnection(\n        function () {\n          this.socketRef.send(JSON.stringify({ type, data }));\n        }.bind(this),\n        1000\n      );\n    } catch (err) {\n      console.log(err.message);\n    }\n  }\n  refresh() {\n    if (this.socketRef) {\n      this.socketRef.close();\n    }\n  }\n\n  state() {\n    return this.socketRef.readyState;\n  }\n  waitForConnection(callback, interval) {\n    if (this.state() === 1) {\n      callback();\n    } else {\n      var that = this;\n      // optional: implement backoff for interval here\n      setTimeout(function () {\n        that.waitForConnection(callback, interval);\n      }, interval);\n    }\n  }\n}\n\nconst WebSocketInstance = WebSocketService.getInstance();\n\nexport default WebSocketInstance;\n","import { IconButton, makeStyles, Tooltip, Typography } from \"@material-ui/core\";\nimport React, { useEffect, useRef } from \"react\";\nimport MicOffIcon from \"@material-ui/icons/MicOff\";\nimport Avatar from \"@material-ui/core/Avatar\";\nimport Fade from \"@material-ui/core/Fade\";\nimport RemoveCircleOutlineIcon from \"@material-ui/icons/RemoveCircleOutline\";\nimport WebSocketInstance from \"../../helper/WebsocketService\";\nimport { useSelector } from \"react-redux\";\nimport BlockIcon from \"@material-ui/icons/Block\";\nimport { toast } from \"react-toastify\";\nimport FlashOnIcon from \"@material-ui/icons/FlashOn\";\nimport FlashOffIcon from \"@material-ui/icons/FlashOff\";\n\nconst useStyles = makeStyles((theme) => ({\n  responsive: () => ({\n    float: \"left\",\n    display: \"flex\",\n    alignItems: \"center\",\n    transition: \"width 0.5s, height 0.5s\",\n  }),\n  videoTop: {\n    background: theme.palette.background.paper,\n  },\n  micOff: {\n    position: \"absolute\",\n    right: 0,\n    top: 0,\n  },\n  videoOff: {\n    position: \"absolute\",\n    width: \"100%\",\n    height: \"100%\",\n    top: 0,\n    left: 0,\n    display: \"flex\",\n    justifyContent: \"center\",\n    alignItems: \"center\",\n  },\n  avatar: {\n    width: \"min(50%, 10rem)\",\n    height: \"min(50%, 10rem)\",\n    fontSize: \"3rem\",\n  },\n  hoverDiv: {\n    position: \"absolute\",\n    top: \"0\",\n    left: \"0\",\n    width: \"100%\",\n    height: \"100%\",\n  },\n  remove: {\n    color: \"white\",\n    \"&:disabled\": { color: \"#444\" },\n  },\n  name: {\n    position: \"absolute\",\n    bottom: \"0.5rem\",\n    left: \"1rem\",\n    color: \"white\",\n  },\n}));\n\nconst Video = React.forwardRef(\n  (\n    {\n      peer,\n      muted,\n      size,\n      rows,\n      isUserVideo,\n      user,\n      isSharingScreen,\n      pinnedUser,\n      setPinnedUser,\n    },\n    ref\n  ) => {\n    const localRef = useRef(null);\n    const currentRef = ref || localRef;\n    const userId = user.pk || user.id;\n    const classes = useStyles();\n    const [open, setOpen] = React.useState(false);\n    const isCreator = useSelector((state) => state.roomReducer.isUserCreator);\n    const invitedUsers = useSelector(\n      (state) => state.roomReducer.currentRoom.invited_users\n    );\n    const mangoRef = useRef(null);\n    const [videoWidth, setVideoWidth] = React.useState();\n    const [videoHeight, setVideoHeight] = React.useState();\n\n    const resizeObserver = new ResizeObserver((entries) => {\n      let newWidth, newHeight;\n      for (let entry of entries) {\n        if (entry.contentBoxSize) {\n          newWidth =\n            (entry.contentRect.width * 9) / 16 < entry.contentRect.height\n              ? 0.95 * entry.contentRect.width\n              : (0.95 * entry.contentRect.height * 16) / 9;\n          newHeight =\n            (entry.contentRect.width * 9) / 16 > entry.contentRect.height\n              ? 0.95 * entry.contentRect.height\n              : (0.95 * entry.contentRect.width * 9) / 16;\n        }\n      }\n      setVideoWidth(newWidth);\n      setVideoHeight(newHeight);\n    });\n    useEffect(() => {\n      resizeObserver.observe(mangoRef.current);\n    }, []);\n    let initials =\n      (user.first_name ? user.first_name[0].toUpperCase() : \"\") +\n      (user.last_name ? user.last_name[0].toUpperCase() : \"\");\n    let fullName = user.first_name + \" \" + user.last_name;\n    fullName = fullName.trim();\n    if (isUserVideo) fullName = \"You\";\n\n    useEffect(() => {\n      if (peer) {\n        peer.on(\"stream\", (stream) => {\n          currentRef.current.srcObject = stream;\n        });\n      }\n    }, []);\n    const removeUser = () => {\n      if (!isCreator || isUserVideo) return;\n      WebSocketInstance.sendMessage(\"user kick\", { userID: user.id });\n    };\n    const blockUser = () => {\n      if (!isCreator || isUserVideo) return;\n      if (invitedUsers.some((el) => el.id === user.id)) {\n        toast.error(\"user is invited. first remove the invitation\");\n      } else {\n        WebSocketInstance.sendMessage(\"user block\", { userID: user.id });\n      }\n    };\n\n    return (\n      <div\n        className={classes.responsive}\n        ref={mangoRef}\n        style={{\n          width: `${\n            pinnedUser === userId ? 100 : pinnedUser === -1 ? 100 / size - 2 : 0\n          }%`,\n          height: `${\n            pinnedUser === userId ? 100 : pinnedUser === -1 ? 100 / rows - 2 : 0\n          }%`,\n        }}\n      >\n        <div\n          className={classes.videoTop}\n          style={{\n            width: videoWidth,\n            height: videoHeight,\n            position: \"relative\",\n            overflow: \"hidden\",\n            margin: \"auto\",\n            borderRadius: \"1rem\",\n          }}\n        >\n          <video\n            style={{\n              objectFit: \"contain\",\n              transform: isUserVideo && !isSharingScreen ? \"scaleX(-1)\" : 1,\n              position: \"absolute\",\n              top: \"0\",\n              left: \"0\",\n              display: user.videoOn ? \"block\" : \"none\",\n            }}\n            playsInline\n            width=\"100%\"\n            height=\"100%\"\n            autoPlay\n            muted={muted}\n            ref={currentRef}\n            onClick={() => {}}\n            onMouseEnter={() => {\n              setOpen(true);\n            }}\n          />\n          <Fade in={open}>\n            <div\n              className={classes.hoverDiv}\n              onMouseLeave={() => {\n                setOpen(false);\n              }}\n            >\n              <div\n                style={{\n                  opacity: 0.6,\n                  background: \"black\",\n                  width: \"100%\",\n                  height: \"100%\",\n                  display: \"flex\",\n                  justifyContent: \"center\",\n                  alignItems: \"center\",\n                }}\n              >\n                <Tooltip\n                  title={pinnedUser === userId ? \"remove pin\" : \"pin the user\"}\n                >\n                  <IconButton\n                    className={classes.remove}\n                    onClick={() => {\n                      if (pinnedUser === userId) {\n                        setPinnedUser(-1);\n                      } else {\n                        setPinnedUser(userId);\n                      }\n                    }}\n                  >\n                    {pinnedUser === userId ? (\n                      <FlashOffIcon fontSize=\"large\" />\n                    ) : (\n                      <FlashOnIcon fontSize=\"large\" />\n                    )}\n                  </IconButton>\n                </Tooltip>\n                <Tooltip title=\"remove user\">\n                  <IconButton\n                    className={classes.remove}\n                    onClick={removeUser}\n                    disabled={!isCreator || isUserVideo}\n                  >\n                    <RemoveCircleOutlineIcon fontSize=\"large\" />\n                  </IconButton>\n                </Tooltip>\n                <Tooltip title=\"Block user\">\n                  <IconButton\n                    className={classes.remove}\n                    onClick={blockUser}\n                    disabled={!isCreator || isUserVideo}\n                  >\n                    <BlockIcon fontSize=\"large\" />\n                  </IconButton>\n                </Tooltip>\n                <Typography variant=\"p\" className={classes.name}>\n                  {fullName}\n                </Typography>\n              </div>\n            </div>\n          </Fade>\n          {!user.audioOn && (\n            <IconButton className={classes.micOff}>\n              <MicOffIcon />\n            </IconButton>\n          )}\n          {!user.videoOn && (\n            <div className={classes.videoOff}>\n              <Avatar className={classes.avatar}>{initials}</Avatar>\n            </div>\n          )}\n        </div>\n      </div>\n    );\n  }\n);\n\nexport default Video;\n","import React from \"react\";\nimport {\n  Typography,\n  Dialog,\n  DialogContent,\n  DialogContentText,\n  DialogTitle,\n  DialogActions,\n  Button,\n} from \"@material-ui/core\";\nimport { useSelector } from \"react-redux\";\nimport CopyToClipboard from \"react-copy-to-clipboard\";\nimport { toast } from \"react-toastify\";\n\nconst DetailModal = ({ open, setOpen }) => {\n  const roomName = useSelector(\n    (state) => state.roomReducer.currentRoom.room_name\n  );\n  return (\n    <Dialog\n      open={open}\n      onClose={() => {\n        setOpen((o) => !o);\n      }}\n      aria-labelledby=\"alert-dialog-title\"\n      aria-describedby=\"alert-dialog-description\"\n    >\n      <DialogTitle id=\"alert-dialog-title\">{\"Meeting Details\"}</DialogTitle>\n      <DialogContent>\n        <Typography variant=\"h5\">{roomName}</Typography>\n        <br></br>\n        <Typography variant=\"p\">{\"Joining info\"}</Typography>\n        <DialogContentText id=\"alert-dialog-description\">\n          {window.location.href}\n        </DialogContentText>\n      </DialogContent>\n      <DialogActions>\n        <CopyToClipboard\n          text={window.location.href}\n          onCopy={() => {\n            toast.success(\"copied to clipboard\");\n          }}\n        >\n          <Button>Copy link</Button>\n        </CopyToClipboard>\n      </DialogActions>\n    </Dialog>\n  );\n};\n\nexport default DetailModal;\n","import React from \"react\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogTitle,\n  IconButton,\n  TextField,\n} from \"@material-ui/core\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { Col, Row } from \"react-bootstrap\";\nimport CloseIcon from \"@material-ui/icons/Close\";\nimport { useState } from \"react\";\nimport SendIcon from \"@material-ui/icons/Send\";\nimport { validateEmailAddress } from \"../../helper/helperFunctions\";\nimport { inviteUser, removeInviteUser } from \"../../redux/actions/roomActions\";\nimport { useParams } from \"react-router\";\n\nconst InviteModal = ({ open, setOpen }) => {\n  const { roomID } = useParams();\n  const invitedUsers = useSelector(\n    (state) => state.roomReducer.currentRoom.invited_users || []\n  );\n  const [email, setEmail] = useState({\n    str: \"\",\n    err_message: \"\",\n  });\n  const dispatch = useDispatch();\n  const invite = () => {\n    const str = email.str;\n    let err_message = \"\";\n    if (str.length === 0) err_message = \"email can't be empty\";\n    else if (!validateEmailAddress(str)) err_message = \"email not valid\";\n    else {\n      dispatch(\n        inviteUser(roomID, {\n          invitee: str,\n        })\n      );\n      setEmail({ str: \"\", err_message: \"\" });\n    }\n    if (err_message.length) {\n      setEmail({ str, err_message });\n    }\n  };\n  return (\n    <Dialog\n      open={open}\n      onClose={() => {\n        setOpen((o) => !o);\n      }}\n    >\n      <DialogTitle>{\"Invite people\"}</DialogTitle>\n      <DialogContent>\n        {invitedUsers.map((user, idx) => (\n          <Row key={idx} style={{ alignItems: \"center\" }}>\n            <Col>{user.email}</Col>\n            <IconButton\n              onClick={() => {\n                dispatch(removeInviteUser(roomID, { invitee: user.email }));\n              }}\n            >\n              <CloseIcon />\n            </IconButton>\n          </Row>\n        ))}\n        <TextField\n          error={email.err_message.length > 0}\n          value={email.str}\n          onChange={(value) => {\n            const email = value.target.value;\n            setEmail({ str: email, err_message: \"\" });\n          }}\n          helperText={email.err_message}\n        />\n        <IconButton onClick={invite}>\n          <SendIcon />\n        </IconButton>\n      </DialogContent>\n    </Dialog>\n  );\n};\n\nexport default InviteModal;\n","import {\n  Grid,\n  IconButton,\n  makeStyles,\n  Paper,\n  Typography,\n  Tooltip,\n  Menu,\n  MenuItem,\n} from \"@material-ui/core\";\nimport React, { useState } from \"react\";\nimport { red } from \"@material-ui/core/colors\";\nimport MicIcon from \"@material-ui/icons/Mic\";\nimport CallEndIcon from \"@material-ui/icons/CallEnd\";\nimport MicOffIcon from \"@material-ui/icons/MicOff\";\nimport VideocamOutlinedIcon from \"@material-ui/icons/VideocamOutlined\";\nimport VideocamOffOutlinedIcon from \"@material-ui/icons/VideocamOffOutlined\";\nimport MessageOutlinedIcon from \"@material-ui/icons/MessageOutlined\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { toggleAudio, toggleVideo } from \"../../redux/actions/roomActions\";\nimport { useHistory } from \"react-router\";\nimport InfoOutlinedIcon from \"@material-ui/icons/InfoOutlined\";\nimport PersonAddIcon from \"@material-ui/icons/PersonAdd\";\nimport DetailModal from \"./DetailModal\";\nimport InviteModal from \"./InviteModal\";\nimport { useMediaQuery } from \"@material-ui/core\";\nimport { useTheme } from \"@material-ui/styles\";\nimport MoreVertIcon from \"@material-ui/icons/MoreVert\";\nimport ScreenShareOutlinedIcon from \"@material-ui/icons/ScreenShareOutlined\";\nimport FlipCameraAndroidIcon from \"@material-ui/icons/FlipCameraAndroid\";\nimport MeetingRoomIcon from \"@material-ui/icons/MeetingRoom\";\n\nconst useStyles = makeStyles((theme) => ({\n  container: {\n    minHeight: \"3rem\",\n    flexGrow: 0,\n    background: theme.palette.background.default,\n  },\n  blue: { background: \"blue\" },\n  orange: {\n    color: red[500],\n  },\n  right: { marginRight: \"1rem\" },\n}));\n\nconst Controls = ({\n  switchc,\n  shareScreen,\n  toggleChat,\n  isJoinedRoom,\n  setIsJoinedRoom,\n}) => {\n  const classes = useStyles();\n  const dispatch = useDispatch();\n  const isAudioOn = useSelector((state) => state.roomReducer.userVideo.audioOn);\n  const isVideoOn = useSelector((state) => state.roomReducer.userVideo.videoOn);\n  const [detailModalOpen, setDetailModalOpen] = useState(false);\n  const [inviteModalOpen, setInviteModalOpen] = useState(false);\n  const history = useHistory();\n  const roomName = useSelector(\n    (state) => state.roomReducer.currentRoom.room_name\n  );\n  const isUserCreator = useSelector((state) => state.roomReducer.isUserCreator);\n  const leftRoom = () => {\n    history.replace(\"/\");\n  };\n  const theme = useTheme();\n  const isMobile = useMediaQuery(theme.breakpoints.down(\"sm\"));\n  const [anchorEl, setAnchorEl] = React.useState(null);\n  const isMenuOpen = Boolean(anchorEl);\n\n  return (\n    <Paper elevation={3} className={classes.container}>\n      <Grid\n        justify=\"space-between\"\n        container\n        alignItems=\"center\"\n        style={{ height: \"100%\" }}\n      >\n        <div>\n          <Typography variant=\"h5\" style={{ marginLeft: \"1rem\" }}>\n            {roomName}\n          </Typography>\n        </div>\n        <div>\n          <Tooltip title={isAudioOn ? \"Mic On\" : \"Mic off\"}>\n            <IconButton\n              color=\"inherit\"\n              onClick={() => {\n                dispatch(toggleAudio());\n              }}\n            >\n              {isAudioOn ? <MicIcon /> : <MicOffIcon />}\n            </IconButton>\n          </Tooltip>\n          {isJoinedRoom ? (\n            <Tooltip title=\"end call\">\n              <IconButton color=\"inherit\" onClick={leftRoom}>\n                <CallEndIcon className={classes.orange} />\n              </IconButton>\n            </Tooltip>\n          ) : (\n            <Tooltip title=\"Join the meeting\">\n              <IconButton\n                color=\"inherit\"\n                onClick={() => {\n                  setIsJoinedRoom(true);\n                }}\n              >\n                <MeetingRoomIcon />\n              </IconButton>\n            </Tooltip>\n          )}\n          <Tooltip title={isVideoOn ? \"video on\" : \"video off\"}>\n            <IconButton\n              color=\"inherit\"\n              onClick={() => {\n                dispatch(toggleVideo());\n              }}\n            >\n              {isVideoOn ? (\n                <VideocamOutlinedIcon />\n              ) : (\n                <VideocamOffOutlinedIcon />\n              )}\n            </IconButton>\n          </Tooltip>\n\n          {isJoinedRoom && (\n            <Tooltip title=\"share screen\">\n              <IconButton\n                color=\"inherit\"\n                onClick={() => {\n                  shareScreen();\n                }}\n              >\n                <ScreenShareOutlinedIcon />\n              </IconButton>\n            </Tooltip>\n          )}\n        </div>\n        {!isMobile && (\n          <div className={classes.right}>\n            <Tooltip title=\"switch camera\">\n              <IconButton\n                color=\"inherit\"\n                onClick={() => {\n                  switchc();\n                }}\n              >\n                <FlipCameraAndroidIcon />\n              </IconButton>\n            </Tooltip>\n            {isUserCreator && isJoinedRoom && (\n              <Tooltip title=\"invite users\">\n                <IconButton\n                  onClick={() => {\n                    setInviteModalOpen((o) => !o);\n                  }}\n                >\n                  <PersonAddIcon />\n                </IconButton>\n              </Tooltip>\n            )}\n            <Tooltip title=\"Meeting Details\">\n              <IconButton\n                onClick={() => {\n                  setDetailModalOpen((o) => !o);\n                }}\n              >\n                <InfoOutlinedIcon />\n              </IconButton>\n            </Tooltip>\n            <Tooltip title=\"Chat\">\n              <IconButton onClick={toggleChat}>\n                <MessageOutlinedIcon />\n              </IconButton>\n            </Tooltip>\n          </div>\n        )}\n        {isMobile && (\n          <div className={classes.right}>\n            <IconButton\n              aria-controls=\"simple-theme-menu\"\n              aria-haspopup=\"true\"\n              color=\"inherit\"\n              className=\"header-title-button\"\n              onClick={(event) => setAnchorEl(event.currentTarget)}\n            >\n              <MoreVertIcon />\n            </IconButton>\n            <Menu\n              anchorEl={anchorEl}\n              id={\"controls-menu\"}\n              keepMounted\n              open={isMenuOpen}\n              onClose={() => {\n                setAnchorEl(null);\n              }}\n            >\n              {isUserCreator && isJoinedRoom && (\n                <MenuItem\n                  onClick={() => {\n                    setAnchorEl(null);\n                    setInviteModalOpen((o) => !o);\n                  }}\n                >\n                  Invite User\n                </MenuItem>\n              )}\n              <MenuItem\n                onClick={() => {\n                  setAnchorEl(null);\n                  setDetailModalOpen((o) => !o);\n                }}\n              >\n                Meeting Details\n              </MenuItem>\n              <MenuItem\n                onClick={() => {\n                  setAnchorEl(null);\n                  toggleChat();\n                }}\n              >\n                Chat\n              </MenuItem>\n            </Menu>\n          </div>\n        )}\n        {isUserCreator && isJoinedRoom && (\n          <InviteModal open={inviteModalOpen} setOpen={setInviteModalOpen} />\n        )}\n        <DetailModal open={detailModalOpen} setOpen={setDetailModalOpen} />\n      </Grid>\n    </Paper>\n  );\n};\n\nexport default Controls;\n","export const split = (x) => {\n  let n = Math.floor(Math.sqrt(x));\n  let zp = n - (x % n);\n  let pp = Math.floor(x / n);\n  let m = [];\n  for (let i = 0; i < n; i++) {\n    if (i >= zp) {\n      m.push(pp + 1);\n    } else {\n      m.push(pp);\n    }\n  }\n  m = m.reverse();\n  let res = {};\n  let count = 1;\n  let idx = 0;\n  for (let i = 1; i <= x; i++) {\n    res[i] = m[idx];\n    count++;\n    if (count > m[idx]) {\n      count = 1;\n      idx++;\n    }\n  }\n  res[\"rows\"] = m.length;\n  return res;\n};\n\nexport function detectURL(message) {\n  var urlRegex = /(((https?:\\/\\/)|(www\\.))[^\\s]+)/g;\n  return message.replace(urlRegex, function (urlMatch) {\n    return `<a href=${urlMatch} target=\"_blank\" >${urlMatch}</a>`;\n  });\n}\nexport function sanitize(string) {\n  const map = {\n    \"&\": \"&amp;\",\n    \"<\": \"&lt;\",\n    \">\": \"&gt;\",\n    '\"': \"&quot;\",\n    \"'\": \"&#x27;\",\n    \"/\": \"&#x2F;\",\n  };\n  const reg = /[&<>\"'/]/gi;\n  return string.replace(reg, (match) => map[match]);\n}\n\nexport const getFullName = (firstName, lastName) => {\n  const fullName = firstName + \" \" + lastName;\n  return fullName.trim();\n};\n","import React, { useCallback, useEffect, useState } from \"react\";\nimport Drawer from \"@material-ui/core/Drawer\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport { IconButton } from \"@material-ui/core\";\nimport ChevronRightIcon from \"@material-ui/icons/ChevronRight\";\nimport WebSocketService from \"../../helper/WebsocketService\";\nimport TextField from \"@material-ui/core/TextField\";\nimport { Send } from \"@material-ui/icons\";\nimport InputAdornment from \"@material-ui/core/InputAdornment\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport \"./chat.css\";\nimport { setMessages, setNewMessage } from \"../../redux/actions/roomActions\";\nconst drawerWidth = 360;\n\nconst useStyles = makeStyles((theme) => ({\n  drawer: {\n    width: drawerWidth,\n    flexShrink: 0,\n  },\n  drawerPaper: {\n    width: drawerWidth,\n    height: \"calc(100vh - 9rem)\",\n    borderRadius: \"1rem\",\n    top: \"5rem\",\n    right: \"12px\",\n  },\n  drawerHeader: {\n    display: \"flex\",\n    alignItems: \"center\",\n    padding: theme.spacing(0, 1),\n    ...theme.mixins.toolbar,\n    justifyContent: \"flex-start\",\n  },\n  chatInputContainer: {\n    marginTop: \"auto\",\n  },\n  chatInput: {\n    marginBottom: \"2rem\",\n    \"& .MuiFilledInput-root\": {\n      borderRadius: \"50px\",\n      borderBottom: 0,\n      paddingTop: \"15px\",\n      paddingBottom: \"15px\",\n      \"&::before\": { borderBottom: 0 },\n    },\n  },\n  messageBoxRight: {\n    background: theme.palette.background.paper,\n    color: theme.palette.text.primary,\n  },\n  messageBoxLeft: {\n    background: \"#4870df\",\n    color: theme.palette.background.default,\n  },\n  messageSender: {\n    color: theme.palette.text.primary,\n    fontSize: \"10px\",\n  },\n}));\n\nconst MessageItem = (props) => {\n  const owner = useSelector((state) => state.userReducer.user);\n  const classes = useStyles();\n  let messagePosition =\n    owner.pk === props.sender.id\n      ? `chatApp__convMessageItem--right`\n      : `chatApp__convMessageItem--left`;\n  let messageBackground =\n    owner.pk === props.sender.id\n      ? classes.messageBoxRight\n      : classes.messageBoxLeft;\n  return (\n    <div\n      className={\"chatApp__convMessageItem \" + messagePosition + \" clearfix\"}\n    >\n      <div className={`chatApp__convMessageValue ${messageBackground}`}>\n        {owner.pk !== props.sender.id && (\n          <div className={classes.messageSender}>{props.sender.first_name}</div>\n        )}\n        <div>{props.message}</div>\n      </div>\n    </div>\n  );\n};\n\nconst MessageList = React.memo((props) => {\n  return (\n    <div className={\"chatApp__convTimeline\"}>\n      {props.messages\n        .slice(0)\n        .reverse()\n        .map((messageItem, idx) => (\n          <MessageItem\n            key={idx}\n            sender={messageItem.user}\n            message={messageItem.message}\n          />\n        ))}\n    </div>\n  );\n});\n\nconst Chat = ({ open, setOpen }) => {\n  const messages = useSelector((state) => state.roomReducer.roomMessages);\n  const [currMessage, setCurrMessage] = useState(\"\");\n  const classes = useStyles();\n  const dispatch = useDispatch();\n  useEffect(() => {\n    WebSocketService.on(\"receive new message\", (data) => {\n      dispatch(setNewMessage(data));\n    });\n    WebSocketService.on(\"get all messages\", (data) => {\n      dispatch(setMessages(data.messages));\n    });\n  }, []);\n  const sendMessage = () => {\n    WebSocketService.sendMessage(\"send new message\", currMessage);\n    setCurrMessage(\"\");\n  };\n\n  const onCurrMessageChanged = useCallback((e) => {\n    const val = e.target.value;\n    setCurrMessage(val);\n  }, []);\n  return (\n    <Drawer\n      className={classes.drawer}\n      variant=\"persistent\"\n      anchor=\"right\"\n      open={open}\n      classes={{\n        paper: classes.drawerPaper,\n      }}\n    >\n      <div className={classes.drawerHeader}>\n        <IconButton\n          onClick={() => {\n            setOpen(false);\n          }}\n        >\n          <ChevronRightIcon />\n        </IconButton>\n      </div>\n      <MessageList messages={messages} />\n      <div className={classes.chatInputContainer}>\n        <TextField\n          placeholder=\"send a message to everyone\"\n          size=\"small\"\n          variant=\"filled\"\n          fullWidth\n          multiline\n          rowsMax={4}\n          className={classes.chatInput}\n          value={currMessage}\n          onChange={onCurrMessageChanged}\n          InputProps={{\n            endAdornment: (\n              <InputAdornment position=\"end\">\n                {currMessage.length > 0 && (\n                  <IconButton\n                    aria-label=\"toggle password visibility\"\n                    onClick={sendMessage}\n                  >\n                    <Send />\n                  </IconButton>\n                )}\n              </InputAdornment>\n            ),\n          }}\n        />\n      </div>\n    </Drawer>\n  );\n};\n\nexport default Chat;\n","import { toast } from \"react-toastify\";\nimport WebsocketService from \"./WebsocketService\";\nimport { getFullName } from \"../helper/utilFunctions\";\nimport { getUniqueArray } from \"./helperFunctions\";\nimport { addPeer, createPeer } from \"./peers\";\n\nexport const all_users_listener =\n  (peersRef, myID, stream, setPeers) => (users) => {\n    peersRef.current = {};\n    const temp = {};\n    users.forEach((user) => {\n      if (myID !== user.id) {\n        const peer = createPeer(user.id, myID, stream);\n\n        peersRef.current[user.id] = { user, peer };\n        temp[user.id] = {\n          user: user,\n          peer: peer,\n        };\n      }\n    });\n    setPeers(temp);\n  };\n\nexport const user_joined_listener =\n  (myID, peersRef, stream, setPeers, isUserAudioOn, isUserVideoOn) =>\n  (payload) => {\n    const user = payload.callerUser;\n    if (payload.usable_id === myID) {\n      const peer = addPeer(payload.signal, user.id, stream);\n      peersRef.current[user.id] = { user, peer };\n      setPeers((peers) => ({\n        ...peers,\n        [user.id]: {\n          user: user,\n          peer: peer,\n        },\n      }));\n      toast.info(`${getFullName(user.first_name, user.last_name)} joined`);\n    }\n  };\n\nexport const receive_returned_signal = (myID, peersRef, isUserAudioOn, isUserVideoOn) => (payload) => {\n    if (payload.usable_id === myID) {\n      const { peer } = peersRef.current[payload.id];\n      peer.signal(payload.signal);\n\n      WebsocketService.sendMessage(\"audioMedia\", {\n        userID: myID,\n        audioOn: isUserAudioOn,\n      });\n      WebsocketService.sendMessage(\"videoMedia\", {\n        userID: myID,\n        videoOn: isUserVideoOn,\n      });\n      WebsocketService.sendMessage(\"get media\", \"\");\n    }\n  };\n\nexport const user_left_listener = (myID, peersRef, setPeers) => (payload) => {\n  const user = payload.user;\n  if (peersRef.current[user.id]) {\n    peersRef.current[user.id].peer.destroy();\n  }\n  delete peersRef.current[user.id];\n  setPeers((peers) => {\n    const { [payload.user.id]: remove, ...rest } = peers;\n    return rest;\n  });\n  if (payload.user.id !== myID) {\n    toast.info(`${getFullName(user.first_name, user.last_name)} left`);\n  }\n};\n\nexport const videoMediaListener = (peersRef, setPeers) => (payload) => {\n  const userID = payload.userID;\n  if (peersRef.current[userID]) {\n    peersRef.current[userID].user.videoOn = payload.videoOn;\n    setPeers((peers) => {\n      const { user, peer } = peers[userID];\n      return {\n        ...peers,\n        [userID]: { peer, user: { ...user, videoOn: payload.videoOn } },\n      };\n    });\n  }\n};\n\nexport const audioMediaListener = (peersRef, setPeers) => (payload) => {\n  const userID = payload.userID;\n  if (peersRef.current[userID]) {\n    peersRef.current[userID].user.audioOn = payload.audioOn;\n    setPeers((peers) => {\n      const { user, peer } = peers[userID];\n      return {\n        ...peers,\n        [userID]: { peer, user: { ...user, audioOn: payload.audioOn } },\n      };\n    });\n  }\n};\n\nexport const getMediaListener = (peersRef, setPeers) => (payload) => {\n  for (let key in peersRef.current) {\n    if (payload.audio[key]) {\n      peersRef.current[key].user.audioOn = payload.audio[key];\n    }\n    if (payload.video[key]) {\n      peersRef.current[key].user.videoOn = payload.video[key];\n    }\n  }\n  setPeers((peers) => {\n    for (let key in peers) {\n      if (payload.audio[key]) {\n        peers[key].user.audioOn = payload.audio[key];\n      }\n      if (payload.video[key]) {\n        peers[key].user.videoOn = payload.video[key];\n      }\n    }\n    return { ...peers };\n  });\n};\n\nexport const getPermissionListener = (myID, setAcceptStatus) => (payload) => {\n  if (payload.usable_id === myID) {\n    setAcceptStatus(payload.status);\n  }\n};\n\nexport const getPermissionRequestListener =\n  (myID, setWaitingUsers) => (payload) => {\n    if (payload.usable_id === myID) {\n      setWaitingUsers((users) => {\n        users.push(payload.user);\n        const newUsers = getUniqueArray(users, \"id\");\n        return newUsers;\n      });\n    }\n  };\n\nexport const userKickedListener = (myID, history) => (payload) => {\n  if (payload.usable_id === myID) {\n    history.replace(\"/\", {\n      message: \"The Organisor removed you from room\",\n      type: \"error\",\n    });\n  }\n};\n\nexport const userBlockedListener = (myID, history) => (payload) => {\n  if (payload.usable_id === myID) {\n    history.replace(\"/\", {\n      message: \"The Organisor blocked you from room\",\n      type: \"error\",\n    });\n  }\n};\n\nexport const joinMessageListener =\n  (setAcceptStatus, setServerMessage) => (message) => {\n    setAcceptStatus(\"message\");\n    if (message === \"creator not available\") {\n      setServerMessage(\n        \"The Organisor has not joined the room yet. Please try joining after some time\"\n      );\n    } else if (message === \"user blocked\") {\n      setServerMessage(\"The Organisor has blocked you.\");\n    }\n  };\n","import Peer from \"simple-peer\";\nimport WebsocketService from \"./WebsocketService\";\n\nexport function createPeer(userToSignal, callerID, stream) {\n  const peer = new Peer({\n    initiator: true,\n    trickle: false,\n    stream,\n  });\n  peer.on(\"signal\", (signal) => {\n    WebsocketService.sendMessage(\"sending signal\", {\n      userToSignal,\n      callerID,\n      signal,\n    });\n  });\n  return peer;\n}\n\nexport function addPeer(incomingSignal, callerID, stream) {\n  const peer = new Peer({\n    initiator: false,\n    trickle: false,\n    stream,\n  });\n  peer.on(\"signal\", (signal) => {\n    WebsocketService.sendMessage(\"returning signal\", { signal, callerID });\n  });\n  peer.signal(incomingSignal);\n  return peer;\n}\n","import { IconButton } from \"@material-ui/core\";\nimport React from \"react\";\nimport { Modal, Row, Col } from \"react-bootstrap\";\nimport CloseIcon from \"@material-ui/icons/Close\";\nimport CheckIcon from \"@material-ui/icons/Check\";\nimport { makeStyles } from \"@material-ui/styles\";\nimport WebSocketInstance from \"../../helper/WebsocketService\";\n\nconst useStyles = makeStyles((theme) => ({\n  modal: {\n    \"&& .modal-content\": {\n      background: theme.palette.background.paper,\n      color: theme.palette.text.primary,\n    },\n  },\n}));\n\nconst JoinModal = ({ waitingUsers, setWaitingUsers }) => {\n  const classes = useStyles();\n  const rejectUser = (user) => {\n    WebSocketInstance.sendMessage(\"give join permission status\", {\n      userID: user.id,\n      status: \"reject\",\n    });\n    setWaitingUsers((users) => users.filter((el) => el.id !== user.id));\n  };\n  const acceptUser = (user) => {\n    WebSocketInstance.sendMessage(\"give join permission status\", {\n      userID: user.id,\n      status: \"accept\",\n    });\n    setWaitingUsers((users) => users.filter((el) => el.id !== user.id));\n  };\n  return (\n    <Modal\n      show={Boolean(waitingUsers.length)}\n      onHide={() => {}}\n      backdrop=\"static\"\n      keyboard={false}\n      className={classes.modal}\n    >\n      <Modal.Header>\n        <Modal.Title>Modal title</Modal.Title>\n      </Modal.Header>\n      <Modal.Body>\n        {waitingUsers.map((user, idx) => (\n          <Row key={idx} style={{ alignItems: \"center\" }}>\n            <Col>{user.first_name} wants to join</Col>\n            <IconButton\n              onClick={() => {\n                rejectUser(user);\n              }}\n            >\n              <CloseIcon />\n            </IconButton>\n            <IconButton\n              onClick={() => {\n                acceptUser(user);\n              }}\n            >\n              <CheckIcon />\n            </IconButton>\n          </Row>\n        ))}\n      </Modal.Body>\n      <Modal.Footer></Modal.Footer>\n    </Modal>\n  );\n};\n\nexport default JoinModal;\n","export const updateStream = (peersRef, setPeers, userStream) => (stream) => {\n  for (let key in peersRef.current) {\n    peersRef.current[key].peer.replaceTrack(\n      userStream.getVideoTracks()[0],\n      stream.getVideoTracks()[0],\n      userStream\n    );\n  }\n  setPeers({ ...peersRef.current });\n  userStream.removeTrack(userStream.getVideoTracks()[0]);\n  userStream.addTrack(stream.getVideoTracks()[0]);\n};\n\nexport const switchCamera =\n  (peersRef, setPeers, userStream, videoConstraints) =>\n  async (currentCameraRef) => {\n    const devices = await navigator.mediaDevices.enumerateDevices();\n    const videoDevices = devices.filter(\n      (device) => device.kind === \"videoinput\"\n    );\n    currentCameraRef.current =\n      (currentCameraRef.current + 1) % videoDevices.length;\n\n    const updatedConstraints = {\n      ...videoConstraints,\n      deviceId: {\n        exact: videoDevices[currentCameraRef.current].deviceId,\n      },\n    };\n    videoConstraints = updatedConstraints;\n\n    const stream = await navigator.mediaDevices.getUserMedia({\n      video: videoConstraints,\n      audio: true,\n    });\n    updateStream(peersRef, setPeers, userStream)(stream);\n  };\n\nexport const shareScreen = async (\n  peersRef,\n  setPeers,\n  videoConstraints,\n  userStream,\n  setIsSharingScreen\n) => {\n  const screenStream = await navigator.mediaDevices.getDisplayMedia({\n    cursor: true,\n  });\n  updateStream(peersRef, setPeers, userStream)(screenStream);\n  setIsSharingScreen(true);\n  screenStream.getTracks()[0].onended = async () => {\n    const stream = await navigator.mediaDevices.getUserMedia({\n      video: videoConstraints,\n      audio: true,\n    });\n    updateStream(peersRef, setPeers, userStream)(stream);\n    setIsSharingScreen(false);\n  };\n};\n","import React, { useEffect, useRef, useState } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport WebsocketService from \"../helper/WebsocketService\";\nimport { useParams } from \"react-router\";\nimport Video from \"../components/common/Video\";\nimport Controls from \"../components/Room/Controls\";\nimport { split } from \"../helper/utilFunctions\";\nimport Chat from \"../components/Room/Chat\";\nimport { makeStyles } from \"@material-ui/core\";\nimport {\n  all_users_listener,\n  user_joined_listener,\n  user_left_listener,\n  receive_returned_signal,\n  videoMediaListener,\n  audioMediaListener,\n  getPermissionRequestListener,\n  getMediaListener,\n} from \"../helper/socketListeners\";\nimport JoinModal from \"../components/Room/JoinModal\";\nimport { shareScreen, switchCamera } from \"../helper/unusedFunctions\";\nimport { getIsUserCreator, getRoom } from \"../redux/actions/roomActions\";\n\nlet videoConstraints = {\n  height: window.innerHeight / 2,\n  width: window.innerWidth / 2,\n};\n\nconst useStyles = makeStyles((theme) => ({\n  container: {\n    display: \"flex\",\n    height: \"100%\",\n    width: \"100%\",\n    flexDirection: \"column\",\n    background: theme.palette.background.default,\n  },\n}));\n\nconst socketFunctions = (\n  peersRef,\n  myID,\n  stream,\n  setPeers,\n  isUserAudioOn,\n  isUserVideoOn,\n  setWaitingUsers\n) => {\n  WebsocketService.on(\n    \"all users\",\n    all_users_listener(peersRef, myID, stream, setPeers)\n  );\n  WebsocketService.on(\n    \"user joined\",\n    user_joined_listener(\n      myID,\n      peersRef,\n      stream,\n      setPeers,\n      isUserAudioOn,\n      isUserVideoOn\n    )\n  );\n\n  WebsocketService.on(\n    \"receiving returned signal\",\n    receive_returned_signal(myID, peersRef, isUserAudioOn, isUserVideoOn)\n  );\n\n  WebsocketService.on(\n    \"user left\",\n    user_left_listener(myID, peersRef, setPeers)\n  );\n\n  WebsocketService.on(\"videoMedia\", videoMediaListener(peersRef, setPeers));\n\n  WebsocketService.on(\"audioMedia\", audioMediaListener(peersRef, setPeers));\n  WebsocketService.on(\n    \"user want to join\",\n    getPermissionRequestListener(myID, setWaitingUsers)\n  );\n  WebsocketService.on(\"get media\", getMediaListener(peersRef, setPeers));\n};\n\nconst Room = () => {\n  const { roomID } = useParams();\n  const [peers, setPeers] = useState({});\n  const userVideo = useRef();\n  const peersRef = useRef({});\n  const myID = useSelector((state) => state.userReducer.user.pk);\n  const [userStream, setUserStream] = useState();\n  const currentCameraRef = useRef(0);\n  let sizeMap = split(Object.keys(peers).length + 1);\n  const [chatOpen, setChatOpen] = useState(false);\n  const isUserAudioOn = useSelector(\n    (state) => state.roomReducer.userVideo.audioOn\n  );\n  const isUserVideoOn = useSelector(\n    (state) => state.roomReducer.userVideo.videoOn\n  );\n  const classes = useStyles();\n  const me = useSelector((state) => state.userReducer.user);\n  const [waitingUsers, setWaitingUsers] = useState([]);\n  const dispatch = useDispatch();\n  const [isSharingScreen, setIsSharingScreen] = useState(false);\n  const [pinnedUser, setPinnedUser] = useState(-1);\n\n  const [isJoinedRoom, setIsJoinedRoom] = useState(false);\n\n  const setCameraStream = async () => {\n    const stream = await navigator.mediaDevices.getUserMedia({\n      video: true,\n      audio: true,\n    });\n    setUserStream(stream);\n    if (userVideo && userVideo.current) {\n      userVideo.current.srcObject = stream;\n    }\n  };\n\n  const socketConnect = async () => {\n    await setCameraStream();\n    WebsocketService.sendMessage(\"get all messages\", \"\");\n  };\n\n  useEffect(() => {\n    dispatch(getIsUserCreator(roomID));\n    dispatch(getRoom(roomID));\n    socketConnect();\n  }, []);\n\n  useEffect(() => {\n    if (isJoinedRoom) {\n      socketFunctions(\n        peersRef,\n        myID,\n        userStream,\n        setPeers,\n        isUserAudioOn,\n        isUserVideoOn,\n        setWaitingUsers\n      );\n    }\n  }, [isJoinedRoom, userStream, isUserAudioOn, isUserVideoOn, myID]);\n\n  useEffect(() => {\n    let userStreamRef = userStream;\n    return () => {\n      if (userStreamRef) {\n        userStreamRef.getVideoTracks().forEach((track) => {\n          track.stop();\n        });\n        userStreamRef.getAudioTracks().forEach((track) => {\n          track.stop();\n        });\n      }\n    };\n  }, [userStream]);\n\n  useEffect(() => {\n    if (userStream) {\n      userStream.getAudioTracks()[0].enabled = isUserAudioOn;\n      if (WebsocketService.state() === 1) {\n        WebsocketService.sendMessage(\"audioMedia\", {\n          userID: myID,\n          audioOn: isUserAudioOn,\n        });\n      }\n    }\n  }, [userStream, isUserAudioOn, myID]);\n\n  useEffect(() => {\n    if (isJoinedRoom) {\n      WebsocketService.sendMessage(\"join room\", roomID);\n    }\n  }, [isJoinedRoom]);\n\n  useEffect(() => {\n    if (userStream) {\n      userStream.getVideoTracks()[0].enabled = isUserVideoOn;\n      if (WebsocketService.state() === 1) {\n        WebsocketService.sendMessage(\"videoMedia\", {\n          userID: myID,\n          videoOn: isUserVideoOn,\n        });\n      }\n    }\n  }, [userStream, isUserVideoOn, myID]);\n\n  useEffect(() => {\n    sizeMap = split(Object.keys(peers).length + 1);\n  }, [peers]);\n\n  return (\n    <div className={classes.container}>\n      <div\n        style={{\n          display: \"flex\",\n          width: \"100%\",\n          maxHeight: \"calc(100vh - 7rem)\",\n          margin: \"auto\",\n          flexGrow: \"1\",\n          flexWrap: \"wrap\",\n        }}\n      >\n        <Video\n          muted\n          ref={userVideo}\n          user={{ ...me, videoOn: isUserVideoOn, audioOn: isUserAudioOn }}\n          autoPlay\n          playsInline\n          size={sizeMap[1]}\n          rows={sizeMap[\"rows\"]}\n          isUserVideo\n          isSharingScreen={isSharingScreen}\n          pinnedUser={pinnedUser}\n          setPinnedUser={setPinnedUser}\n        />\n        {Object.values(peers).map((item, index) => {\n          return (\n            <Video\n              key={index}\n              peer={item.peer}\n              user={item.user}\n              size={sizeMap[index + 2]}\n              rows={sizeMap[\"rows\"]}\n              pinnedUser={pinnedUser}\n              setPinnedUser={setPinnedUser}\n            />\n          );\n        })}\n      </div>\n      <JoinModal\n        waitingUsers={waitingUsers}\n        setWaitingUsers={setWaitingUsers}\n      />\n      <Controls\n        switchc={() => {\n          switchCamera(\n            peersRef,\n            setPeers,\n            userStream,\n            videoConstraints\n          )(currentCameraRef);\n        }}\n        shareScreen={() => {\n          shareScreen(\n            peersRef,\n            setPeers,\n            videoConstraints,\n            userStream,\n            setIsSharingScreen\n          );\n        }}\n        toggleChat={() => {\n          setChatOpen((open) => !open);\n        }}\n        isJoinedRoom={isJoinedRoom}\n        setIsJoinedRoom={setIsJoinedRoom}\n      />\n      <Chat open={chatOpen} setOpen={setChatOpen} />\n    </div>\n  );\n};\n\nexport default Room;\n","import React, { useEffect, useState } from \"react\";\nimport WebSocketInstance from \"../helper/WebsocketService\";\nimport { useHistory, useParams } from \"react-router\";\nimport Room from \"./RoomView\";\nimport {\n  getPermissionListener,\n  joinMessageListener,\n  userBlockedListener,\n  userKickedListener,\n} from \"../helper/socketListeners\";\nimport { useSelector } from \"react-redux\";\nimport Typography from \"@material-ui/core/Typography\";\nimport CircularProgress from \"@material-ui/core/CircularProgress\";\nimport { makeStyles } from \"@material-ui/styles\";\nimport { Paper } from \"@material-ui/core\";\nconst useStyles = makeStyles((theme) => ({\n  container: {\n    background: theme.palette.background.default,\n    height: \"100%\",\n    width: \"100%\",\n    position: \"relative\",\n  },\n  color: { color: theme.palette.text.primary },\n  paper: {\n    display: \"flex\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    maxWidth: \"75vw\",\n    position: \"relative\",\n    marginLeft: \"auto\",\n    marginRight: \"auto\",\n    top: \"3rem\",\n  },\n}));\n\nconst View = () => {\n  const { roomID } = useParams();\n  const history = useHistory();\n  const classes = useStyles();\n  const myID = useSelector((state) => state.userReducer.user.pk);\n  const [acceptStatus, setAcceptStatus] = useState(\"pending\");\n  const [serverMessage, setServerMessage] = useState(\"\");\n  useEffect(() => {\n    WebSocketInstance.refresh();\n    let protocol = window.location.protocol === \"http:\" ? \"ws\" : \"wss\";\n    let host = window.location.hostname.includes(\"localhost\")\n      ? \"localhost:7000\"\n      : window.location.hostname;\n    WebSocketInstance.connect(\n      `${protocol}://${host}/ws/room/${roomID}/`,\n      (e) => {\n        history.replace(\"/\", {\n          message: \"the url entered is incorrect.\",\n          type: \"error\",\n        });\n      }\n    );\n    WebSocketInstance.on(\n      \"get permission\",\n      getPermissionListener(myID, setAcceptStatus)\n    );\n    WebSocketInstance.on(\n      \"join message\",\n      joinMessageListener(setAcceptStatus, setServerMessage)\n    );\n    WebSocketInstance.on(\"user kicked\", userKickedListener(myID, history));\n    WebSocketInstance.on(\"user blocked\", userBlockedListener(myID, history));\n    return () => {\n      WebSocketInstance.close();\n    };\n  }, []);\n\n  useEffect(() => {\n    if (acceptStatus === \"reject\") {\n      history.replace(\"/\", {\n        message: \"The creator rejected the join request\",\n        type: \"error\",\n      });\n    }\n  }, [acceptStatus]);\n\n  return (\n    <>\n      {acceptStatus === \"pending\" ? (\n        <div className={classes.container}>\n          <Paper elevation={3} variant=\"outlined\" className={classes.paper}>\n            <Typography\n              variant=\"h2\"\n              className={classes.color}\n              style={{ width: \"max-content\" }}\n            >\n              Joining the room\n            </Typography>\n            <CircularProgress\n              className={classes.color}\n              style={{ marginLeft: \"1rem\" }}\n            />\n          </Paper>\n        </div>\n      ) : acceptStatus === \"accept\" ? (\n        <Room />\n      ) : acceptStatus === \"message\" ? (\n        <div className={classes.container}>\n          <Paper elevation={3} variant=\"outlined\" className={classes.paper}>\n            <Typography\n              variant=\"h2\"\n              className={classes.color}\n              style={{ width: \"max-content\" }}\n              align=\"center\"\n            >\n              {serverMessage}\n            </Typography>\n          </Paper>\n        </div>\n      ) : null}\n    </>\n  );\n};\n\nexport default View;\n"],"sourceRoot":""}