{"version":3,"sources":["redux/actions/roomActions.js","helper/WebsocketService.js","components/common/Video.js","components/Room/DetailModal.js","components/Room/InviteModal.js","components/Room/Controls.js","helper/utilFunctions.js","components/Room/Chat.js","helper/socketListeners.js","helper/peers.js","components/Room/JoinModal.js","helper/unusedFunctions.js","views/RoomView.js","views/View.js"],"names":["createNewRoom","data","url","create_room","dispatch","apiClient","post","then","res","apiDispatch","CREATE_ROOM","navigator","clipboard","writeText","getUrlFromCode","id","toast","success","catch","err","error","getRooms","get_room","get","GET_ROOMS","deleteRoom","roomID","fallback","getState","delete","getRoom","GET_ROOM","toggleAudio","TOGGLE_USER_AUDIO","toggleVideo","TOGGLE_USER_VIDEO","inviteUser","roomId","invite","response","removeInviteUser","removeInvite","getInvitations","getIsUserCreator","isUserCreator","SET_USER_IS_CREATOR","isCreator","WebSocketService","callbacks","this","socketRef","forcedClose","chatroom_url","WebSocket","onopen","console","log","onmessage","e","socketNewMessage","onerror","debug","onclose","code","setTimeout","connect","reason","close","command","func","received_data","parsedData","JSON","parse","Object","keys","length","type","waitForConnection","send","stringify","bind","message","readyState","callback","interval","state","that","instance","WebSocketInstance","getInstance","useStyles","makeStyles","theme","responsive","size","rows","float","width","height","display","alignItems","videoTop","background","palette","paper","micOff","position","right","top","videoOff","left","justifyContent","avatar","fontSize","hoverDiv","remove","color","name","bottom","Video","React","forwardRef","ref","peer","muted","isUserVideo","user","isSharingScreen","localRef","useRef","currentRef","classes","useState","open","setOpen","useSelector","roomReducer","invitedUsers","currentRoom","invited_users","mangoRef","videoWidth","current","getBoundingClientRect","videoHeight","initials","first_name","toUpperCase","last_name","fullName","trim","useEffect","on","stream","srcObject","className","style","overflow","margin","borderRadius","objectFit","transform","videoOn","playsInline","autoPlay","onClick","onMouseEnter","Fade","in","onMouseLeave","opacity","Tooltip","title","IconButton","sendMessage","userID","disabled","some","el","Typography","variant","audioOn","Avatar","DetailModal","roomName","room_name","Dialog","onClose","o","aria-labelledby","aria-describedby","DialogTitle","DialogContent","DialogContentText","window","location","href","DialogActions","text","onCopy","Button","InviteModal","useParams","str","err_message","email","setEmail","useDispatch","map","idx","Row","Col","invitee","TextField","value","onChange","target","helperText","validateEmailAddress","container","minHeight","flexGrow","default","blue","orange","red","marginRight","Controls","switchc","shareScreen","toggleChat","isAudioOn","userVideo","isVideoOn","detailModalOpen","setDetailModalOpen","inviteModalOpen","setInviteModalOpen","history","useHistory","useTheme","isMobile","useMediaQuery","breakpoints","down","anchorEl","setAnchorEl","isMenuOpen","Boolean","Paper","elevation","Grid","justify","marginLeft","replace","aria-controls","aria-haspopup","event","currentTarget","Menu","keepMounted","MenuItem","split","x","n","Math","floor","sqrt","zp","pp","m","i","push","reverse","count","getFullName","firstName","lastName","drawer","flexShrink","drawerPaper","drawerHeader","padding","spacing","mixins","toolbar","chatInputContainer","marginTop","chatInput","marginBottom","borderBottom","paddingTop","paddingBottom","messageBoxRight","primary","messageBoxLeft","messageSender","MessageItem","props","owner","userReducer","messagePosition","pk","sender","messageBackground","MessageList","memo","messages","slice","messageItem","senderAvatar","Chat","setMessages","currMessage","setCurrMessage","onCurrMessageChanged","useCallback","val","Drawer","anchor","placeholder","fullWidth","multiline","rowsMax","InputProps","endAdornment","InputAdornment","aria-label","all_users_listener","peersRef","myID","setPeers","users","temp","forEach","userToSignal","callerID","Peer","initiator","trickle","signal","WebsocketService","createPeer","user_joined_listener","isUserAudioOn","isUserVideoOn","payload","callerUser","usable_id","incomingSignal","addPeer","peers","info","modal","JoinModal","waitingUsers","setWaitingUsers","Modal","show","onHide","backdrop","keyboard","Header","Title","Body","status","filter","rejectUser","acceptUser","Footer","updateStream","userStream","key","replaceTrack","getVideoTracks","removeTrack","addTrack","videoConstraints","setIsSharingScreen","a","mediaDevices","getDisplayMedia","cursor","screenStream","getTracks","onended","getUserMedia","video","audio","innerHeight","innerWidth","flexDirection","socketFunctions","receive_returned_signal","destroy","user_left_listener","videoMediaListener","audioMediaListener","getUniqueArray","getPermissionRequestListener","getMediaListener","Room","setUserStream","currentCameraRef","sizeMap","chatOpen","setChatOpen","me","setCameraStream","socketConnect","userStreamRef","track","stop","getAudioTracks","enabled","maxHeight","flexWrap","values","item","index","enumerateDevices","devices","videoDevices","device","kind","updatedConstraints","deviceId","exact","switchCamera","maxWidth","View","acceptStatus","setAcceptStatus","serverMessage","setServerMessage","refresh","protocol","host","hostname","includes","getPermissionListener","joinMessageListener","userKickedListener","userBlockedListener","CircularProgress","align"],"mappings":"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","file":"static/js/6.03b0cbb6.chunk.js","sourcesContent":["import apiClient from \"../../helper/apiclient\";\nimport { toast } from \"react-toastify\";\n\nimport {\n  CREATE_ROOM,\n  GET_ROOM,\n  GET_ROOMS,\n  SET_USER_IS_CREATOR,\n  TOGGLE_USER_AUDIO,\n  TOGGLE_USER_VIDEO,\n} from \"./roomActionTypes\";\n\nimport {\n  create_room,\n  get_room,\n  invite,\n  isUserCreator,\n  removeInvite,\n} from \"../../config/backend_api\";\n\nimport { apiDispatch, getUrlFromCode } from \"../../helper/helperFunctions\";\nimport { getInvitations } from \"./userActions\";\n\nexport const createNewRoom = (data) => {\n  const url = create_room;\n  return (dispatch) => {\n    apiClient\n      .post(url, data)\n      .then((res) => {\n        dispatch(apiDispatch(CREATE_ROOM, res.data));\n        navigator.clipboard.writeText(getUrlFromCode(res.data.id));\n        toast.success(\"copied to clipboard\");\n      })\n      .catch((err) => {\n        toast.error(`error occured in creating the room`);\n      });\n  };\n};\n\nexport const getRooms = () => {\n  const url = get_room;\n  return (dispatch) => {\n    apiClient\n      .get(url)\n      .then((res) => {\n        dispatch(apiDispatch(GET_ROOMS, res.data));\n      })\n      .catch((err) => {\n        toast.error(`error occured in fetching your rooms`, {});\n      });\n  };\n};\n\nexport const deleteRoom = (roomID, fallback) => {\n  const url = `${get_room}${roomID}/`;\n  return (dispatch, getState) => {\n    apiClient.delete(url).then((res) => {\n      fallback(roomID);\n    });\n  };\n};\n\nexport const getRoom = (roomID) => {\n  const url = `${get_room}${roomID}/`;\n  return (dispatch) => {\n    apiClient.get(url).then((res) => {\n      dispatch(apiDispatch(GET_ROOM, res.data));\n    });\n  };\n};\n\nexport const toggleAudio = () => {\n  return (dispatch) => {\n    dispatch(apiDispatch(TOGGLE_USER_AUDIO));\n  };\n};\nexport const toggleVideo = () => {\n  return (dispatch) => {\n    dispatch(apiDispatch(TOGGLE_USER_VIDEO));\n  };\n};\n\nexport const inviteUser = (roomId, data) => {\n  const url = invite(roomId);\n  return (dispatch) => {\n    apiClient\n      .post(url, data)\n      .then((res) => {\n        dispatch(apiDispatch(GET_ROOM, res.data));\n        toast.success(\"user invited\");\n      })\n      .catch((err) => {\n        toast.error(err.response.data);\n      });\n  };\n};\n\nexport const removeInviteUser = (roomID, data) => {\n  const url = removeInvite(roomID);\n  return (dispatch) => {\n    apiClient\n      .post(url, data)\n      .then((res) => {\n        dispatch(apiDispatch(GET_ROOM, res.data));\n        dispatch(getInvitations());\n      })\n      .catch((err) => {\n        toast.error(err.response.data);\n      });\n  };\n};\n\nexport const getIsUserCreator = (roomId) => {\n  const url = isUserCreator(roomId);\n  return (dispatch) => {\n    apiClient.get(url).then((res) => {\n      dispatch(apiDispatch(SET_USER_IS_CREATOR, res.data.isCreator));\n    });\n  };\n};\n","class WebSocketService {\n  static instance = null;\n  callbacks = {};\n\n  static getInstance() {\n    if (!WebSocketService.instance) {\n      WebSocketService.instance = new WebSocketService();\n    }\n    return WebSocketService.instance;\n  }\n\n  constructor() {\n    this.socketRef = null;\n    this.fallback = null;\n    this.forcedClose = false;\n  }\n\n  connect(chatroom_url, fallback = () => {}) {\n    this.forcedClose = false;\n    this.fallback = fallback;\n    this.socketRef = new WebSocket(chatroom_url);\n\n    this.socketRef.onopen = () => {\n      console.log(\"websocket open\");\n    };\n\n    this.socketRef.onmessage = (e) => {\n      this.socketNewMessage(e.data);\n    };\n\n    this.socketRef.onerror = (e) => {\n      console.debug(e);\n    };\n\n    this.socketRef.onclose = (e) => {\n      console.log(e);\n      if (e.code === 4000) {\n        this.fallback(e);\n      } else if (this.forcedClose) {\n        console.log(\"websocket closed\");\n      } else {\n        console.log(\"websockets closed lets reopen\");\n        setTimeout(() => {\n          this.connect(chatroom_url, fallback(e));\n        }, 5000);\n      }\n    };\n  }\n\n  close(code, reason) {\n    // Default CLOSE_NORMAL code\n    if (typeof code == \"undefined\") {\n      code = 1000;\n    }\n    this.forcedClose = true;\n    if (this.socketRef) {\n      this.socketRef.close(code, reason);\n    }\n  }\n  on(command, func) {\n    this.callbacks[command] = func;\n  }\n\n  socketNewMessage(received_data) {\n    const parsedData = JSON.parse(received_data);\n    const { command, data } = parsedData;\n    console.log(parsedData);\n    if (Object.keys(this.callbacks).length === 0) {\n      return;\n    }\n    if (this.callbacks[command]) {\n      this.callbacks[command](data);\n    }\n  }\n\n  sendMessage(type, data) {\n    try {\n      this.waitForConnection(\n        function () {\n          this.socketRef.send(JSON.stringify({ type, data }));\n        }.bind(this),\n        1000\n      );\n    } catch (err) {\n      console.log(err.message);\n    }\n  }\n  refresh() {\n    if (this.socketRef) {\n      this.socketRef.close();\n    }\n  }\n\n  state() {\n    return this.socketRef.readyState;\n  }\n  waitForConnection(callback, interval) {\n    if (this.state() === 1) {\n      callback();\n    } else {\n      var that = this;\n      // optional: implement backoff for interval here\n      setTimeout(function () {\n        that.waitForConnection(callback, interval);\n      }, interval);\n    }\n  }\n}\n\nconst WebSocketInstance = WebSocketService.getInstance();\n\nexport default WebSocketInstance;\n","import { IconButton, makeStyles, Tooltip, Typography } from \"@material-ui/core\";\nimport React, { useEffect, useRef } from \"react\";\nimport MicOffIcon from \"@material-ui/icons/MicOff\";\nimport Avatar from \"@material-ui/core/Avatar\";\nimport Fade from \"@material-ui/core/Fade\";\nimport RemoveCircleOutlineIcon from \"@material-ui/icons/RemoveCircleOutline\";\nimport WebSocketInstance from \"../../helper/WebsocketService\";\nimport { useSelector } from \"react-redux\";\nimport BlockIcon from \"@material-ui/icons/Block\";\nimport { toast } from \"react-toastify\";\n\nconst useStyles = makeStyles((theme) => ({\n  responsive: ({ size, rows }) => ({\n    float: \"left\",\n    width: `${100 / size - 2}%`,\n    height: `${100 / rows - 2}%`,\n    display: \"flex\",\n    alignItems: \"center\",\n  }),\n  videoTop: {\n    background: theme.palette.background.paper,\n  },\n  micOff: {\n    position: \"absolute\",\n    right: 0,\n    top: 0,\n  },\n  videoOff: {\n    position: \"absolute\",\n    width: \"100%\",\n    height: \"100%\",\n    top: 0,\n    left: 0,\n    display: \"flex\",\n    justifyContent: \"center\",\n    alignItems: \"center\",\n  },\n  avatar: {\n    width: \"min(50%, 10rem)\",\n    height: \"min(50%, 10rem)\",\n    fontSize: \"3rem\",\n  },\n  hoverDiv: {\n    position: \"absolute\",\n    top: \"0\",\n    left: \"0\",\n    width: \"100%\",\n    height: \"100%\",\n  },\n  remove: {\n    color: \"white\",\n    \"&:disabled\": { color: \"#444\" },\n  },\n  name: {\n    position: \"absolute\",\n    bottom: \"0.5rem\",\n    left: \"1rem\",\n    color: \"white\",\n  },\n}));\n\nconst Video = React.forwardRef(\n  ({ peer, muted, size, rows, isUserVideo, user, isSharingScreen }, ref) => {\n    const localRef = useRef(null);\n    const currentRef = ref || localRef;\n    const classes = useStyles({ size, rows });\n    const [open, setOpen] = React.useState(false);\n    const isCreator = useSelector((state) => state.roomReducer.isUserCreator);\n    const invitedUsers = useSelector(\n      (state) => state.roomReducer.currentRoom.invited_users\n    );\n\n    const mangoRef = useRef(null);\n    const videoWidth = mangoRef.current\n      ? (mangoRef.current.getBoundingClientRect().width * 9) / 16 <\n        mangoRef.current.getBoundingClientRect().height\n        ? `${0.95 * mangoRef.current.getBoundingClientRect().width}px`\n        : `${\n            (0.95 * mangoRef.current.getBoundingClientRect().height * 16) / 9\n          }px`\n      : \"auto\";\n    const videoHeight = mangoRef.current\n      ? (mangoRef.current.getBoundingClientRect().width * 9) / 16 >\n        mangoRef.current.getBoundingClientRect().height\n        ? `${0.95 * mangoRef.current.getBoundingClientRect().height}px`\n        : `${\n            (0.95 * mangoRef.current.getBoundingClientRect().width * 9) / 16\n          }px`\n      : \"auto\";\n\n    let initials =\n      (user.first_name ? user.first_name[0].toUpperCase() : \"\") +\n      (user.last_name ? user.last_name[0].toUpperCase() : \"\");\n    let fullName = user.first_name + \" \" + user.last_name;\n    fullName = fullName.trim();\n    if (isUserVideo) fullName = \"You\";\n\n    useEffect(() => {\n      if (peer) {\n        peer.on(\"stream\", (stream) => {\n          currentRef.current.srcObject = stream;\n        });\n      }\n    }, []);\n    const removeUser = () => {\n      if (!isCreator || isUserVideo) return;\n      WebSocketInstance.sendMessage(\"user kick\", { userID: user.id });\n    };\n    const blockUser = () => {\n      if (!isCreator || isUserVideo) return;\n      if (invitedUsers.some((el) => el.id === user.id)) {\n        toast.error(\"user is invited. first remove the invitation\");\n      } else {\n        WebSocketInstance.sendMessage(\"user block\", { userID: user.id });\n      }\n    };\n    return (\n      <div className={classes.responsive} ref={mangoRef}>\n        <div\n          className={classes.videoTop}\n          style={{\n            width: videoWidth,\n            height: videoHeight,\n            position: \"relative\",\n            overflow: \"hidden\",\n            margin: \"auto\",\n            borderRadius: \"1rem\",\n          }}\n        >\n          <video\n            style={{\n              objectFit: \"contain\",\n              transform: isUserVideo && !isSharingScreen ? \"scaleX(-1)\" : 1,\n              position: \"absolute\",\n              top: \"0\",\n              left: \"0\",\n              display: user.videoOn ? \"block\" : \"none\",\n            }}\n            playsInline\n            width=\"100%\"\n            height=\"100%\"\n            autoPlay\n            muted={muted}\n            ref={currentRef}\n            onClick={() => {}}\n            onMouseEnter={() => {\n              setOpen(true);\n            }}\n          />\n          <Fade in={open}>\n            <div\n              className={classes.hoverDiv}\n              onMouseLeave={() => {\n                setOpen(false);\n              }}\n            >\n              <div\n                style={{\n                  opacity: 0.6,\n                  background: \"black\",\n                  width: \"100%\",\n                  height: \"100%\",\n                  display: \"flex\",\n                  justifyContent: \"center\",\n                  alignItems: \"center\",\n                }}\n              >\n                <Tooltip title=\"remove user\">\n                  <IconButton\n                    className={classes.remove}\n                    onClick={removeUser}\n                    disabled={!isCreator || isUserVideo}\n                  >\n                    <RemoveCircleOutlineIcon fontSize=\"large\" />\n                  </IconButton>\n                </Tooltip>\n                <Tooltip title=\"Block user\">\n                  <IconButton\n                    className={classes.remove}\n                    onClick={blockUser}\n                    disabled={!isCreator || isUserVideo}\n                  >\n                    <BlockIcon fontSize=\"large\" />\n                  </IconButton>\n                </Tooltip>\n                <Typography variant=\"p\" className={classes.name}>\n                  {fullName}\n                </Typography>\n              </div>\n            </div>\n          </Fade>\n          {!user.audioOn && (\n            <IconButton className={classes.micOff}>\n              <MicOffIcon />\n            </IconButton>\n          )}\n          {!user.videoOn && (\n            <div className={classes.videoOff}>\n              <Avatar className={classes.avatar}>{initials}</Avatar>\n            </div>\n          )}\n        </div>\n      </div>\n    );\n  }\n);\n\nexport default Video;\n","import React from \"react\";\nimport {\n  Typography,\n  Dialog,\n  DialogContent,\n  DialogContentText,\n  DialogTitle,\n  DialogActions,\n  Button,\n} from \"@material-ui/core\";\nimport { useSelector } from \"react-redux\";\nimport CopyToClipboard from \"react-copy-to-clipboard\";\nimport { toast } from \"react-toastify\";\n\nconst DetailModal = ({ open, setOpen }) => {\n  const roomName = useSelector(\n    (state) => state.roomReducer.currentRoom.room_name\n  );\n  return (\n    <Dialog\n      open={open}\n      onClose={() => {\n        setOpen((o) => !o);\n      }}\n      aria-labelledby=\"alert-dialog-title\"\n      aria-describedby=\"alert-dialog-description\"\n    >\n      <DialogTitle id=\"alert-dialog-title\">{\"Meeting Details\"}</DialogTitle>\n      <DialogContent>\n        <Typography variant=\"h5\">{roomName}</Typography>\n        <br></br>\n        <Typography variant=\"p\">{\"Joining info\"}</Typography>\n        <DialogContentText id=\"alert-dialog-description\">\n          {window.location.href}\n        </DialogContentText>\n      </DialogContent>\n      <DialogActions>\n        <CopyToClipboard\n          text={window.location.href}\n          onCopy={() => {\n            toast.success(\"copied to clipboard\");\n          }}\n        >\n          <Button>Copy link</Button>\n        </CopyToClipboard>\n      </DialogActions>\n    </Dialog>\n  );\n};\n\nexport default DetailModal;\n","import React from \"react\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogTitle,\n  IconButton,\n  TextField,\n} from \"@material-ui/core\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { Col, Row } from \"react-bootstrap\";\nimport CloseIcon from \"@material-ui/icons/Close\";\nimport { useState } from \"react\";\nimport SendIcon from \"@material-ui/icons/Send\";\nimport { validateEmailAddress } from \"../../helper/helperFunctions\";\nimport { inviteUser, removeInviteUser } from \"../../redux/actions/roomActions\";\nimport { useParams } from \"react-router\";\n\nconst InviteModal = ({ open, setOpen }) => {\n  const { roomID } = useParams();\n  const invitedUsers = useSelector(\n    (state) => state.roomReducer.currentRoom.invited_users || []\n  );\n  const [email, setEmail] = useState({\n    str: \"\",\n    err_message: \"\",\n  });\n  const dispatch = useDispatch();\n  const invite = () => {\n    const str = email.str;\n    let err_message = \"\";\n    if (str.length === 0) err_message = \"email can't be empty\";\n    else if (!validateEmailAddress(str)) err_message = \"email not valid\";\n    else {\n      dispatch(\n        inviteUser(roomID, {\n          invitee: str,\n        })\n      );\n      setEmail({ str: \"\", err_message: \"\" });\n    }\n    if (err_message.length) {\n      setEmail({ str, err_message });\n    }\n  };\n  return (\n    <Dialog\n      open={open}\n      onClose={() => {\n        setOpen((o) => !o);\n      }}\n    >\n      <DialogTitle>{\"Invite people\"}</DialogTitle>\n      <DialogContent>\n        {invitedUsers.map((user, idx) => (\n          <Row key={idx} style={{ alignItems: \"center\" }}>\n            <Col>{user.email}</Col>\n            <IconButton\n              onClick={() => {\n                dispatch(removeInviteUser(roomID, { invitee: user.email }));\n              }}\n            >\n              <CloseIcon />\n            </IconButton>\n          </Row>\n        ))}\n        <TextField\n          error={email.err_message.length > 0}\n          value={email.str}\n          onChange={(value) => {\n            const email = value.target.value;\n            setEmail({ str: email, err_message: \"\" });\n          }}\n          helperText={email.err_message}\n        />\n        <IconButton onClick={invite}>\n          <SendIcon />\n        </IconButton>\n      </DialogContent>\n    </Dialog>\n  );\n};\n\nexport default InviteModal;\n","import {\n  Grid,\n  IconButton,\n  makeStyles,\n  Paper,\n  Typography,\n  Tooltip,\n  Menu,\n  MenuItem,\n} from \"@material-ui/core\";\nimport React, { useState } from \"react\";\nimport { red } from \"@material-ui/core/colors\";\nimport MicIcon from \"@material-ui/icons/Mic\";\nimport CallEndIcon from \"@material-ui/icons/CallEnd\";\nimport MicOffIcon from \"@material-ui/icons/MicOff\";\nimport VideocamOutlinedIcon from \"@material-ui/icons/VideocamOutlined\";\nimport VideocamOffOutlinedIcon from \"@material-ui/icons/VideocamOffOutlined\";\nimport MessageOutlinedIcon from \"@material-ui/icons/MessageOutlined\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { toggleAudio, toggleVideo } from \"../../redux/actions/roomActions\";\nimport { useHistory } from \"react-router\";\nimport InfoOutlinedIcon from \"@material-ui/icons/InfoOutlined\";\nimport PersonAddIcon from \"@material-ui/icons/PersonAdd\";\nimport DetailModal from \"./DetailModal\";\nimport InviteModal from \"./InviteModal\";\nimport { useMediaQuery } from \"@material-ui/core\";\nimport { useTheme } from \"@material-ui/styles\";\nimport MoreVertIcon from \"@material-ui/icons/MoreVert\";\nimport ScreenShareOutlinedIcon from \"@material-ui/icons/ScreenShareOutlined\";\nimport FlipCameraAndroidIcon from \"@material-ui/icons/FlipCameraAndroid\";\n\nconst useStyles = makeStyles((theme) => ({\n  container: {\n    minHeight: \"3rem\",\n    flexGrow: 0,\n    background: theme.palette.background.default,\n  },\n  blue: { background: \"blue\" },\n  orange: {\n    color: red[500],\n  },\n  right: { marginRight: \"1rem\" },\n}));\n\nconst Controls = ({ switchc, shareScreen, toggleChat }) => {\n  const classes = useStyles();\n  const dispatch = useDispatch();\n  const isAudioOn = useSelector((state) => state.roomReducer.userVideo.audioOn);\n  const isVideoOn = useSelector((state) => state.roomReducer.userVideo.videoOn);\n  const [detailModalOpen, setDetailModalOpen] = useState(false);\n  const [inviteModalOpen, setInviteModalOpen] = useState(false);\n  const history = useHistory();\n  const roomName = useSelector(\n    (state) => state.roomReducer.currentRoom.room_name\n  );\n  const isUserCreator = useSelector((state) => state.roomReducer.isUserCreator);\n  const leftRoom = () => {\n    history.replace(\"/\");\n  };\n  const theme = useTheme();\n  const isMobile = useMediaQuery(theme.breakpoints.down(\"sm\"));\n  const [anchorEl, setAnchorEl] = React.useState(null);\n  const isMenuOpen = Boolean(anchorEl);\n\n  return (\n    <Paper elevation={3} className={classes.container}>\n      <Grid\n        justify=\"space-between\"\n        container\n        alignItems=\"center\"\n        style={{ height: \"100%\" }}\n      >\n        <div>\n          <Typography variant=\"h5\" style={{ marginLeft: \"1rem\" }}>\n            {roomName}\n          </Typography>\n        </div>\n        <div>\n          <Tooltip title={isAudioOn ? \"Mic On\" : \"Mic off\"}>\n            <IconButton\n              color=\"inherit\"\n              onClick={() => {\n                dispatch(toggleAudio());\n              }}\n            >\n              {isAudioOn ? <MicIcon /> : <MicOffIcon />}\n            </IconButton>\n          </Tooltip>\n          <Tooltip title=\"end call\">\n            <IconButton color=\"inherit\" onClick={leftRoom}>\n              <CallEndIcon className={classes.orange} />\n            </IconButton>\n          </Tooltip>\n          <Tooltip title={isVideoOn ? \"video on\" : \"video off\"}>\n            <IconButton\n              color=\"inherit\"\n              onClick={() => {\n                dispatch(toggleVideo());\n              }}\n            >\n              {isVideoOn ? (\n                <VideocamOutlinedIcon />\n              ) : (\n                <VideocamOffOutlinedIcon />\n              )}\n            </IconButton>\n          </Tooltip>\n          <Tooltip title=\"share screen\">\n            <IconButton\n              color=\"inherit\"\n              onClick={() => {\n                shareScreen();\n              }}\n            >\n              <ScreenShareOutlinedIcon />\n            </IconButton>\n          </Tooltip>\n        </div>\n        {!isMobile && (\n          <div className={classes.right}>\n            <Tooltip title=\"switch camera\">\n              <IconButton\n                color=\"inherit\"\n                onClick={() => {\n                  switchc();\n                }}\n              >\n                <FlipCameraAndroidIcon />\n              </IconButton>\n            </Tooltip>\n            {isUserCreator && (\n              <Tooltip title=\"invite users\">\n                <IconButton\n                  onClick={() => {\n                    setInviteModalOpen((o) => !o);\n                  }}\n                >\n                  <PersonAddIcon />\n                </IconButton>\n              </Tooltip>\n            )}\n            <Tooltip title=\"Meeting Details\">\n              <IconButton\n                onClick={() => {\n                  setDetailModalOpen((o) => !o);\n                }}\n              >\n                <InfoOutlinedIcon />\n              </IconButton>\n            </Tooltip>\n            <Tooltip title=\"Chat\">\n              <IconButton onClick={toggleChat}>\n                <MessageOutlinedIcon />\n              </IconButton>\n            </Tooltip>\n          </div>\n        )}\n        {isMobile && (\n          <div className={classes.right}>\n            <IconButton\n              aria-controls=\"simple-theme-menu\"\n              aria-haspopup=\"true\"\n              color=\"inherit\"\n              className=\"header-title-button\"\n              onClick={(event) => setAnchorEl(event.currentTarget)}\n            >\n              <MoreVertIcon />\n            </IconButton>\n            <Menu\n              anchorEl={anchorEl}\n              id={\"controls-menu\"}\n              keepMounted\n              open={isMenuOpen}\n              onClose={() => {\n                setAnchorEl(null);\n              }}\n            >\n              <MenuItem\n                onClick={() => {\n                  setAnchorEl(null);\n                  setInviteModalOpen((o) => !o);\n                }}\n              >\n                Invite User\n              </MenuItem>\n              <MenuItem\n                onClick={() => {\n                  setAnchorEl(null);\n                  setDetailModalOpen((o) => !o);\n                }}\n              >\n                Meeting Details\n              </MenuItem>\n              <MenuItem\n                onClick={() => {\n                  setAnchorEl(null);\n                  toggleChat();\n                }}\n              >\n                Chat\n              </MenuItem>\n            </Menu>\n          </div>\n        )}\n        {isUserCreator && (\n          <InviteModal open={inviteModalOpen} setOpen={setInviteModalOpen} />\n        )}\n        <DetailModal open={detailModalOpen} setOpen={setDetailModalOpen} />\n      </Grid>\n    </Paper>\n  );\n};\n\nexport default Controls;\n","export const split = (x) => {\n  let n = Math.floor(Math.sqrt(x));\n  let zp = n - (x % n);\n  let pp = Math.floor(x / n);\n  let m = [];\n  for (let i = 0; i < n; i++) {\n    if (i >= zp) {\n      m.push(pp + 1);\n    } else {\n      m.push(pp);\n    }\n  }\n  m = m.reverse();\n  let res = {};\n  let count = 1;\n  let idx = 0;\n  for (let i = 1; i <= x; i++) {\n    res[i] = m[idx];\n    count++;\n    if (count > m[idx]) {\n      count = 1;\n      idx++;\n    }\n  }\n  res[\"rows\"] = m.length;\n  return res;\n};\n\nexport function detectURL(message) {\n  var urlRegex = /(((https?:\\/\\/)|(www\\.))[^\\s]+)/g;\n  return message.replace(urlRegex, function (urlMatch) {\n    return `<a href=${urlMatch} target=\"_blank\" >${urlMatch}</a>`;\n  });\n}\nexport function sanitize(string) {\n  const map = {\n    \"&\": \"&amp;\",\n    \"<\": \"&lt;\",\n    \">\": \"&gt;\",\n    '\"': \"&quot;\",\n    \"'\": \"&#x27;\",\n    \"/\": \"&#x2F;\",\n  };\n  const reg = /[&<>\"'/]/gi;\n  return string.replace(reg, (match) => map[match]);\n}\n\nexport const getFullName = (firstName, lastName) => {\n  const fullName = firstName + \" \" + lastName;\n  return fullName.trim();\n};\n","import React, { useCallback, useEffect, useState } from \"react\";\nimport Drawer from \"@material-ui/core/Drawer\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport { IconButton } from \"@material-ui/core\";\nimport ChevronRightIcon from \"@material-ui/icons/ChevronRight\";\nimport WebSocketService from \"../../helper/WebsocketService\";\nimport TextField from \"@material-ui/core/TextField\";\nimport { Send } from \"@material-ui/icons\";\nimport InputAdornment from \"@material-ui/core/InputAdornment\";\nimport { useSelector } from \"react-redux\";\nimport \"./chat.css\";\nconst drawerWidth = 360;\n\nconst useStyles = makeStyles((theme) => ({\n  drawer: {\n    width: drawerWidth,\n    flexShrink: 0,\n  },\n  drawerPaper: {\n    width: drawerWidth,\n    height: \"calc(100vh - 9rem)\",\n    borderRadius: \"1rem\",\n    top: \"5rem\",\n    right: \"12px\",\n  },\n  drawerHeader: {\n    display: \"flex\",\n    alignItems: \"center\",\n    padding: theme.spacing(0, 1),\n    ...theme.mixins.toolbar,\n    justifyContent: \"flex-start\",\n  },\n  chatInputContainer: {\n    marginTop: \"auto\",\n  },\n  chatInput: {\n    marginBottom: \"2rem\",\n    \"& .MuiFilledInput-root\": {\n      borderRadius: \"50px\",\n      borderBottom: 0,\n      paddingTop: \"15px\",\n      paddingBottom: \"15px\",\n      \"&::before\": { borderBottom: 0 },\n    },\n  },\n  messageBoxRight: {\n    background: theme.palette.background.paper,\n    color: theme.palette.text.primary,\n  },\n  messageBoxLeft: {\n    background: \"#4870df\",\n    color: theme.palette.background.default,\n  },\n  messageSender: {\n    color: theme.palette.text.primary,\n    fontSize: \"10px\",\n  },\n}));\n\nconst MessageItem = (props) => {\n  const owner = useSelector((state) => state.userReducer.user);\n  const classes = useStyles();\n  let messagePosition =\n    owner.pk === props.sender.id\n      ? `chatApp__convMessageItem--right`\n      : `chatApp__convMessageItem--left`;\n  let messageBackground =\n    owner.pk === props.sender.id\n      ? classes.messageBoxRight\n      : classes.messageBoxLeft;\n  return (\n    <div\n      className={\"chatApp__convMessageItem \" + messagePosition + \" clearfix\"}\n    >\n      <div className={`chatApp__convMessageValue ${messageBackground}`}>\n        {owner.pk !== props.sender.id && (\n          <div className={classes.messageSender}>{props.sender.first_name}</div>\n        )}\n        <div>{props.message}</div>\n      </div>\n    </div>\n  );\n};\n\nconst MessageList = React.memo((props) => {\n  return (\n    <div className={\"chatApp__convTimeline\"}>\n      {props.messages\n        .slice(0)\n        .reverse()\n        .map((messageItem, idx) => (\n          <MessageItem\n            key={idx}\n            sender={messageItem.sender}\n            senderAvatar={messageItem.senderAvatar}\n            message={messageItem.message}\n          />\n        ))}\n    </div>\n  );\n});\n\nconst Chat = ({ open, setOpen }) => {\n  const [messages, setMessages] = useState([]);\n  const [currMessage, setCurrMessage] = useState(\"\");\n  const classes = useStyles();\n  useEffect(() => {\n    WebSocketService.on(\"receive new message\", (data) => {\n      setMessages((messages) => [...messages, data]);\n    });\n  }, []);\n  const sendMessage = () => {\n    WebSocketService.sendMessage(\"send new message\", currMessage);\n    setCurrMessage(\"\");\n  };\n\n  const onCurrMessageChanged = useCallback((e) => {\n    const val = e.target.value;\n    setCurrMessage(val);\n  }, []);\n  return (\n    <Drawer\n      className={classes.drawer}\n      variant=\"persistent\"\n      anchor=\"right\"\n      open={open}\n      classes={{\n        paper: classes.drawerPaper,\n      }}\n    >\n      <div className={classes.drawerHeader}>\n        <IconButton\n          onClick={() => {\n            setOpen(false);\n          }}\n        >\n          <ChevronRightIcon />\n        </IconButton>\n      </div>\n      <MessageList messages={messages} />\n      <div className={classes.chatInputContainer}>\n        <TextField\n          placeholder=\"send a message to everyone\"\n          size=\"small\"\n          variant=\"filled\"\n          fullWidth\n          multiline\n          rowsMax={4}\n          className={classes.chatInput}\n          value={currMessage}\n          onChange={onCurrMessageChanged}\n          InputProps={{\n            endAdornment: (\n              <InputAdornment position=\"end\">\n                {currMessage.length > 0 && (\n                  <IconButton\n                    aria-label=\"toggle password visibility\"\n                    onClick={sendMessage}\n                  >\n                    <Send />\n                  </IconButton>\n                )}\n              </InputAdornment>\n            ),\n          }}\n        />\n      </div>\n    </Drawer>\n  );\n};\n\nexport default Chat;\n","import { toast } from \"react-toastify\";\nimport WebsocketService from \"./WebsocketService\";\nimport { getFullName } from \"../helper/utilFunctions\";\nimport { getUniqueArray } from \"./helperFunctions\";\nimport { addPeer, createPeer } from \"./peers\";\n\nexport const all_users_listener =\n  (peersRef, myID, stream, setPeers) => (users) => {\n    peersRef.current = {};\n    const temp = {};\n    users.forEach((user) => {\n      if (myID !== user.id) {\n        const peer = createPeer(user.id, myID, stream);\n\n        peersRef.current[user.id] = { user, peer };\n        temp[user.id] = {\n          user: user,\n          peer: peer,\n        };\n      }\n    });\n    setPeers(temp);\n  };\n\nexport const user_joined_listener =\n  (myID, peersRef, stream, setPeers, isUserAudioOn, isUserVideoOn) =>\n  (payload) => {\n    const user = payload.callerUser;\n    if (payload.usable_id === myID) {\n      const peer = addPeer(payload.signal, user.id, stream);\n      peersRef.current[user.id] = { user, peer };\n      setPeers((peers) => ({\n        ...peers,\n        [user.id]: {\n          user: user,\n          peer: peer,\n        },\n      }));\n      toast.info(`${getFullName(user.first_name, user.last_name)} joined`);\n    }\n  };\n\nexport const receive_returned_signal = (myID, peersRef, isUserAudioOn, isUserVideoOn) => (payload) => {\n    if (payload.usable_id === myID) {\n      const { peer } = peersRef.current[payload.id];\n      peer.signal(payload.signal);\n\n      WebsocketService.sendMessage(\"audioMedia\", {\n        userID: myID,\n        audioOn: isUserAudioOn,\n      });\n      WebsocketService.sendMessage(\"videoMedia\", {\n        userID: myID,\n        videoOn: isUserVideoOn,\n      });\n      WebsocketService.sendMessage(\"get media\", \"\");\n    }\n  };\n\nexport const user_left_listener = (myID, peersRef, setPeers) => (payload) => {\n  const user = payload.user;\n  if (peersRef.current[user.id]) {\n    peersRef.current[user.id].peer.destroy();\n  }\n  delete peersRef.current[user.id];\n  setPeers((peers) => {\n    const { [payload.user.id]: remove, ...rest } = peers;\n    return rest;\n  });\n  if (payload.user.id !== myID) {\n    toast.info(`${getFullName(user.first_name, user.last_name)} left`);\n  }\n};\n\nexport const videoMediaListener = (peersRef, setPeers) => (payload) => {\n  const userID = payload.userID;\n  if (peersRef.current[userID]) {\n    peersRef.current[userID].user.videoOn = payload.videoOn;\n    setPeers((peers) => {\n      const { user, peer } = peers[userID];\n      return {\n        ...peers,\n        [userID]: { peer, user: { ...user, videoOn: payload.videoOn } },\n      };\n    });\n  }\n};\n\nexport const audioMediaListener = (peersRef, setPeers) => (payload) => {\n  const userID = payload.userID;\n  if (peersRef.current[userID]) {\n    peersRef.current[userID].user.audioOn = payload.audioOn;\n    setPeers((peers) => {\n      const { user, peer } = peers[userID];\n      return {\n        ...peers,\n        [userID]: { peer, user: { ...user, audioOn: payload.audioOn } },\n      };\n    });\n  }\n};\n\nexport const getMediaListener = (peersRef, setPeers) => (payload) => {\n  console.log(payload);\n  for (let key in peersRef.current) {\n    if (payload.audio[key]) {\n      peersRef.current[key].user.audioOn = payload.audio[key];\n    }\n    if (payload.video[key]) {\n      peersRef.current[key].user.videoOn = payload.video[key];\n    }\n  }\n  setPeers((peers) => {\n    for (let key in peers) {\n      if (payload.audio[key]) {\n        peers[key].user.audioOn = payload.audio[key];\n      }\n      if (payload.video[key]) {\n        peers[key].user.videoOn = payload.video[key];\n      }\n    }\n    return { ...peers };\n  });\n};\n\nexport const getPermissionListener = (myID, setAcceptStatus) => (payload) => {\n  if (payload.usable_id === myID) {\n    setAcceptStatus(payload.status);\n  }\n};\n\nexport const getPermissionRequestListener =\n  (myID, setWaitingUsers) => (payload) => {\n    if (payload.usable_id === myID) {\n      setWaitingUsers((users) => {\n        users.push(payload.user);\n        const newUsers = getUniqueArray(users, \"id\");\n        return newUsers;\n      });\n    }\n  };\n\nexport const userKickedListener = (myID, history) => (payload) => {\n  if (payload.usable_id === myID) {\n    history.replace(\"/\", {\n      message: \"The Organisor removed you from room\",\n      type: \"error\",\n    });\n  }\n};\n\nexport const userBlockedListener = (myID, history) => (payload) => {\n  if (payload.usable_id === myID) {\n    history.replace(\"/\", {\n      message: \"The Organisor blocked you from room\",\n      type: \"error\",\n    });\n  }\n};\n\nexport const joinMessageListener =\n  (setAcceptStatus, setServerMessage) => (message) => {\n    setAcceptStatus(\"message\");\n    if (message === \"creator not available\") {\n      setServerMessage(\n        \"The Organisor has not joined the room yet. Please try joining after some time\"\n      );\n    } else if (message === \"user blocked\") {\n      setServerMessage(\"The Organisor has blocked you.\");\n    }\n  };\n","import Peer from \"simple-peer\";\nimport WebsocketService from \"./WebsocketService\";\n\nexport function createPeer(userToSignal, callerID, stream) {\n  const peer = new Peer({\n    initiator: true,\n    trickle: false,\n    stream,\n  });\n  peer.on(\"signal\", (signal) => {\n    WebsocketService.sendMessage(\"sending signal\", {\n      userToSignal,\n      callerID,\n      signal,\n    });\n  });\n  return peer;\n}\n\nexport function addPeer(incomingSignal, callerID, stream) {\n  const peer = new Peer({\n    initiator: false,\n    trickle: false,\n    stream,\n  });\n  peer.on(\"signal\", (signal) => {\n    WebsocketService.sendMessage(\"returning signal\", { signal, callerID });\n  });\n  peer.signal(incomingSignal);\n  return peer;\n}\n","import { IconButton } from \"@material-ui/core\";\nimport React from \"react\";\nimport { Modal, Row, Col } from \"react-bootstrap\";\nimport CloseIcon from \"@material-ui/icons/Close\";\nimport CheckIcon from \"@material-ui/icons/Check\";\nimport { makeStyles } from \"@material-ui/styles\";\nimport WebSocketInstance from \"../../helper/WebsocketService\";\n\nconst useStyles = makeStyles((theme) => ({\n  modal: {\n    \"&& .modal-content\": {\n      background: theme.palette.background.paper,\n      color: theme.palette.text.primary,\n    },\n  },\n}));\n\nconst JoinModal = ({ waitingUsers, setWaitingUsers }) => {\n  const classes = useStyles();\n  const rejectUser = (user) => {\n    WebSocketInstance.sendMessage(\"give join permission status\", {\n      userID: user.id,\n      status: \"reject\",\n    });\n    setWaitingUsers((users) => users.filter((el) => el.id !== user.id));\n  };\n  const acceptUser = (user) => {\n    WebSocketInstance.sendMessage(\"give join permission status\", {\n      userID: user.id,\n      status: \"accept\",\n    });\n    setWaitingUsers((users) => users.filter((el) => el.id !== user.id));\n  };\n  return (\n    <Modal\n      show={Boolean(waitingUsers.length)}\n      onHide={() => {}}\n      backdrop=\"static\"\n      keyboard={false}\n      className={classes.modal}\n    >\n      <Modal.Header>\n        <Modal.Title>Modal title</Modal.Title>\n      </Modal.Header>\n      <Modal.Body>\n        {waitingUsers.map((user, idx) => (\n          <Row key={idx} style={{ alignItems: \"center\" }}>\n            <Col>{user.first_name} wants to join</Col>\n            <IconButton\n              onClick={() => {\n                rejectUser(user);\n              }}\n            >\n              <CloseIcon />\n            </IconButton>\n            <IconButton\n              onClick={() => {\n                acceptUser(user);\n              }}\n            >\n              <CheckIcon />\n            </IconButton>\n          </Row>\n        ))}\n      </Modal.Body>\n      <Modal.Footer></Modal.Footer>\n    </Modal>\n  );\n};\n\nexport default JoinModal;\n","export const updateStream = (peersRef, setPeers, userStream) => (stream) => {\n  for (let key in peersRef.current) {\n    peersRef.current[key].peer.replaceTrack(\n      userStream.getVideoTracks()[0],\n      stream.getVideoTracks()[0],\n      userStream\n    );\n  }\n  setPeers({ ...peersRef.current });\n  userStream.removeTrack(userStream.getVideoTracks()[0]);\n  userStream.addTrack(stream.getVideoTracks()[0]);\n};\n\nexport const switchCamera =\n  (peersRef, setPeers, userStream, videoConstraints) =>\n  async (currentCameraRef) => {\n    const devices = await navigator.mediaDevices.enumerateDevices();\n    const videoDevices = devices.filter(\n      (device) => device.kind === \"videoinput\"\n    );\n    currentCameraRef.current =\n      (currentCameraRef.current + 1) % videoDevices.length;\n\n    const updatedConstraints = {\n      ...videoConstraints,\n      deviceId: {\n        exact: videoDevices[currentCameraRef.current].deviceId,\n      },\n    };\n    videoConstraints = updatedConstraints;\n\n    const stream = await navigator.mediaDevices.getUserMedia({\n      video: videoConstraints,\n      audio: true,\n    });\n    updateStream(peersRef, setPeers, userStream)(stream);\n  };\n\nexport const shareScreen = async (\n  peersRef,\n  setPeers,\n  videoConstraints,\n  userStream,\n  setIsSharingScreen\n) => {\n  const screenStream = await navigator.mediaDevices.getDisplayMedia({\n    cursor: true,\n  });\n  updateStream(peersRef, setPeers, userStream)(screenStream);\n  setIsSharingScreen(true);\n  screenStream.getTracks()[0].onended = async () => {\n    const stream = await navigator.mediaDevices.getUserMedia({\n      video: videoConstraints,\n      audio: true,\n    });\n    updateStream(peersRef, setPeers, userStream)(stream);\n    setIsSharingScreen(false);\n  };\n};\n","import React, { useEffect, useRef, useState } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport WebsocketService from \"../helper/WebsocketService\";\nimport { useParams } from \"react-router\";\nimport Video from \"../components/common/Video\";\nimport Controls from \"../components/Room/Controls\";\nimport { split } from \"../helper/utilFunctions\";\nimport Chat from \"../components/Room/Chat\";\nimport { makeStyles } from \"@material-ui/core\";\nimport {\n  all_users_listener,\n  user_joined_listener,\n  user_left_listener,\n  receive_returned_signal,\n  videoMediaListener,\n  audioMediaListener,\n  getPermissionRequestListener,\n  getMediaListener,\n} from \"../helper/socketListeners\";\nimport JoinModal from \"../components/Room/JoinModal\";\nimport { shareScreen, switchCamera } from \"../helper/unusedFunctions\";\nimport { getIsUserCreator, getRoom } from \"../redux/actions/roomActions\";\n\nlet videoConstraints = {\n  height: window.innerHeight / 2,\n  width: window.innerWidth / 2,\n};\n\nconst useStyles = makeStyles((theme) => ({\n  container: {\n    display: \"flex\",\n    height: \"100%\",\n    width: \"100%\",\n    flexDirection: \"column\",\n    background: theme.palette.background.default,\n  },\n}));\n\nconst socketFunctions = (\n  peersRef,\n  myID,\n  stream,\n  setPeers,\n  isUserAudioOn,\n  isUserVideoOn,\n  setWaitingUsers\n) => {\n  WebsocketService.on(\n    \"all users\",\n    all_users_listener(peersRef, myID, stream, setPeers)\n  );\n  WebsocketService.on(\n    \"user joined\",\n    user_joined_listener(\n      myID,\n      peersRef,\n      stream,\n      setPeers,\n      isUserAudioOn,\n      isUserVideoOn\n    )\n  );\n\n  WebsocketService.on(\n    \"receiving returned signal\",\n    receive_returned_signal(myID, peersRef, isUserAudioOn, isUserVideoOn)\n  );\n\n  WebsocketService.on(\n    \"user left\",\n    user_left_listener(myID, peersRef, setPeers)\n  );\n\n  WebsocketService.on(\"videoMedia\", videoMediaListener(peersRef, setPeers));\n\n  WebsocketService.on(\"audioMedia\", audioMediaListener(peersRef, setPeers));\n  WebsocketService.on(\n    \"user want to join\",\n    getPermissionRequestListener(myID, setWaitingUsers)\n  );\n  WebsocketService.on(\"get media\", getMediaListener(peersRef, setPeers));\n};\n\nconst Room = () => {\n  const { roomID } = useParams();\n  const [peers, setPeers] = useState({});\n  const userVideo = useRef();\n  const socketRef = useRef(WebsocketService);\n  const peersRef = useRef({});\n  const myID = useSelector((state) => state.userReducer.user.pk);\n  const [userStream, setUserStream] = useState();\n  const currentCameraRef = useRef(0);\n  let sizeMap = split(Object.keys(peers).length + 1);\n  const [chatOpen, setChatOpen] = useState(false);\n  const isUserAudioOn = useSelector(\n    (state) => state.roomReducer.userVideo.audioOn\n  );\n  const isUserVideoOn = useSelector(\n    (state) => state.roomReducer.userVideo.videoOn\n  );\n  const classes = useStyles();\n  const me = useSelector((state) => state.userReducer.user);\n  const [waitingUsers, setWaitingUsers] = useState([]);\n  const dispatch = useDispatch();\n  const [isSharingScreen, setIsSharingScreen] = useState(false);\n  const setCameraStream = async () => {\n    const stream = await navigator.mediaDevices.getUserMedia({\n      video: true,\n      audio: true,\n    });\n    setUserStream(stream);\n    if (userVideo && userVideo.current) {\n      userVideo.current.srcObject = stream;\n    }\n  };\n\n  const socketConnect = async () => {\n    await setCameraStream();\n    socketRef.current.sendMessage(\"join room\", roomID);\n  };\n\n  useEffect(() => {\n    dispatch(getIsUserCreator(roomID));\n    dispatch(getRoom(roomID));\n    socketConnect();\n  }, []);\n\n  useEffect(() => {\n    socketFunctions(\n      peersRef,\n      myID,\n      userStream,\n      setPeers,\n      isUserAudioOn,\n      isUserVideoOn,\n      setWaitingUsers\n    );\n  }, [userStream, isUserAudioOn, isUserVideoOn, myID]);\n\n  useEffect(() => {\n    let userStreamRef = userStream;\n    return () => {\n      if (userStreamRef) {\n        userStreamRef.getVideoTracks().forEach((track) => {\n          track.stop();\n        });\n        userStreamRef.getAudioTracks().forEach((track) => {\n          track.stop();\n        });\n      }\n    };\n  }, [userStream]);\n\n  useEffect(() => {\n    if (userStream) {\n      userStream.getAudioTracks()[0].enabled = isUserAudioOn;\n      if (socketRef.current.state() === 1) {\n        socketRef.current.sendMessage(\"audioMedia\", {\n          userID: myID,\n          audioOn: isUserAudioOn,\n        });\n      }\n    }\n  }, [userStream, isUserAudioOn, myID]);\n\n  useEffect(() => {\n    if (userStream) {\n      userStream.getVideoTracks()[0].enabled = isUserVideoOn;\n      if (socketRef.current.state() === 1) {\n        socketRef.current.sendMessage(\"videoMedia\", {\n          userID: myID,\n          videoOn: isUserVideoOn,\n        });\n      }\n    }\n  }, [userStream, isUserVideoOn, myID]);\n\n  useEffect(() => {\n    sizeMap = split(Object.keys(peers).length + 1);\n  }, [peers]);\n\n  return (\n    <div className={classes.container}>\n      <div\n        style={{\n          display: \"flex\",\n          width: \"100%\",\n          maxHeight: \"calc(100vh - 7rem)\",\n          margin: \"auto\",\n          flexGrow: \"1\",\n          flexWrap: \"wrap\",\n        }}\n      >\n        <Video\n          muted\n          ref={userVideo}\n          user={{ ...me, videoOn: isUserVideoOn, audioOn: isUserAudioOn }}\n          autoPlay\n          playsInline\n          size={sizeMap[1]}\n          rows={sizeMap[\"rows\"]}\n          isUserVideo\n          isSharingScreen\n        />\n        {Object.values(peers).map((item, index) => {\n          return (\n            <Video\n              key={index}\n              peer={item.peer}\n              user={item.user}\n              size={sizeMap[index + 2]}\n              rows={sizeMap[\"rows\"]}\n            />\n          );\n        })}\n      </div>\n      <JoinModal\n        waitingUsers={waitingUsers}\n        setWaitingUsers={setWaitingUsers}\n      />\n      <Controls\n        switchc={() => {\n          switchCamera(\n            peersRef,\n            setPeers,\n            userStream,\n            videoConstraints\n          )(currentCameraRef);\n        }}\n        shareScreen={() => {\n          shareScreen(\n            peersRef,\n            setPeers,\n            videoConstraints,\n            userStream,\n            setIsSharingScreen\n          );\n        }}\n        toggleChat={() => {\n          setChatOpen((open) => !open);\n        }}\n      />\n      <Chat open={chatOpen} setOpen={setChatOpen} />\n    </div>\n  );\n};\n\nexport default Room;\n","import React, { useEffect, useState } from \"react\";\nimport WebSocketInstance from \"../helper/WebsocketService\";\nimport { useHistory, useParams } from \"react-router\";\nimport Room from \"./RoomView\";\nimport {\n  getPermissionListener,\n  joinMessageListener,\n  userBlockedListener,\n  userKickedListener,\n} from \"../helper/socketListeners\";\nimport { useSelector } from \"react-redux\";\nimport Typography from \"@material-ui/core/Typography\";\nimport CircularProgress from \"@material-ui/core/CircularProgress\";\nimport { makeStyles } from \"@material-ui/styles\";\nimport { Paper } from \"@material-ui/core\";\nconst useStyles = makeStyles((theme) => ({\n  container: {\n    background: theme.palette.background.default,\n    height: \"100%\",\n    width: \"100%\",\n    position: \"relative\",\n  },\n  color: { color: theme.palette.text.primary },\n  paper: {\n    display: \"flex\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    maxWidth: \"75vw\",\n    position: \"relative\",\n    marginLeft: \"auto\",\n    marginRight: \"auto\",\n    top: \"3rem\",\n  },\n}));\n\nconst View = () => {\n  const { roomID } = useParams();\n  const history = useHistory();\n  const classes = useStyles();\n  const myID = useSelector((state) => state.userReducer.user.pk);\n  const [acceptStatus, setAcceptStatus] = useState(\"pending\");\n  const [serverMessage, setServerMessage] = useState(\"\");\n  useEffect(() => {\n    WebSocketInstance.refresh();\n    let protocol = window.location.protocol === \"http:\" ? \"ws\" : \"wss\";\n    let host = window.location.hostname.includes(\"localhost\")\n      ? \"localhost:7000\"\n      : window.location.hostname;\n    WebSocketInstance.connect(\n      `${protocol}://${host}/ws/room/${roomID}/`,\n      (e) => {\n        history.replace(\"/\", {\n          message: \"the url entered is incorrect.\",\n          type: \"error\",\n        });\n      }\n    );\n    WebSocketInstance.on(\n      \"get permission\",\n      getPermissionListener(myID, setAcceptStatus)\n    );\n    WebSocketInstance.on(\n      \"join message\",\n      joinMessageListener(setAcceptStatus, setServerMessage)\n    );\n    WebSocketInstance.on(\"user kicked\", userKickedListener(myID, history));\n    WebSocketInstance.on(\"user blocked\", userBlockedListener(myID, history));\n    return () => {\n      WebSocketInstance.close();\n    };\n  }, []);\n\n  useEffect(() => {\n    if (acceptStatus === \"reject\") {\n      history.replace(\"/\", {\n        message: \"The creator rejected the join request\",\n        type: \"error\",\n      });\n    }\n  }, [acceptStatus]);\n\n  return (\n    <>\n      {acceptStatus === \"pending\" ? (\n        <div className={classes.container}>\n          <Paper elevation={3} variant=\"outlined\" className={classes.paper}>\n            <Typography\n              variant=\"h2\"\n              className={classes.color}\n              style={{ width: \"max-content\" }}\n            >\n              Joining the room\n            </Typography>\n            <CircularProgress\n              className={classes.color}\n              style={{ marginLeft: \"1rem\" }}\n            />\n          </Paper>\n        </div>\n      ) : acceptStatus === \"accept\" ? (\n        <Room />\n      ) : acceptStatus === \"message\" ? (\n        <div className={classes.container}>\n          <Paper elevation={3} variant=\"outlined\" className={classes.paper}>\n            <Typography\n              variant=\"h2\"\n              className={classes.color}\n              style={{ width: \"max-content\" }}\n              align=\"center\"\n            >\n              {serverMessage}\n            </Typography>\n          </Paper>\n        </div>\n      ) : null}\n    </>\n  );\n};\n\nexport default View;\n"],"sourceRoot":""}